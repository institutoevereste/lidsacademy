<!DOCTYPE html>
<html lang="pt-pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evereste Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js para grÃ¡ficos do dashboard -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      /* Cores do Logo LIDS */
      --brand-blue: #0066cc;
      --brand-orange: #ff6b35;
      --brand-teal: #00a896;
      --brand-purple: #6a4c93;
      --brand-yellow: #ffc857;

      /* Paleta Principal */
      --primary: #0066cc;
      --primary-dark: #004c99;
      --primary-light: #3385d6;
      --accent: #ff6b35;
      --accent-light: #ff8c61;

      /* Tema Claro */
      --surface: #ffff;
      --surface-light: #f8fafc;
      --surface-card: #ffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: rgba(0, 102, 204, 0.12);
      --glow: rgba(0, 102, 204, 0.2);

      /* Hero (Tema Escuro) */
      --hero-bg: #0f172a;
      --hero-text: #ffff;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 50%, #fef3c7 100%);
      color: var(--text);
      position: relative;
      overflow-x: hidden; /* Previne scroll horizontal */
    }

    /* Scroll Progress Bar */
    #scroll-progress {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--brand-blue), var(--brand-teal), var(--brand-orange));
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
      z-index: 100;
      transition: width 100ms ease;
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    /* Header Glassmorphism */
    .header-glass {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: saturate(180%) blur(16px);
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid var(--border);
      transition: all 300ms ease;
      box-shadow: 0 4px 12px rgba(0, 102, 204, 0.08);
    }

    .header-scrolled {
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 10px 30px rgba(0, 102, 204, 0.15);
      border-color: rgba(0, 102, 204, 0.2);
    }

    /* Hero (Tema Escuro) */
    .hero {
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }

    @keyframes gradientShift {
      0%,
      100% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(1200px 500px at 80% -10%, rgba(0, 102, 204, 0.2), transparent 50%),
        radial-gradient(900px 380px at 10% 10%, rgba(255, 107, 53, 0.15), transparent 60%);
      pointer-events: none;
    }

    .scroll-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      animation: bounce 2s infinite;
      color: var(--hero-text);
    }

    @keyframes bounce {
      0%,
      100% {
        transform: translateX(-50%) translateY(0);
      }
      50% {
        transform: translateX(-50%) translateY(-10px);
      }
    }

    /* Particles */
    .particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .particles span {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 999px;
      animation: float 12s linear infinite;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.7));
    }

    @keyframes float {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-120vh) translateX(20vw);
        opacity: 0;
      }
    }

    /* 3D Cards with Gradient Border */
    .card-3d {
      background: var(--surface-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 102, 204, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.5);
      transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card-3d::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 16px;
      padding: 2px;
      background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal), var(--brand-orange));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 300ms ease;
    }

    .card-3d:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 50px rgba(0, 102, 204, 0.2), 0 0 0 1px var(--glow);
    }

    .card-3d:hover::before {
      opacity: 1;
    }

    /* Solid Color Course Cards */
    .course-card-solid {
      border: none;
      color: white;
      transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    .course-card-solid::before {
      display: none;
    }

    .course-card-solid:hover {
      transform: translateY(-8px) scale(1.02);
      filter: brightness(1.1);
    }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal));
      border: 1px solid rgba(0, 102, 204, 0.3);
      border-radius: 12px;
      color: #fff;
      padding: 12px 24px;
      font-weight: 700;
      transition: all 250ms ease;
      box-shadow: 0 8px 24px rgba(0, 102, 204, 0.25);
      position: relative;
      overflow: hidden;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      transition: transform 400ms ease;
    }

    .btn-primary:hover::before {
      transform: translateX(100%);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 102, 204, 0.35);
    }

    .btn-ghost {
      background: rgba(0, 102, 204, 0.08);
      border: 1px solid var(--border);
      color: var(--primary);
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 700;
      transition: all 250ms ease;
    }

    .btn-ghost:hover {
      transform: translateY(-2px);
      background: rgba(0, 102, 204, 0.15);
      border-color: var(--primary);
    }
    
    .btn-disabled {
      background: #94a3b8;
      color: #e2e8f0;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    .btn-disabled:hover {
      background: #94a3b8;
      box-shadow: none;
      transform: none;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      transition: all 200ms ease;
    }
    .btn-danger:hover {
      background: #b91c1c;
      transform: translateY(-1px);
    }
    
    .btn-edit {
      background: #3b82f6;
      color: white;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      transition: all 200ms ease;
    }
    .btn-edit:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }


    /* Reveal Animation */
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 600ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    .reveal.show {
      opacity: 1;
      transform: translateY(0);
    }

    .stagger-1 {
      transition-delay: 100ms;
    }

    .stagger-2 {
      transition-delay: 200ms;
    }

    .stagger-3 {
      transition-delay: 300ms;
    }

    .stagger-4 {
      transition-delay: 400ms;
    }

    .stagger-5 {
      transition-delay: 500ms;
    }

    /* Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(0, 102, 204, 0.12);
      border: 1px solid rgba(0, 102, 204, 0.25);
      color: var(--primary);
      font-size: 14px;
    }

    .badge-soon {
      background: rgba(255, 200, 87, 0.15);
      border-color: rgba(255, 200, 87, 0.4);
      color: #d97706;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      transition: all 250ms ease;
      z-index: 70;
      display: flex; /* Alterado para flex */
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-card {
      width: 100%;
      border-radius: 20px;
      background: var(--surface-card);
      border: 1px solid var(--border);
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 25px 70px rgba(0, 102, 204, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.5);
      max-height: 90vh; /* Altura mÃ¡xima */
      overflow-y: auto; /* Scroll se necessÃ¡rio */
    }
    
    .modal-card-sm { max-width: 520px; }
    .modal-card-md { max-width: 640px; }
    .modal-card-lg { max-width: 800px; }
    .modal-card-xl { max-width: 1024px; }


    .modal-backdrop.show .modal-card {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    /* Gradient Text */
    .gradient-text {
      background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal), var(--brand-orange));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Blur Blob Decoration */
    .blur-blob {
      position: absolute;
      width: 400px;
      height: 400px;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.15;
      pointer-events: none;
      z-index: -1;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--surface-light);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--brand-blue), var(--brand-teal));
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    
    /* Scrollbar para Modais */
    .modal-card::-webkit-scrollbar-thumb {
      background: var(--brand-purple);
    }

    /* Instructor Avatar */
    .instructor-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid white;
      transition: all 250ms ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .instructor-avatar:hover {
      transform: scale(1.1);
    }

    /* Section Backgrounds */
    .section-light {
      background: var(--surface);
    }

    .section-alt {
      background: linear-gradient(135deg, rgba(0, 102, 204, 0.03), rgba(0, 168, 150, 0.03));
    }

    /* Course Detail Page Styles */
    .course-detail-hero {
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    .course-detail-content {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Admin Panel Styles */
    #admin-panel {
      min-height: 100vh;
      display: flex;
    }
    #admin-nav {
      width: 260px;
      background: #0f172a; /* Dark blue */
      color: #e2e8f0;
    }
    #admin-content {
      flex: 1;
      background: #f1f5f9; /* Light gray */
    }
    .admin-nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      color: #94a3b8;
      font-weight: 600;
      transition: all 200ms ease;
      border-left: 4px solid transparent;
    }
    .admin-nav-link:hover {
      color: #f1f5f9;
      background: #1e293b;
    }
    .admin-nav-link.active {
      color: #fff;
      background: linear-gradient(90deg, rgba(0,102,204,0.3), transparent);
      border-left-color: var(--brand-blue);
    }
    .admin-nav-link .fa-solid {
      width: 20px;
      text-align: center;
    }
    
    /* Admin Table Styles */
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    .admin-table th, .admin-table td {
      padding: 16px 20px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    .admin-table th {
      background: #f8fafc;
      color: #64748b;
      font-size: 12px;
      text-transform: uppercase;
      font-weight: 700;
    }
    .admin-table td {
      color: #334155;
      font-size: 14px;
    }
    .admin-table tbody tr:last-child td {
      border-bottom: none;
    }
    .admin-table tbody tr:hover {
      background: #f1f5f9;
    }
    .admin-table .actions {
      display: flex;
      gap: 10px;
    }
    
    /* Admin Form Fields */
    .admin-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-muted);
    }
    .admin-input, .admin-textarea, .admin-select {
      width: 100%;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 14px;
      color: var(--text);
      background: var(--surface-light);
      transition: all 200ms ease;
    }
    .admin-input:focus, .admin-textarea:focus, .admin-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0,102,204,0.2);
    }
    .admin-textarea {
      min-height: 120px;
      font-family: monospace;
    }
    
    /* Checkbox list */
    .checkbox-list {
      max-height: 150px;
      overflow-y: auto;
      background: var(--surface-light);
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 10px;
    }
    .checkbox-list label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
    }
    .checkbox-list label:hover {
      background: #e2e8f0;
    }
    .checkbox-list input {
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
    }

    /* Toasts (NotificaÃ§Ãµes) */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
    }
    .toast {
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      border: 1px solid rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 12px;
      transform: translateX(120%);
      opacity: 0;
      transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 300px;
    }
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    .toast-success {
      background: #dcfce7;
      color: #166534;
      border-left: 5px solid #22c55e;
    }
    .toast-error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 5px solid #ef4444;
    }
    .toast .icon {
      font-size: 20px;
    }
    .toast-message {
      font-weight: 600;
      flex: 1;
    }
    .toast-close {
      background: transparent;
      border: none;
      color: inherit;
      opacity: 0.6;
      cursor: pointer;
      font-size: 18px;
    }
    .toast-close:hover {
      opacity: 1;
    }
  </style>
</head>

<body class="antialiased">
  <!-- Container de NotificaÃ§Ãµes Toast -->
  <div id="toast-container"></div>
  
  <!-- Scroll Progress Bar -->
  <div id="scroll-progress"></div>

  <!-- Header -->
  <header id="header" class="header-glass">
    <div class="container mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="#" id="logo-link" class="cursor-pointer">
          <img src="https://i.postimg.cc/hvvWCwnk/Prancheta-1-1.png" alt="Logo LIDS" class="h-10 w-auto" />
        </a>
      </div>
      <div class="flex items-center gap-4">
        <!-- BotÃ£o Admin visÃ­vel apenas se logado como admin -->
        <button id="adminBtnHeader" class="btn-ghost text-sm"><i class="fas fa-lock mr-2"></i>Admin</button>
        <!-- BotÃ£o Logout visÃ­vel apenas se logado como admin -->
        <button id="logoutBtnHeader" class="btn-danger text-sm hidden"><i class="fas fa-right-from-bracket mr-2"></i>Logout</button>
      </div>
    </div>
  </header>

  <!-- Main View (Course List) -->
  <div id="main-view">
    <!-- Hero (Tema Escuro) -->
    <section class="hero relative text-white">
      <div class="relative z-10 container mx-auto px-6 py-24 md:py-32">
        <div class="reveal max-w-3xl">
          <span class="badge mb-5" style="background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); color: white;"><i class="fa-solid fa-bolt"></i> InscriÃ§Ãµes Abertas</span>
          <h1 class="text-5xl md:text-7xl font-black leading-tight mb-4" style="color: white;">CapacitaÃ§Ãµes Evereste Academy</h1>
          <p class="text-lg md:text-xl text-slate-200 max-w-2xl mb-8">FormaÃ§Ãµes prÃ¡ticas e focadas em resultados para elevar a excelÃªncia do Instituto Evereste. Profissionalismo, dinamismo e tecnologia a favor do seu desenvolvimento.</p>
          <div class="flex items-center gap-4 flex-wrap">
            <a href="#cursos" class="btn-primary"><i class="fa-solid fa-graduation-cap mr-2"></i> Ver Cursos</a>
          </div>
        </div>
      </div>
      <div class="scroll-indicator text-white text-2xl">
        <i class="fas fa-chevron-down"></i>
      </div>
      <div class="particles" id="particles"></div>
      <img src="https://i.postimg.cc/4xNpxRZJ/capabannerlids.png" alt="Banner" class="absolute inset-0 w-full h-full object-cover opacity-20 pointer-events-none" />
    </section>

    <!-- Cursos DisponÃ­veis -->
    <section id="cursos" class="section-light container mx-auto px-6 py-20 md:py-28 relative">
      <div class="blur-blob" style="background: var(--brand-blue); top: -200px; right: -200px;"></div>
      <div class="blur-blob" style="background: var(--brand-orange); bottom: -200px; left: -200px;"></div>
      
      <!-- Cursos com Vagas Abertas -->
      <div class="reveal text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-black mb-4" style="color: var(--text);">Cursos DisponÃ­veis</h2>
        <p class="text-lg" style="color: var(--text-muted);">InscriÃ§Ãµes abertas para as prÃ³ximas turmas</p>
      </div>
      <div id="courses-list-open" class="grid md:grid-cols-2 gap-8 mb-20">
        <!-- Cards de cursos com status 'aberto' -->
        <p class="text-center md:col-span-2 text-gray-500">A carregar cursos...</p>
      </div>

      <!-- Cursos Futuros -->
      <div class="reveal">
        <h3 class="text-3xl font-bold mb-8 text-center" style="color: var(--text);">Em Breve</h3>
        <div id="courses-list-soon" class="grid md:grid-cols-3 gap-6">
          <!-- Cards de cursos com status 'em_breve' -->
           <p class="text-center md:col-span-3 text-gray-500">A carregar futuros cursos...</p>
        </div>
      </div>
    </section>

    <!-- Instrutores -->
    <section id="instrutores" class="section-alt container mx-auto px-6 py-20 md:py-28">
      <div class="reveal text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-black mb-4" style="color: var(--text);">Nossos Instrutores</h2>
        <p class="text-lg" style="color: var(--text-muted);">Profissionais experientes e apaixonados por ensinar</p>
      </div>
      <div id="instructors-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Cards de instrutores carregados do Firestore -->
        <p class="text-center md:col-span-3 text-gray-500">A carregar instrutores...</p>
      </div>
    </section>

    <!-- Sobre -->
    <section id="sobre" class="section-light container mx-auto px-6 py-20 md:py-28">
      <div class="grid md:grid-cols-2 gap-12 items-center">
        <div class="reveal">
          <h2 class="text-4xl md:text-5xl font-black mb-6" style="color: var(--text);">ExcelÃªncia e Profissionalismo</h2>
          <p class="text-lg mb-6" style="color: var(--text-muted);">O Programa Evereste Academy Ã© uma iniciativa do Instituto Evereste que oferece experiÃªncias imersivas, conteÃºdos aplicados e uma abordagem voltada Ã  prÃ¡tica. Unimos design moderno, tecnologia e didÃ¡tica para acelerar o desenvolvimento.</p>
          <ul class="space-y-4">
            <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Instrutores com experiÃªncia prÃ¡tica</span></li>
            <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">ConteÃºdo atualizado e relevante</span></li>
            <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Foco em resultados e aplicabilidade</span></li>
            <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Certificados reconhecidos</span></li>
          </ul>
        </div>
        <div class="reveal">
          <div class="card-3d p-8">
            <img src="https://i.postimg.cc/SKQh2j5n/logo-evereste-2025-horizontal-2.png" alt="Instituto Evereste" class="w-full h-auto rounded-lg p-6" style="background: rgba(0,102,204,0.03);" />
            <p class="mt-6 text-center font-medium" style="color: var(--text-muted);">Uma iniciativa do Instituto Evereste para formaÃ§Ãµes transformadoras.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="border-t" style="border-color: var(--border); background: var(--surface);">
      <div class="container mx-auto px-6 py-12">
        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
          <div>
            <p class="text-sm" style="color: var(--text-muted);">Â© 2025 Evereste Academy. Todos os direitos reservados.</p>
          </div>
          <div class="flex items-center gap-4">
            <button id="adminBtnFooter" class="btn-ghost text-sm"><i class="fas fa-lock mr-2"></i>Acesso Admin</button>
            <button id="logoutBtnFooter" class="btn-danger text-sm hidden"><i class="fas fa-right-from-bracket mr-2"></i>Logout</button>
            <img src="https://i.postimg.cc/SKQh2j5n/logo-evereste-2025-horizontal-2.png" alt="Instituto Evereste" class="h-8 w-auto" />
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Course Detail View -->
  <div id="course-detail-view" class="hidden">
    <!-- O conteÃºdo dinÃ¢mico serÃ¡ injetado aqui pela funÃ§Ã£o renderCourseDetail() -->
    <p class="text-center p-20">A carregar detalhes do curso...</p>
  </div>
  
  <!-- Admin Panel View -->
  <div id="admin-panel-view" class="hidden">
    <div id="admin-panel">
      <!-- NavegaÃ§Ã£o Lateral do Admin -->
      <nav id="admin-nav" class="flex flex-col flex-shrink-0 p-6">
        <div class="flex items-center gap-3 mb-10 px-4">
          <img src="https://i.postimg.cc/hvvWCwnk/Prancheta-1-1.png" alt="Logo LIDS" class="h-10 w-auto" />
          <span class="font-bold text-lg text-white">Admin</span>
        </div>
        <a href="#dashboard" class="admin-nav-link active" data-target="admin-dashboard">
          <i class="fa-solid fa-chart-line"></i> Dashboard
        </a>
        <a href="#cursos" class="admin-nav-link" data-target="admin-cursos">
          <i class="fa-solid fa-graduation-cap"></i> Cursos
        </a>
        <a href="#matriculas" class="admin-nav-link" data-target="admin-matriculas">
          <i class="fa-solid fa-users"></i> MatrÃ­culas
        </a>
        <a href="#instrutores" class="admin-nav-link" data-target="admin-instrutores">
          <i class="fa-solid fa-chalkboard-user"></i> Instrutores
        </a>
        <a href="#certificados" class="admin-nav-link" data-target="admin-certificados">
          <i class="fa-solid fa-certificate"></i> Certificados
        </a>
        <a href="#config" class="admin-nav-link" data-target="admin-config">
          <i class="fa-solid fa-gear"></i> ConfiguraÃ§Ãµes
        </a>
        <div class="mt-auto">
          <a href="#" id="admin-logout-nav" class="admin-nav-link !border-transparent hover:!bg-red-900/50 hover:!text-red-300">
            <i class="fa-solid fa-right-from-bracket"></i> Sair
          </a>
          <p id="admin-user-email" class="text-xs text-center text-slate-500 mt-4 break-all"></p>
        </div>
      </nav>
      
      <!-- ConteÃºdo Principal do Admin -->
      <main id="admin-content" class="p-10 overflow-y-auto">
        
        <!-- SeÃ§Ã£o Dashboard -->
        <section id="admin-dashboard" class="admin-section">
          <h1 class="text-3xl font-bold mb-8">Dashboard</h1>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card-3d !p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Total MatrÃ­culas</h3>
              <p id="stats-total-enrollments" class="text-3xl font-bold text-blue-600">0</p>
            </div>
            <div class="card-3d !p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Total Check-ins</h3>
              <p id="stats-total-checkins" class="text-3xl font-bold text-teal-600">0</p>
            </div>
            <div class="card-3d !p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Certificados Emitidos</h3>
              <p id="stats-total-certs" class="text-3xl font-bold text-purple-600">0</p>
            </div>
          </div>
          <div class="card-3d !p-6">
            <h3 class="text-lg font-bold mb-4">MatrÃ­culas ao Longo do Tempo</h3>
            <canvas id="enrollmentsChart" height="100"></canvas>
          </div>
        </section>
        
        <!-- SeÃ§Ã£o Cursos -->
        <section id="admin-cursos" class="admin-section hidden">
          <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">GestÃ£o de Cursos</h1>
            <button id="admin-add-course-btn" class="btn-primary"><i class="fas fa-plus mr-2"></i>Adicionar Novo Curso</button>
          </div>
          <div class="overflow-x-auto">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>TÃ­tulo</th>
                  <th>Status</th>
                  <th>Instrutores</th>
                  <th>Data</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="admin-courses-table-body">
                <!-- Linhas de cursos -->
              </tbody>
            </table>
          </div>
        </section>
        
        <!-- SeÃ§Ã£o MatrÃ­culas -->
        <section id="admin-matriculas" class="admin-section hidden">
          <h1 class="text-3xl font-bold mb-8">GestÃ£o de MatrÃ­culas</h1>
          <div class="overflow-x-auto">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Protocolo</th>
                  <th>Aluno</th>
                  <th>E-mail</th>
                  <th>Curso</th>
                  <th>Data</th>
                  <th>Setor</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="admin-enrollments-table-body">
                <!-- Linhas de matrÃ­culas -->
              </tbody>
            </table>
          </div>
        </section>
        
        <!-- SeÃ§Ã£o Instrutores -->
        <section id="admin-instrutores" class="admin-section hidden">
          <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">GestÃ£o de Instrutores</h1>
            <button id="admin-add-instructor-btn" class="btn-primary"><i class="fas fa-plus mr-2"></i>Adicionar Instrutor</button>
          </div>
          <div class="overflow-x-auto">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Foto</th>
                  <th>Nome</th>
                  <th>TÃ­tulo</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="admin-instructors-table-body">
                <!-- Linhas de instrutores -->
              </tbody>
            </table>
          </div>
        </section>
        
        <!-- SeÃ§Ã£o Certificados -->
        <section id="admin-certificados" class="admin-section hidden">
          <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">GestÃ£o de Certificados</h1>
            <button id="admin-add-certificate-btn" class="btn-primary"><i class="fas fa-plus mr-2"></i>Emitir Novo Certificado</button>
          </div>
          <div class="overflow-x-auto">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>ID Certificado</th>
                  <th>Aluno</th>
                  <th>E-mail</th>
                  <th>Curso</th>
                  <th>Data EmissÃ£o</th>
                  <th>Status</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="admin-certificates-table-body">
                <!-- Linhas de certificados -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- SeÃ§Ã£o ConfiguraÃ§Ãµes -->
        <section id="admin-config" class="admin-section hidden">
          <h1 class="text-3xl font-bold mb-8">ConfiguraÃ§Ãµes</h1>
          <div class="card-3d !p-6 max-w-2xl">
            <h3 class="text-lg font-bold mb-4">Senhas de Check-in</h3>
            <p class="text-sm text-gray-500 mb-6">Defina aqui as senhas que os instrutores irÃ£o fornecer aos alunos para o check-in.</p>
            <div id="checkin-passwords-form" class="space-y-4">
              <!-- Campos de senha serÃ£o injetados aqui -->
              <p class="text-sm text-gray-400">A carregar senhas dos cursos...</p>
            </div>
            <button id="save-checkin-passwords-btn" class="btn-primary mt-6"><i class="fas fa-save mr-2"></i>Salvar Senhas</button>
          </div>

          <div class="card-3d !p-6 max-w-2xl mt-8">
            <h3 class="text-lg font-bold mb-4">Popular Banco de Dados</h3>
            <p class="text-sm text-gray-500 mb-6">Se o seu banco de dados estiver vazio, clique aqui para adicionar os dados iniciais dos cursos (Fotografia, IA) e dos instrutores. <strong class="text-red-600">AtenÃ§Ã£o:</strong> Isso pode sobrescrever dados existentes se os IDs forem iguais.</p>
            <button id="populate-db-btn" class="btn-primary"><i class="fas fa-database mr-2"></i>Popular Dados Iniciais</button>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- MODAIS -->

  <!-- Modal Login -->
  <div id="modalLogin" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold" style="color: var(--text);">Acesso Administrativo</h3>
          <p class="text-sm" style="color: var(--text-muted);">Ãrea restrita para gestores</p>
        </div>
        <button id="closeLogin" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="admin-label">E-mail</label>
          <input id="loginEmail" type="email" class="admin-input" placeholder="admin@evereste.org" required />
        </div>
        <div>
          <label class="admin-label">Senha</label>
          <input id="loginPassword" type="password" class="admin-input" placeholder="â¢â¢â¢â¢â¢â¢â¢â¢" required />
        </div>
        <p id="loginError" class="text-red-600 text-sm hidden">Erro ao fazer login.</p>
        <button type="submit" class="btn-primary w-full !py-3 !text-base"><i class="fa-solid fa-right-to-bracket mr-2"></i>Entrar</button>
      </form>
    </div>
  </div>

  <!-- Modal InscriÃ§Ã£o -->
  <div id="modalEnroll" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold" style="color: var(--text);">FormulÃ¡rio de InscriÃ§Ã£o</h3>
          <p class="text-sm" style="color: var(--text-muted);">Inscreva-se no curso: <strong id="enrollCourseName" class="text-blue-600"></strong></p>
        </div>
        <button id="closeEnroll" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="enrollForm" class="space-y-4">
        <div>
          <label class="admin-label">Nome Completo</label>
          <input id="enrollName" type="text" class="admin-input" placeholder="O seu nome" required />
        </div>
        <div>
          <label class="admin-label">E-mail</label>
          <input id="enrollEmail" type="email" class="admin-input" placeholder="voce@email.com" required />
        </div>
        <div>
          <label class="admin-label">Telefone</label>
          <input id="enrollPhone" type="tel" class="admin-input" placeholder="(00) 00000-0000" required />
        </div>
        <div>
          <label class="admin-label">Setor</label>
          <input id="enrollSector" type="text" class="admin-input" placeholder="Ex: ComunicaÃ§Ã£o, PedagÃ³gico..." required />
        </div>
        <p id="enrollError" class="text-red-600 text-sm hidden">Erro ao processar inscriÃ§Ã£o. Tente novamente.</p>
        <button type="submit" class="btn-primary w-full !py-3 !text-base">
          <span id="enrollSubmitBtnText"><i class="fa-solid fa-paper-plane mr-2"></i>Confirmar InscriÃ§Ã£o</span>
          <span id="enrollSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A processar...</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Modal Sucesso InscriÃ§Ã£o (Protocolo) -->
  <div id="modalEnrollSuccess" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8 text-center">
      <div class="text-center">
        <i class="fas fa-check-circle text-6xl text-green-500 mb-6"></i>
        <h3 class="text-2xl font-bold" style="color: var(--text);">InscriÃ§Ã£o Confirmada!</h3>
        <p class="text-base mt-2" style="color: var(--text-muted);">Guarde o seu nÃºmero de protocolo:</p>
        <p id="enrollProtocol" class="text-3xl font-bold text-blue-600 bg-blue-50 border-2 border-blue-200 rounded-lg py-4 my-4"></p>
        <p class="text-sm" style="color: var(--text-muted);">VocÃª receberÃ¡ os detalhes da inscriÃ§Ã£o no seu e-mail.</p>
      </div>
      <button id="closeEnrollSuccess" class="btn-primary w-full mt-6">Fechar</button>
    </div>
  </div>

  <!-- Modal Check-in -->
  <div id="modalCheckin" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold" style="color: var(--text);">Check-in do Curso</h3>
          <p class="text-sm" style="color: var(--text-muted);">Insira a senha fornecida pelo instrutor.</p>
        </div>
        <button id="closeCheckin" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="checkinForm" class="space-y-4">
        <div>
          <label class="admin-label">Senha de Acesso</label>
          <input id="checkinPassword" type="password" class="admin-input" placeholder="â¢â¢â¢â¢â¢â¢â¢â¢" required />
        </div>
        <p id="checkinError" class="text-red-600 text-sm hidden">Senha incorreta. Tente novamente.</p>
        <button type="submit" class="btn-primary w-full !py-3 !text-base">
          <span id="checkinSubmitBtnText">Validar Check-in</span>
          <span id="checkinSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A validar...</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Modal Avaliar Instrutor -->
  <div id="modalRating" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold" style="color: var(--text);">Avaliar Instrutor</h3>
          <p class="text-sm" style="color: var(--text-muted);">O seu feedback Ã© importante para nÃ³s.</p>
        </div>
        <button id="closeRating" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="ratingForm" class="space-y-4">
        <div>
          <label class="admin-label">Selecione o Instrutor</label>
          <select id="ratingInstructorSelect" class="admin-select" required>
            <!-- OpÃ§Ãµes de instrutores -->
          </select>
        </div>
        <div>
          <label class="admin-label">A sua avaliaÃ§Ã£o (1 a 5 estrelas)</label>
          <div id="ratingStars" class="flex text-3xl text-gray-300 cursor-pointer">
            <i class="fa-solid fa-star" data-value="1"></i>
            <i class="fa-solid fa-star" data-value="2"></i>
            <i class="fa-solid fa-star" data-value="3"></i>
            <i class="fa-solid fa-star" data-value="4"></i>
            <i class="fa-solid fa-star" data-value="5"></i>
          </div>
          <input type="hidden" id="ratingValue" value="0" required>
        </div>
         <div>
          <label class="admin-label">ComentÃ¡rio (Opcional)</label>
          <textarea id="ratingComment" class="admin-textarea" rows="3" placeholder="O que achou da didÃ¡tica?"></textarea>
        </div>
        <p id="ratingError" class="text-red-600 text-sm hidden">Erro ao enviar. Tente novamente.</p>
        <button type="submit" class="btn-primary w-full !py-3 !text-base">
          <span id="ratingSubmitBtnText">Enviar AvaliaÃ§Ã£o</span>
          <span id="ratingSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A enviar...</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Modal VerificaÃ§Ã£o de Certificado -->
  <div id="modalCertificateCheck" class="modal-backdrop">
    <div class="modal-card modal-card-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold" style="color: var(--text);">Verificar Certificado</h3>
          <p class="text-sm" style="color: var(--text-muted);">Insira o e-mail que usou na inscriÃ§Ã£o.</p>
        </div>
        <button id="closeCertificateCheck" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="certificateCheckForm" class="space-y-4">
        <div>
          <label class="admin-label">E-mail de InscriÃ§Ã£o</label>
          <input id="certificateCheckEmail" type="email" class="admin-input" placeholder="voce@email.com" required />
        </div>
        <p id="certificateCheckError" class="text-red-600 text-sm hidden"></p>
        <button type="submit" class="btn-primary w-full !py-3 !text-base">
          <span id="certificateCheckSubmitBtnText">Verificar e Baixar</span>
          <span id="certificateCheckSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A verificar...</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Modal Admin: Editar Curso -->
  <div id="modalEditCourse" class="modal-backdrop">
    <div class="modal-card modal-card-xl p-8">
      <div class="flex items-start justify-between mb-6">
        <h3 id="modalCourseTitle" class="text-2xl font-bold" style="color: var(--text);"></h3>
        <button id="closeEditCourse" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="courseForm" class="space-y-6">
        <input type="hidden" id="courseId">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="admin-label" for="courseTitle">TÃ­tulo</label>
            <input class="admin-input" type="text" id="courseTitle" required>
          </div>
          <div>
            <label class="admin-label" for="courseSubtitle">SubtÃ­tulo</label>
            <input class="admin-input" type="text" id="courseSubtitle" required>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label class="admin-label" for="courseThemeColor">Cor (Hex)</label>
            <input class="admin-input" type="text" id="courseThemeColor" placeholder="#FFC107" required>
          </div>
          <div>
            <label class="admin-label" for="courseIcon">Ãcone (FontAwesome)</label>
            <input class="admin-input" type="text" id="courseIcon" placeholder="fa-camera-retro" required>
          </div>
          <div>
            <label class="admin-label" for="courseStatus">Status</label>
            <select id="courseStatus" class="admin-select" required>
              <option value="aberto">Vagas Abertas</option>
              <option value="em_breve">Em Breve</option>
              <option value="fechado">Fechado</option>
            </select>
          </div>
        </div>
         <div>
            <label class="admin-label" for="courseHeaderImage">URL Imagem Capa</label>
            <input class="admin-input" type="text" id="courseHeaderImage" placeholder="https://url-da-imagem.com/capa.jpg" required>
          </div>
        <div>
          <label class="admin-label" for="courseSummary">Resumo (Card)</label>
          <textarea class="admin-textarea" id="courseSummary" rows="2" required></textarea>
        </div>
        <div>
          <label class="admin-label" for="courseFullDescription">DescriÃ§Ã£o Completa</label>
          <textarea class="admin-textarea" id="courseFullDescription" rows="3" required></textarea>
        </div>
        <div>
          <label class="admin-label" for="courseTargetAudience">PÃºblico-alvo</label>
          <textarea class="admin-textarea" id="courseTargetAudience" rows="2" required></textarea>
        </div>
        
        <!-- JSON Fields -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="admin-label" for="courseDetails">Detalhes (JSON)</label>
            <textarea class="admin-textarea" id="courseDetails" rows="5" placeholder='{ "Data": "TBA", "Carga": "4h" }' required></textarea>
          </div>
          <div>
            <label class="admin-label" for="courseLearningObjectives">Objetivos (JSON)</label>
            <textarea class="admin-textarea" id="courseLearningObjectives" rows="5" placeholder='[ "Aprender X", "Fazer Y" ]' required></textarea>
          </div>
          <div>
            <label class="admin-label" for="courseRequirements">Requisitos (JSON)</label>
            <textarea class="admin-textarea" id="courseRequirements" rows="5" placeholder='[ "Trazer notebook", "Saber Z" ]' required></textarea>
          </div>
           <div>
            <label class="admin-label" for="courseModules">MÃ³dulos (JSON)</label>
            <textarea class="admin-textarea" id="courseModules" rows="5" placeholder='[ { "title": "MÃ³dulo 1", "topics": ["TÃ³pico 1"] } ]' required></textarea>
          </div>
          <div class="md:col-span-2">
            <label class="admin-label" for="coursePracticalActivities">Atividades PrÃ¡ticas (JSON)</label>
            <textarea class="admin-textarea" id="coursePracticalActivities" rows="5" placeholder='[ { "title": "Atividade 1", "description": "Fazer X" } ]' required></textarea>
          </div>
        </div>
        
        <!-- Instructors Selection -->
        <div>
          <label class="admin-label">Instrutores</label>
          <div id="courseInstructorsList" class="checkbox-list">
            <!-- Checkboxes de instrutores -->
          </div>
        </div>
        
        <!-- Material Upload -->
        <div>
          <label class="admin-label">Material do Curso (Opcional)</label>
          <p class="text-sm text-gray-500 mb-2">Envie o PDF, ZIP, ou outro material para download. Se jÃ¡ existir um, enviar um novo irÃ¡ substituÃ­-lo.</p>
          <input class="admin-input" type="file" id="courseMaterialFile" accept=".pdf,.zip,.rar,.doc,.docx,.ppt,.pptx,.xls,.xlsx">
          <p id="courseMaterialCurrent" class="text-sm text-gray-500 mt-2"></p>
        </div>

        <p id="courseFormError" class="text-red-600 text-sm hidden">Erro. Verifique os campos.</p>
        
        <div class="flex justify-end gap-4 pt-4">
          <button type="button" id="courseFormCancel" class="btn-ghost">Cancelar</button>
          <button type="submit" class="btn-primary">
            <span id="courseSubmitBtnText">Salvar Curso</span>
            <span id="courseFormSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A salvar...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Admin: Editar Instrutor -->
  <div id="modalEditInstructor" class="modal-backdrop">
    <div class="modal-card modal-card-lg p-8">
      <div class="flex items-start justify-between mb-6">
        <h3 id="modalInstructorTitle" class="text-2xl font-bold" style="color: var(--text);"></h3>
        <button id="closeEditInstructor" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="instructorForm" class="space-y-6">
        <input type="hidden" id="instructorId">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="admin-label" for="instructorName">Nome</label>
            <input class="admin-input" type="text" id="instructorName" required>
          </div>
           <div>
            <label class="admin-label" for="instructorTitle">TÃ­tulo</label>
            <input class="admin-input" type="text" id="instructorTitle" placeholder="Ex: Supervisor de Marketing" required>
          </div>
        </div>
        <div>
            <label class="admin-label" for="instructorImage">URL da Foto</label>
            <input class="admin-input" type="text" id="instructorImage" placeholder="https://url-da-foto.com/perfil.jpg" required>
        </div>
        <div>
          <label class="admin-label" for="instructorBio">Biografia (Card)</label>
          <textarea class="admin-textarea" id="instructorBio" rows="3" placeholder="Pequena descriÃ§Ã£o que aparece no card..."></textarea>
        </div>
        
        <p id="instructorFormError" class="text-red-600 text-sm hidden">Erro. Verifique os campos.</p>
        
        <div class="flex justify-end gap-4 pt-4">
          <button type="button" id="instructorFormCancel" class="btn-ghost">Cancelar</button>
          <button type="submit" class="btn-primary">
            <span id="instructorSubmitBtnText">Salvar Instrutor</span>
            <span id="instructorFormSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A salvar...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Admin: Emitir Certificado -->
  <div id="modalEditCertificate" class="modal-backdrop">
    <div class="modal-card modal-card-lg p-8">
      <div class="flex items-start justify-between mb-6">
        <h3 id="modalCertificateTitle" class="text-2xl font-bold" style="color: var(--text);"></h3>
        <button id="closeEditCertificate" class="btn-ghost !p-2 !text-lg"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="certificateForm" class="space-y-6">
        <input type="hidden" id="certificateId">
        
        <div>
          <label class="admin-label" for="certificateStudentName">Nome do Aluno</label>
          <input class="admin-input" type="text" id="certificateStudentName" placeholder="Nome completo do aluno" required>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="admin-label" for="certificateStudentEmail">E-mail do Aluno (Para VerificaÃ§Ã£o)</label>
            <input class="admin-input" type="email" id="certificateStudentEmail" placeholder="email@aluno.com" required>
          </div>
          <div>
            <label class="admin-label" for="certificateStudentId">ID do Aluno (Opcional)</label>
            <input class="admin-input" type="text" id="certificateStudentId" placeholder="UID do usuÃ¡rio se houver">
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="admin-label" for="certificateCourseName">Nome do Curso</label>
            <input class="admin-input" type="text" id="certificateCourseName" required>
          </div>
          <div>
            <label class="admin-label" for="certificateCourseId">ID do Curso</label>
            <input class="admin-input" type="text" id="certificateCourseId" placeholder="Ex: fotografia" required>
          </div>
        </div>
        <div>
            <label class="admin-label" for="certificateIssuedAt">Data de EmissÃ£o</label>
            <input class="admin-input" type="date" id="certificateIssuedAt" required>
        </div>
        
        <p id="certificateFormError" class="text-red-600 text-sm hidden">Erro. Verifique os campos.</p>
        
        <div class="flex justify-end gap-4 pt-4">
          <button type="button" id="certificateFormCancel" class="btn-ghost">Cancelar</button>
          <button type="submit" class="btn-primary">
            <span id="certificateSubmitBtnText">Salvar Certificado</span>
            <span id="certificateFormSpinner" class="hidden"><i class="fas fa-spinner animate-spin mr-2"></i>A salvar...</span>
          </button>
        </div>
      </form>
    </div>
  </div>


  <!-- SCRIPTS -->

  <!-- Firebase -->
  <script type="module">
    // Importar funÃ§Ãµes do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      signInAnonymously,
      signInWithCustomToken
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      addDoc,
      updateDoc,
      deleteDoc,
      collection,
      query,
      where,
      getDocs,
      onSnapshot,
      Timestamp,
      writeBatch,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
        deleteObject
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

    // === CONFIGURAÃÃO E INICIALIZAÃÃO ===
    
    // ConfiguraÃ§Ã£o do Firebase
    // As variÃ¡veis __firebase_config e __app_id sÃ£o injetadas pelo ambiente.
    let firebaseConfig;
    let appId;

    try {
      // Tenta usar as variÃ¡veis injetadas
      firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
      appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

      // Fallback (plano B) se as variÃ¡veis nÃ£o forem injetadas
      if (!firebaseConfig.apiKey) {
        console.warn("VariÃ¡veis de ambiente nÃ£o encontradas, usando fallback.");
        firebaseConfig = {
          apiKey: "AIzaSyB0xvVzytOx4dumokND-dr926krSO4-CqU",
          authDomain: "academylids.firebaseapp.com",
          projectId: "academylids",
          storageBucket: "academylids.firebasestorage.app",
          messagingSenderId: "826478835273",
          appId: "1:826478835273:web:0995d64419276b932cb198",
          measurementId: "G-T2TN7FL590"
        };
        appId = 'default-app-id'; // Use um appId de fallback se necessÃ¡rio
      }

    } catch (e) {
      console.error("Erro ao parsear configuraÃ§Ã£o do Firebase:", e);
      // Fallback crÃ­tico em caso de erro de parse
      firebaseConfig = {
        apiKey: "AIzaSyB0xvVzytOx4dumokND-dr926krSO4-CqU",
        authDomain: "academylids.firebaseapp.com",
        projectId: "academylids",
        storageBucket: "academylids.firebasestorage.app",
        messagingSenderId: "826478835273",
        appId: "1:826478835273:web:0995d64419276b932cb198",
        measurementId: "G-T2TN7FL590"
      };
      appId = 'default-app-id';
    }

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Estado da AplicaÃ§Ã£o
    let currentUser = null;
    let isAdmin = false;
    let localCourses = []; // Cache local de cursos
    let localInstructors = []; // Cache local de instrutores
    let userCheckins = {}; // Cache de check-ins do usuÃ¡rio
    let currentCourseId = null; // ID do curso na pÃ¡gina de detalhes
    
    // ReferÃªncias de ColeÃ§Ãµes (Baseado nas Regras)
    const coursesCollection = collection(db, `artifacts/${appId}/public/data/courses`);
    const instructorsCollection = collection(db, `artifacts/${appId}/public/data/instructors`);
    const enrollmentsCollection = collection(db, `artifacts/${appId}/public/data/enrollments`);
    const checkinsCollection = collection(db, `artifacts/${appId}/public/data/checkins`);
    const passwordsCollection = collection(db, `artifacts/${appId}/public/data/checkinPasswords`);
    const certificatesCollection = collection(db, `artifacts/${appId}/public/data/certificates`);
    const ratingsCollection = collection(db, `artifacts/${appId}/public/data/ratings`);
    const adminsCollection = collection(db, 'admins'); // ColeÃ§Ã£o raiz

    // === GESTÃO DE ESTADO E UI ===

    // Elementos DOM
    const mainView = document.getElementById('main-view');
    const courseDetailView = document.getElementById('course-detail-view');
    const adminPanelView = document.getElementById('admin-panel-view');
    const coursesListOpen = document.getElementById('courses-list-open');
    const coursesListSoon = document.getElementById('courses-list-soon');
    const instructorsList = document.getElementById('instructors-list');
    
    // BotÃµes de Admin/Logout
    const adminBtnHeader = document.getElementById('adminBtnHeader');
    const logoutBtnHeader = document.getElementById('logoutBtnHeader');
    const adminBtnFooter = document.getElementById('adminBtnFooter');
    const logoutBtnFooter = document.getElementById('logoutBtnFooter');
    const adminLogoutNav = document.getElementById('admin-logout-nav');
    const adminUserEmail = document.getElementById('admin-user-email');

    // Modais
    const modalLogin = document.getElementById('modalLogin');
    const modalEnroll = document.getElementById('modalEnroll');
    const modalEnrollSuccess = document.getElementById('modalEnrollSuccess');
    const modalCheckin = document.getElementById('modalCheckin');
    const modalRating = document.getElementById('modalRating');
    const modalCertificateCheck = document.getElementById('modalCertificateCheck');
    const modalEditCourse = document.getElementById('modalEditCourse');
    const modalEditInstructor = document.getElementById('modalEditInstructor');
    const modalEditCertificate = document.getElementById('modalEditCertificate');

    // FunÃ§Ã£o para mostrar/esconder o painel de Admin
    function setAdminUI(isAdmin) {
      if (isAdmin) {
        adminBtnHeader.textContent = "Painel Admin";
        adminBtnHeader.onclick = () => showView('admin');
        adminBtnFooter.textContent = "Painel Admin";
        adminBtnFooter.onclick = () => showView('admin');
        logoutBtnHeader.classList.remove('hidden');
        logoutBtnFooter.classList.remove('hidden');
        adminUserEmail.textContent = currentUser ? currentUser.email : '';
      } else {
        adminBtnHeader.textContent = "Admin";
        adminBtnHeader.onclick = () => _openModal(modalLogin); // CORRIGIDO
        adminBtnFooter.textContent = "Acesso Admin";
        adminBtnFooter.onclick = () => _openModal(modalLogin); // CORRIGIDO
        logoutBtnHeader.classList.add('hidden');
        logoutBtnFooter.classList.add('hidden');
      }
    }
    
    // FunÃ§Ã£o para navegar entre as vistas
    function showView(viewName) {
      mainView.classList.add('hidden');
      courseDetailView.classList.add('hidden');
      adminPanelView.classList.add('hidden');

      if (viewName === 'main') {
        mainView.classList.remove('hidden');
        window.scrollTo(0, 0);
      } else if (viewName === 'detail') {
        courseDetailView.classList.remove('hidden');
        window.scrollTo(0, 0);
      } else if (viewName === 'admin') {
        if (isAdmin) {
          adminPanelView.classList.remove('hidden');
          window.scrollTo(0, 0);
        } else {
          // Se nÃ£o for admin, volta para a main e abre o login
          mainView.classList.remove('hidden');
          _openModal(modalLogin);
        }
      }
    }

    // FunÃ§Ã£o para mostrar notificaÃ§Ãµes (toast)
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      const iconClass = type === 'success' ? 'fa-check-circle' : 'fa-times-circle';
      toast.className = `toast ${type === 'success' ? 'toast-success' : 'toast-error'}`;
      
      toast.innerHTML = `
        <i class="fas ${iconClass} icon"></i>
        <span class="toast-message">${message}</span>
        <button class="toast-close">&times;</button>
      `;
      
      container.appendChild(toast);
      
      // AnimaÃ§Ã£o de entrada
      setTimeout(() => toast.classList.add('show'), 100);
      
      // Fechar
      const closeBtn = toast.querySelector('.toast-close');
      const closeToast = () => {
        toast.classList.remove('show');
        // Remover da DOM apÃ³s a animaÃ§Ã£o
        setTimeout(() => toast.remove(), 500);
      };
      
      closeBtn.onclick = closeToast;
      // Fechar automaticamente
      setTimeout(closeToast, 5000);
    }

    // === AUTENTICAÃÃO ===

    onAuthStateChanged(auth, async (user) => {
      // Tentativa de login com Custom Token (se injetado)
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token && !auth.currentUser) {
          try {
              console.log("A tentar login com Custom Token...");
              await signInWithCustomToken(auth, __initial_auth_token);
              // O onAuthStateChanged serÃ¡ chamado novamente com o usuÃ¡rio logado
              return; // Saia por agora, deixe o prÃ³ximo onAuthStateChanged tratar
          } catch (error) {
              console.error("Erro no login com Custom Token:", error);
              // Continua para login anÃ´nimo se o token falhar
          }
      }
      
      if (user) {
        // UsuÃ¡rio estÃ¡ logado
        currentUser = user;
        
        if (user.isAnonymous) {
          console.log("UsuÃ¡rio logado anonimamente:", user.uid);
          isAdmin = false;
          setAdminUI(false);
        } else {
          console.log("UsuÃ¡rio logado:", user.email);
          // Ã um usuÃ¡rio com e-mail, verificar se Ã© admin
          await checkAdminStatus(user.uid);
          setAdminUI(isAdmin);
          if (isAdmin) {
            // Se for admin, carrega dados do painel
            loadAdminDashboardData();
          }
        }
        
        // Carregar dados pÃºblicos (cursos, instrutores)
        // Isso agora acontece DEPOIS que a autenticaÃ§Ã£o (anÃ´nima ou nÃ£o) foi estabelecida
        loadCourses();
        loadInstructors();
        
        // Carregar dados privados do usuÃ¡rio (check-ins)
        loadUserCheckins(user.uid);
        
      } else {
        // UsuÃ¡rio estÃ¡ deslogado
        console.log("Nenhum usuÃ¡rio logado. A tentar login anÃ´nimo...");
        currentUser = null;
        isAdmin = false;
        setAdminUI(false);
        
        // Tentar login anÃ´nimo para ter permissÃ£o de leitura
        try {
          await signInAnonymously(auth);
          // O onAuthStateChanged serÃ¡ chamado novamente com o usuÃ¡rio anÃ´nimo
        } catch (error) {
          console.error("Erro no login anÃ´nimo:", error);
          showToast("NÃ£o foi possÃ­vel conectar. Verifique a sua rede.", "error");
        }
      }
    });

    // FunÃ§Ã£o de verificaÃ§Ã£o de Admin
    async function checkAdminStatus(uid) {
      try {
        const adminDocRef = doc(db, 'admins', uid);
        const adminDoc = await getDoc(adminDocRef);
        isAdmin = adminDoc.exists();
        console.log(`Status de Admin para ${uid}: ${isAdmin}`);
      } catch (error) {
        console.error("Erro ao verificar status de admin:", error);
        isAdmin = false;
      }
    }

    // FormulÃ¡rio de Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      
      try {
        errorEl.classList.add('hidden');
        await signInWithEmailAndPassword(auth, email, password);
        // Sucesso! O onAuthStateChanged vai tratar o resto
        _closeModal(modalLogin);
        showView('admin'); // ForÃ§a a ida ao painel admin
        showToast("Login bem-sucedido!", "success");
      } catch (error) {
        console.error("Erro de login:", error.message);
        if (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
          errorEl.textContent = "E-mail ou senha invÃ¡lidos.";
        } else if (error.code === 'auth/operation-not-allowed') {
          errorEl.textContent = "Login por email e senha nÃ£o estÃ¡ ativado no Firebase.";
        } else {
          errorEl.textContent = `Erro: ${error.message}`;
        }
        errorEl.classList.remove('hidden');
      }
    });

    // FunÃ§Ãµes de Logout
    function handleLogout() {
      signOut(auth).then(() => {
        isAdmin = false;
        setAdminUI(false);
        showView('main');
        showToast("Logout efetuado com sucesso.", "success");
      }).catch((error) => {
        console.error("Erro no logout:", error);
        showToast("Erro ao fazer logout.", "error");
      });
    }
    [logoutBtnHeader, logoutBtnFooter, adminLogoutNav].forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        handleLogout();
      });
    });

    // === CARREGAMENTO DE DADOS (PÃGINA PÃBLICA) ===

    // Carregar Cursos
    async function loadCourses() {
      try {
        const querySnapshot = await getDocs(coursesCollection);
        localCourses = [];
        querySnapshot.forEach((doc) => {
          localCourses.push({ id: doc.id, ...doc.data() });
        });
        renderCoursesLists();
      } catch (error) {
        console.error("Erro ao carregar cursos:", error);
        coursesListOpen.innerHTML = `<p class="text-center md:col-span-2 text-red-500">Erro ao carregar cursos: ${error.message}</p>`;
      }
    }

    // Renderizar Cursos nas Listas
    function renderCoursesLists() {
      coursesListOpen.innerHTML = '';
      coursesListSoon.innerHTML = '';
      
      const openCourses = localCourses.filter(c => c.status === 'aberto');
      const soonCourses = localCourses.filter(c => c.status === 'em_breve');

      if (openCourses.length === 0) {
        coursesListOpen.innerHTML = '<p class="text-center md:col-span-2 text-gray-500">Nenhum curso com vagas abertas no momento.</p>';
      } else {
        openCourses.forEach(course => {
          const cardHTML = `
            <article class="card-3d p-8 reveal stagger-1 cursor-pointer course-card-solid" data-course-id="${course.id}" style="background: ${course.themeColor}; color: white;">
              <div class="flex items-center gap-3 mb-4">
                <i class="fa-solid ${course.icon} text-3xl"></i>
                <div>
                  <h3 class="text-2xl font-bold">${course.title}</h3>
                  <p class="text-sm opacity-90">${course.subtitle}</p>
                </div>
              </div>
              <div class="overflow-hidden rounded-lg mb-4">
                <img src="${course.headerOverlayImage}" alt="${course.title}" class="w-full h-48 object-cover opacity-80" />
              </div>
              <p class="mb-6 opacity-90">${course.summary}</p>
              <button class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-bold py-3 px-4 rounded-lg transition-all"><i class="fa-solid fa-arrow-right mr-2"></i>Ver Detalhes</button>
            </article>
          `;
          coursesListOpen.innerHTML += cardHTML;
        });
      }
      
      if (soonCourses.length === 0) {
        coursesListSoon.innerHTML = '<p class="text-center md:col-span-3 text-gray-500">Nenhum curso previsto por enquanto.</p>';
      } else {
         soonCourses.forEach(course => {
           const cardHTML = `
            <div class="card-3d p-6 course-card-solid" style="background: var(--brand-purple);">
              <span class="badge-soon mb-3" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); color: white;"><i class="fa-solid fa-clock mr-2"></i>Em breve</span>
              <h4 class="font-bold text-lg mb-2">${course.title}</h4>
              <p class="text-sm opacity-90">${course.instructors ? course.instructors.map(i => i.name).join(', ') : 'Instrutores a definir'}</p>
            </div>
           `;
           coursesListSoon.innerHTML += cardHTML;
         });
      }
      
      // Re-ativar animaÃ§Ãµes
      _setupRevealAnimations();
    }
    
    // Carregar Instrutores
    async function loadInstructors() {
      try {
        const querySnapshot = await getDocs(instructorsCollection);
        localInstructors = []; // Limpa o cache local
        instructorsList.innerHTML = '';
        
        querySnapshot.forEach((doc) => {
          const inst = { id: doc.id, ...doc.data() };
          localInstructors.push(inst); // Adiciona ao cache
          const cardHTML = `
            <div class="card-3d p-6 reveal stagger-1">
              <img src="${inst.image}" alt="${inst.name}" class="instructor-avatar mx-auto mb-4" style="border-color: var(--brand-blue);"/>
              <h4 class="font-bold text-lg text-center" style="color: var(--text);">${inst.name}</h4>
              <p class="text-sm mt-2 text-center" style="color: var(--text-muted);">${inst.title}</p>
              ${inst.bio ? `<p class="text-xs mt-3 text-center" style="color: var(--text-muted);">${inst.bio}</p>` : ''}
            </div>
          `;
          instructorsList.innerHTML += cardHTML;
        });
        
        if (querySnapshot.empty) {
            instructorsList.innerHTML = '<p class="text-center md:col-span-3 text-gray-500">Nenhum instrutor cadastrado.</p>';
        }
        
      } catch (error) {
        console.error("Erro ao carregar instrutores:", error);
        instructorsList.innerHTML = `<p class="text-center md:col-span-3 text-red-500">Erro ao carregar instrutores: ${error.message}</p>`;
      }
    }

    // Carregar Check-ins do UsuÃ¡rio
    async function loadUserCheckins(uid) {
      if (!uid) return;
      try {
        const q = query(checkinsCollection, where("userId", "==", uid));
        const querySnapshot = await getDocs(q);
        userCheckins = {};
        querySnapshot.forEach((doc) => {
          userCheckins[doc.data().courseId] = true;
        });
        console.log("Check-ins do usuÃ¡rio carregados:", userCheckins);
      } catch (error) {
        console.error("Erro ao carregar check-ins:", error);
      }
    }

    // === PÃGINA DE DETALHES DO CURSO ===
    
    function renderCourseDetail(course) {
      currentCourseId = course.id;
      const themeColor = course.themeColor || '#0066CC';
      const themeColorDark = course.themeColorDark || '#004C99';

      // Gerar HTML dinÃ¢mico
      const detailsHTML = Object.entries(course.details || {}).map(([key, value]) => `
        <div class="flex items-start">
          <i class="fas fa-check mt-1 mr-3" style="color: ${themeColor};"></i>
          <span><strong>${key}:</strong> ${value}</span>
        </div>
      `).join('');

      const instructorsHTML = (course.instructors || []).map(instructor => `
        <div class="flex items-center space-x-4">
          <img class="h-16 w-16 rounded-full object-cover" src="${instructor.image}" alt="${instructor.name}">
          <div>
            <p class="font-bold text-gray-800">${instructor.name}</p>
            <p class="text-sm text-gray-500">${instructor.title}</p>
            ${instructor.bio ? `<p class="text-xs text-gray-400 mt-1">${instructor.bio}</p>` : ''}
          </div>
        </div>
      `).join('');

      const modulesHTML = (course.modules || []).map(module => `
        <div class="bg-gray-50 p-5 rounded-lg border-l-4" style="border-color: ${themeColor};">
          <h4 class="font-bold text-lg" style="color: var(--primary);">${module.title}</h4>
          <ul class="mt-3 space-y-2 list-disc list-inside text-gray-600">
            ${(module.topics || []).map(topic => `<li>${topic}</li>`).join('')}
          </ul>
        </div>
      `).join('');

      const practicalActivitiesHTML = (course.practicalActivities || []).map(activity => `
        <div class="bg-white p-5 rounded-lg border border-gray-200">
          <h4 class="font-bold flex items-center text-lg" style="color: ${themeColor};"><i class="fas fa-flask mr-3"></i>${activity.title}</h4>
          <p class="text-gray-600 mt-2 pl-8">${activity.description}</p>
        </div>
      `).join('');

      // Construir o HTML final da pÃ¡gina
      const courseHTML = `
        <section class="relative text-white py-20 md:py-32 overflow-hidden course-detail-hero" style="background: linear-gradient(-45deg, ${themeColor}, ${themeColorDark}, ${themeColor});">
          <div class="absolute inset-0 bg-cover bg-center opacity-20" style="background-image: url('${course.headerOverlayImage}');"></div>
          <div class="container mx-auto px-6 relative">
            <p class="text-lg font-semibold mb-2"><i class="fas ${course.icon} mr-2"></i>CapacitaÃ§Ã£o Evereste Academy</p>
            <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">${course.title}</h1>
            <p class="mt-2 text-xl md:text-2xl opacity-90">${course.subtitle}</p>
          </div>
        </section>
        
        <div class="container mx-auto px-6 py-16 course-detail-content">
          <button id="back-to-courses-btn" class="mb-12 font-semibold hover:underline" style="color: ${themeColor};">
            <i class="fas fa-arrow-left mr-2"></i>Voltar para todos os cursos
          </button>
          
          <div class="grid lg:grid-cols-3 gap-12">
            <!-- Coluna de ConteÃºdo Principal -->
            <div class="lg:col-span-2">
              <h2 class="text-2xl font-bold text-gray-800 mb-4">Sobre a atividade</h2>
              <p class="text-gray-600 leading-relaxed mb-8">${course.fullDescription}</p>
              
              <h2 class="text-2xl font-bold text-gray-800 mb-4">O que irÃ¡ aprender</h2>
              <ul class="space-y-3 mb-8">${(course.learningObjectives || []).map(obj => `<li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-3" style="color: ${themeColor};"></i><span>${obj}</span></li>`).join('')}</ul>
              
              <h2 class="text-2xl font-bold text-gray-800 mb-6 mt-12">ConteÃºdo ProgramÃ¡tico</h2>
              <div class="space-y-6 mb-12">${modulesHTML}</div>
              
              <h2 class="text-2xl font-bold text-gray-800 mb-6">Atividades PrÃ¡ticas</h2>
              <div class="space-y-4 mb-12">${practicalActivitiesHTML}</div>

              <h2 class="text-2xl font-bold text-gray-800 mb-4">Requisitos</h2>
              <ul class="space-y-3">${(course.requirements || []).map(req => `<li class="flex items-start"><i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i><span>${req}</span></li>`).join('')}</ul>
            </div>
            
            <!-- Coluna Lateral (Sidebar) -->
            <div class="lg:col-span-1">
              <div class="bg-white p-6 rounded-lg shadow-xl sticky top-24">
                <span class="inline-block text-sm font-semibold mb-4 px-3 py-1 rounded-full" style="background-color: ${themeColor}20; color: ${themeColor};">InscriÃ§Ãµes abertas</span>
                <h3 class="text-xl font-bold mb-4" style="color: var(--primary);">${course.title}</h3>
                <div class="space-y-3 mb-6 text-gray-700">${detailsHTML}</div>
                
                <div class="space-y-3 flex flex-col">
                  <button id="enroll-btn-detail" class="btn-primary w-full" style="background: ${themeColor}; border: none;">
                    <i class="fas fa-paper-plane mr-2"></i>Inscreva-se
                  </button>
                  <button id="checkin-btn-detail" class="btn-primary w-full">
                    <i class="fas fa-check-circle mr-2"></i>Fazer Check-in
                  </button>
                  <button id="materials-btn-detail" class="btn-primary w-full btn-disabled">
                    <i class="fas fa-download mr-2"></i>Materiais
                  </button>
                  <button id="rating-btn-detail" class="btn-primary w-full btn-disabled">
                    <i class="fas fa-star mr-2"></i>Avaliar Instrutor
                  </button>
                  <button id="certificate-btn-detail" class="btn-primary w-full">
                    <i class="fas fa-certificate mr-2"></i>Certificado
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="mt-16 pt-8 border-t">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Instrutores</h2>
            <div class="flex flex-col md:flex-row gap-8">${instructorsHTML || 'Nenhum instrutor associado.'}</div>
          </div>
          
          <div class="mt-16 pt-8 border-t">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">PÃºblico-alvo</h2>
            <p class="text-gray-600">${course.targetAudience || 'NÃ£o especificado.'}</p>
          </div>
        </div>
      `;
      
      courseDetailView.innerHTML = courseHTML;
      showView('detail');
      
      // Atualizar estado dos botÃµes (habilitar/desabilitar)
      updateCourseDetailButtons(course);
    }
    
    // Atualizar botÃµes da pÃ¡gina de detalhes (Check-in, Materiais, etc.)
    function updateCourseDetailButtons(course) {
      const hasCheckedIn = userCheckins[course.id];
      const hasMaterials = course.materials && course.materials.length > 0;

      const checkinBtn = document.getElementById('checkin-btn-detail');
      const materialsBtn = document.getElementById('materials-btn-detail');
      const ratingBtn = document.getElementById('rating-btn-detail');
      
      if (hasCheckedIn) {
        checkinBtn.innerHTML = '<i class="fas fa-check-double mr-2"></i>Check-in Realizado';
        checkinBtn.classList.add('btn-disabled');
        
        // Habilitar botÃµes pÃ³s-check-in
        ratingBtn.classList.remove('btn-disabled');
        
        if (hasMaterials) {
          materialsBtn.classList.remove('btn-disabled');
        } else {
          materialsBtn.innerHTML = '<i class="fas fa-times-circle mr-2"></i>Sem Materiais';
        }
        
      } else {
        checkinBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Fazer Check-in';
        checkinBtn.classList.remove('btn-disabled');
        
        materialsBtn.classList.add('btn-disabled');
        ratingBtn.classList.add('btn-disabled');
      }
    }


    // === INTERAÃÃES DO USUÃRIO (Modais PÃºblicos) ===

    // Abrir Modal de InscriÃ§Ã£o
    function openEnrollModal(courseId, courseName) {
      currentCourseId = courseId;
      document.getElementById('enrollCourseName').textContent = courseName;
      document.getElementById('enrollForm').reset();
      document.getElementById('enrollError').classList.add('hidden');
      _openModal(modalEnroll);
    }

    // Submeter InscriÃ§Ã£o
    document.getElementById('enrollForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!currentUser) {
        showToast("Erro: UsuÃ¡rio nÃ£o autenticado.", "error");
        return;
      }
      
      const form = e.target;
      const errorEl = document.getElementById('enrollError');
      const submitBtn = form.querySelector('button[type="submit"]');
      const btnText = document.getElementById('enrollSubmitBtnText');
      const spinner = document.getElementById('enrollSpinner');

      // Mostrar spinner
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');

      try {
        const enrollmentData = {
          userId: currentUser.uid,
          courseId: currentCourseId,
          courseName: document.getElementById('enrollCourseName').textContent,
          name: document.getElementById('enrollName').value,
          email: document.getElementById('enrollEmail').value,
          phone: document.getElementById('enrollPhone').value,
          sector: document.getElementById('enrollSector').value,
          createdAt: serverTimestamp()
        };
        
        const docRef = await addDoc(enrollmentsCollection, enrollmentData);
        
        // Gerar protocolo curto
        const protocol = `EVR-${docRef.id.substring(0, 6).toUpperCase()}`;
        await updateDoc(docRef, { protocol: protocol });
        
        // Mostrar sucesso
        document.getElementById('enrollProtocol').textContent = protocol;
        _closeModal(modalEnroll);
        _openModal(modalEnrollSuccess);
        
      } catch (error) {
        console.error("Erro ao inscrever:", error);
        errorEl.textContent = `Erro ao processar inscriÃ§Ã£o: ${error.message}`;
        errorEl.classList.remove('hidden');
        showToast(`Erro ao processar inscriÃ§Ã£o: ${error.message}`, "error");
      } finally {
        // Esconder spinner
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });

    // Fechar modal de sucesso da inscriÃ§Ã£o
    document.getElementById('closeEnrollSuccess').addEventListener('click', () => _closeModal(modalEnrollSuccess));
    
    // Abrir Modal de Check-in
    function openCheckinModal(courseId) {
      currentCourseId = courseId;
      document.getElementById('checkinForm').reset();
      document.getElementById('checkinError').classList.add('hidden');
      _openModal(modalCheckin);
    }
    
    // Submeter Check-in
    document.getElementById('checkinForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!currentUser) {
        showToast("Erro: UsuÃ¡rio nÃ£o autenticado.", "error");
        return;
      }
      
      const password = document.getElementById('checkinPassword').value;
      const errorEl = document.getElementById('checkinError');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('checkinSubmitBtnText');
      const spinner = document.getElementById('checkinSpinner');

      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');
      
      try {
        // Criar o documento de check-in com a senha
        // As Regras do Firestore (v2) vÃ£o validar a senha
        const checkinData = {
          userId: currentUser.uid,
          courseId: currentCourseId,
          password: password, // A senha Ã© enviada para validaÃ§Ã£o pelas regras
          createdAt: serverTimestamp()
        };
        
        await addDoc(checkinsCollection, checkinData);
        
        // Sucesso!
        userCheckins[currentCourseId] = true;
        const course = localCourses.find(c => c.id === currentCourseId);
        updateCourseDetailButtons(course);
        _closeModal(modalCheckin);
        showToast("Check-in realizado com sucesso!", "success");
        
      } catch (error) {
        console.error("Erro no check-in:", error);
        errorEl.textContent = "Senha incorreta ou erro na validaÃ§Ã£o.";
        if (error.message.includes("permission-denied") || error.message.includes("Permissions")) {
           errorEl.textContent = "Senha incorreta. Tente novamente.";
        } else {
           errorEl.textContent = `Erro: ${error.message}`;
        }
        errorEl.classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });
    
    // Abrir Modal de AvaliaÃ§Ã£o
    function openRatingModal(courseId) {
      currentCourseId = courseId;
      const course = localCourses.find(c => c.id === courseId);
      const select = document.getElementById('ratingInstructorSelect');
      select.innerHTML = '';
      (course.instructors || []).forEach(inst => {
        select.innerHTML += `<option value="${inst.name}">${inst.name}</option>`;
      });
      document.getElementById('ratingForm').reset();
      document.getElementById('ratingError').classList.add('hidden');
      // Resetar estrelas
      _resetRatingStars();
      _openModal(modalRating);
    }
    
    // LÃ³gica das Estrelas
    const ratingStars = document.getElementById('ratingStars');
    ratingStars.addEventListener('click', (e) => {
      if (e.target.classList.contains('fa-star')) {
        const value = e.target.dataset.value;
        document.getElementById('ratingValue').value = value;
        _updateRatingStars(value);
      }
    });
    function _updateRatingStars(value) {
      const stars = ratingStars.querySelectorAll('.fa-star');
      stars.forEach(star => {
        star.classList.remove('text-yellow-400', 'text-gray-300');
        if (star.dataset.value <= value) {
          star.classList.add('text-yellow-400');
        } else {
          star.classList.add('text-gray-300');
        }
      });
    }
    function _resetRatingStars() { _updateRatingStars(0); }
    
    // Submeter AvaliaÃ§Ã£o
    document.getElementById('ratingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!currentUser) {
        showToast("Erro: UsuÃ¡rio nÃ£o autenticado.", "error");
        return;
      }
      
      const ratingValue = document.getElementById('ratingValue').value;
      if (ratingValue === "0") {
         document.getElementById('ratingError').textContent = "Por favor, selecione de 1 a 5 estrelas.";
         document.getElementById('ratingError').classList.remove('hidden');
         return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('ratingSubmitBtnText');
      const spinner = document.getElementById('ratingSpinner');
      
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      document.getElementById('ratingError').classList.add('hidden');
      
      try {
        const ratingData = {
          userId: currentUser.uid,
          courseId: currentCourseId,
          instructorName: document.getElementById('ratingInstructorSelect').value,
          rating: parseInt(ratingValue),
          comment: document.getElementById('ratingComment').value,
          createdAt: serverTimestamp()
        };
        
        await addDoc(ratingsCollection, ratingData);
        
        _closeModal(modalRating);
        showToast("AvaliaÃ§Ã£o enviada com sucesso!", "success");
        
      } catch (error) {
        console.error("Erro ao enviar avaliaÃ§Ã£o:", error);
        document.getElementById('ratingError').textContent = `Erro: ${error.message}`;
        document.getElementById('ratingError').classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });

    // Abrir Modal de VerificaÃ§Ã£o de Certificado
    function openCertificateCheckModal(courseId = null) {
      currentCourseId = courseId;
      document.getElementById('certificateCheckForm').reset();
      document.getElementById('certificateCheckError').classList.add('hidden');
      
      if (courseId) {
        // Esconder o campo de ID do curso se jÃ¡ soubermos qual Ã©
        // (A lÃ³gica foi simplificada para sempre precisar do courseId global)
      } else {
        // LÃ³gica se o botÃ£o for clicado de outro lugar (nÃ£o implementado)
      }
      
      _openModal(modalCertificateCheck);
    }
    
    // Submeter VerificaÃ§Ã£o de Certificado
    document.getElementById('certificateCheckForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('certificateCheckEmail').value;
      const errorEl = document.getElementById('certificateCheckError');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('certificateCheckSubmitBtnText');
      const spinner = document.getElementById('certificateCheckSpinner');
      
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');
      
      try {
        // Consulta pÃºblica permitida pelas regras (v2)
        const q = query(certificatesCollection,
          where("studentEmail", "==", email),
          where("courseId", "==", currentCourseId),
          where("status", "==", "liberado")
        );
        
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
          errorEl.textContent = "Nenhum certificado liberado encontrado para este e-mail e curso.";
          errorEl.classList.remove('hidden');
        } else {
          // Sucesso! Por enquanto, apenas confirma.
          const cert = querySnapshot.docs[0].data();
          console.log("Certificado encontrado:", cert);
          _closeModal(modalCertificateCheck);
          // TODO: Implementar download do PDF
          showToast(`Certificado para ${cert.studentName} encontrado!`, "success");
        }
        
      } catch (error) {
        console.error("Erro ao verificar certificado:", error);
        errorEl.textContent = `Erro: ${error.message}`;
        errorEl.classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });
    
    // Download de Materiais
    function downloadMaterial(courseId) {
      const course = localCourses.find(c => c.id === courseId);
      if (course && course.materials && course.materials.length > 0) {
        // Por enquanto, baixa o primeiro material
        const materialUrl = course.materials[0].url;
        window.open(materialUrl, '_blank');
      } else {
        showToast("Nenhum material disponÃ­vel para este curso.", "error");
      }
    }


    // === PAINEL DE ADMINISTRAÃÃO ===
    
    let enrollmentsChartInstance = null;
    
    // Carregar dados para o Dashboard
    async function loadAdminDashboardData() {
      // Carrega Cursos (para senhas) e MatrÃ­culas (para grÃ¡fico)
      loadAdminCourses(); 
      loadAdminEnrollments(true); // true = carregar dados para o grÃ¡fico
      
      // Carrega Check-ins
      const checkinsSnap = await getDocs(checkinsCollection);
      document.getElementById('stats-total-checkins').textContent = checkinsSnap.size;
      
      // Carrega Certificados
      const certsSnap = await getDocs(certificatesCollection);
      document.getElementById('stats-total-certs').textContent = certsSnap.size;
    }
    
    // Renderizar GrÃ¡fico de MatrÃ­culas
    function renderEnrollmentsChart(enrollments) {
      const ctx = document.getElementById('enrollmentsChart').getContext('2d');
      
      // Agrupar matrÃ­culas por dia
      const enrollmentsByDay = enrollments.reduce((acc, curr) => {
        if (!curr.createdAt) return acc;
        const date = curr.createdAt.toDate().toISOString().split('T')[0];
        acc[date] = (acc[date] || 0) + 1;
        return acc;
      }, {});
      
      const sortedDates = Object.keys(enrollmentsByDay).sort();
      const chartLabels = sortedDates.map(date => {
        const [year, month, day] = date.split('-');
        return `${day}/${month}`;
      });
      const chartData = sortedDates.map(date => enrollmentsByDay[date]);
      
      if (enrollmentsChartInstance) {
        enrollmentsChartInstance.destroy();
      }
      
      enrollmentsChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: chartLabels,
          datasets: [{
            label: 'Novas MatrÃ­culas',
            data: chartData,
            borderColor: 'rgb(0, 102, 204)',
            backgroundColor: 'rgba(0, 102, 204, 0.1)',
            borderWidth: 2,
            tension: 0.1,
            fill: true,
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                 stepSize: 1
              }
            }
          }
        }
      });
    }

    // Carregar Cursos (Admin)
    async function loadAdminCourses() {
      const tbody = document.getElementById('admin-courses-table-body');
      tbody.innerHTML = '<tr><td colspan="5">A carregar...</td></tr>';
      
      const querySnapshot = await getDocs(coursesCollection);
      localCourses = [];
      tbody.innerHTML = '';
      
      if (querySnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="5">Nenhum curso encontrado.</td></tr>';
        return;
      }
      
      querySnapshot.forEach((doc) => {
        const course = { id: doc.id, ...doc.data() };
        localCourses.push(course);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="font-bold">${course.title}</div>
            <div class="text-xs text-gray-500">${course.id}</div>
          </td>
          <td>
            <span class="px-2 py-1 text-xs font-semibold rounded-full ${
              course.status === 'aberto' ? 'bg-green-100 text-green-700' :
              course.status === 'em_breve' ? 'bg-yellow-100 text-yellow-700' :
              'bg-gray-100 text-gray-700'
            }">${course.status}</span>
          </td>
          <td class="text-sm">${(course.instructors || []).map(i => i.name).join(', ') || 'N/A'}</td>
          <td class="text-sm">${course.details?.Data || 'TBA'}</td>
          <td class="actions">
            <button class="btn-edit !p-2" data-id="${course.id}"><i class="fas fa-pencil-alt"></i></button>
            <button class="btn-danger !p-2" data-id="${course.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      // Carregar senhas
      loadCheckinPasswords();
    }
    
    // Carregar MatrÃ­culas (Admin)
    async function loadAdminEnrollments(forChart = false) {
      const tbody = document.getElementById('admin-enrollments-table-body');
      if (!forChart) {
        tbody.innerHTML = '<tr><td colspan="7">A carregar...</td></tr>';
      }
      
      const querySnapshot = await getDocs(enrollmentsCollection);
      const enrollments = [];
      
      if (!forChart) tbody.innerHTML = '';
      
      if (querySnapshot.empty) {
        if (!forChart) tbody.innerHTML = '<tr><td colspan="7">Nenhuma matrÃ­cula encontrada.</td></tr>';
        document.getElementById('stats-total-enrollments').textContent = '0';
        renderEnrollmentsChart([]); // Renderiza grÃ¡fico vazio
        return;
      }
      
      querySnapshot.forEach((doc) => {
        const enrollment = { id: doc.id, ...doc.data() };
        enrollments.push(enrollment);
        
        if (!forChart) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><div class="font-mono text-xs">${enrollment.protocol || enrollment.id}</div></td>
            <td>${enrollment.name}</td>
            <td>${enrollment.email}</td>
            <td>${enrollment.courseName}</td>
            <td>${enrollment.createdAt ? enrollment.createdAt.toDate().toLocaleDateString('pt-PT') : 'N/A'}</td>
            <td>${enrollment.sector}</td>
            <td class="actions">
              <button class="btn-danger !p-2" data-id="${enrollment.id}"><i class="fas fa-trash"></i></button>
            </td>
          `;
          tbody.appendChild(tr);
        }
      });
      
      document.getElementById('stats-total-enrollments').textContent = enrollments.length;
      if (forChart) {
        renderEnrollmentsChart(enrollments);
      }
    }
    
    // Carregar Instrutores (Admin)
    async function loadAdminInstructors() {
      const tbody = document.getElementById('admin-instructors-table-body');
      tbody.innerHTML = '<tr><td colspan="4">A carregar...</td></tr>';
      
      const querySnapshot = await getDocs(instructorsCollection);
      localInstructors = [];
      tbody.innerHTML = '';
      
      if (querySnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="4">Nenhum instrutor encontrado.</td></tr>';
        return;
      }
      
      querySnapshot.forEach((doc) => {
        const inst = { id: doc.id, ...doc.data() };
        localInstructors.push(inst);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${inst.image}" alt="${inst.name}" class="w-12 h-12 rounded-full object-cover"></td>
          <td><div class="font-bold">${inst.name}</div></td>
          <td class="text-sm">${inst.title}</td>
          <td class="actions">
            <button class="btn-edit !p-2" data-id="${inst.id}"><i class="fas fa-pencil-alt"></i></button>
            <button class="btn-danger !p-2" data-id="${inst.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Carregar Certificados (Admin)
    async function loadAdminCertificates() {
      const tbody = document.getElementById('admin-certificates-table-body');
      tbody.innerHTML = '<tr><td colspan="7">A carregar...</td></tr>';
      
      const querySnapshot = await getDocs(certificatesCollection);
      tbody.innerHTML = '';
      
      if (querySnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="7">Nenhum certificado emitido.</td></tr>';
        return;
      }
      
      querySnapshot.forEach((doc) => {
        const cert = { id: doc.id, ...doc.data() };
        const tr = document.createElement('tr');
        const isLiberado = cert.status === 'liberado';
        tr.innerHTML = `
          <td><div class="font-mono text-xs">${cert.id}</div></td>
          <td>${cert.studentName}</td>
          <td>${cert.studentEmail}</td>
          <td>${cert.courseName}</td>
          <td>${cert.issuedAt}</td>
          <td>
             <span class="px-2 py-1 text-xs font-semibold rounded-full ${
              isLiberado ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
            }">${isLiberado ? 'Liberado' : 'Pendente'}</span>
          </td>
          <td class="actions">
            <button class="btn-edit !p-2" data-id="${cert.id}"><i class="fas fa-pencil-alt"></i></button>
            <button class="btn-danger !p-2" data-id="${cert.id}"><i class="fas fa-trash"></i></button>
            ${!isLiberado ? `<button class="btn-primary !p-2 !text-xs !bg-teal-500" data-id="${cert.id}" data-action="release">Liberar</button>` : ''}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    
    // Carregar Senhas de Check-in (Admin)
    async function loadCheckinPasswords() {
      const form = document.getElementById('checkin-passwords-form');
      form.innerHTML = '';
      
      const passwordsDocRef = doc(db, `artifacts/${appId}/public/data/checkinPasswords`, 'allCourses');
      const docSnap = await getDoc(passwordsDocRef);
      const passwords = docSnap.exists() ? docSnap.data() : {};
      
      localCourses.forEach(course => {
        const div = document.createElement('div');
        div.innerHTML = `
          <label class="admin-label" for="pass-${course.id}">${course.title}</label>
          <input type="text" id="pass-${course.id}" data-courseid="${course.id}" class="admin-input" value="${passwords[course.id] || ''}" placeholder="Senha para ${course.title}">
        `;
        form.appendChild(div);
      });
    }
    
    // Salvar Senhas de Check-in
    document.getElementById('save-checkin-passwords-btn').addEventListener('click', async () => {
      const passwords = {};
      const inputs = document.getElementById('checkin-passwords-form').querySelectorAll('input');
      inputs.forEach(input => {
        if (input.value) {
          passwords[input.dataset.courseid] = input.value;
        }
      });
      
      try {
        const passwordsDocRef = doc(db, `artifacts/${appId}/public/data/checkinPasswords`, 'allCourses');
        await setDoc(passwordsDocRef, passwords);
        showToast("Senhas de check-in salvas com sucesso!", "success");
      } catch (error) {
        console.error("Erro ao salvar senhas:", error);
        showToast(`Erro ao salvar senhas: ${error.message}`, "error");
      }
    });

    // === GESTÃO DE FORMULÃRIOS ADMIN (CRUD) ===

    // --- CURSOS ---
    document.getElementById('admin-add-course-btn').addEventListener('click', () => openCourseModal());
    
    function openCourseModal(course = null) {
      const form = document.getElementById('courseForm');
      form.reset();
      document.getElementById('courseFormError').classList.add('hidden');
      document.getElementById('courseMaterialCurrent').textContent = '';
      
      const modalTitle = document.getElementById('modalCourseTitle');
      const courseIdField = document.getElementById('courseId');
      
      if (course) {
        // Editar
        modalTitle.textContent = "Editar Curso";
        courseIdField.value = course.id;
        document.getElementById('courseTitle').value = course.title || '';
        document.getElementById('courseSubtitle').value = course.subtitle || '';
        document.getElementById('courseThemeColor').value = course.themeColor || '';
        document.getElementById('courseIcon').value = course.icon || '';
        document.getElementById('courseStatus').value = course.status || 'fechado';
        document.getElementById('courseHeaderImage').value = course.headerOverlayImage || '';
        document.getElementById('courseSummary').value = course.summary || '';
        document.getElementById('courseFullDescription').value = course.fullDescription || '';
        document.getElementById('courseTargetAudience').value = course.targetAudience || '';
        
        // Campos JSON (com formataÃ§Ã£o bonita)
        document.getElementById('courseDetails').value = JSON.stringify(course.details || {}, null, 2);
        document.getElementById('courseLearningObjectives').value = JSON.stringify(course.learningObjectives || [], null, 2);
        document.getElementById('courseRequirements').value = JSON.stringify(course.requirements || [], null, 2);
        document.getElementById('courseModules').value = JSON.stringify(course.modules || [], null, 2);
        document.getElementById('coursePracticalActivities').value = JSON.stringify(course.practicalActivities || [], null, 2);
        
        if (course.materials && course.materials.length > 0) {
           document.getElementById('courseMaterialCurrent').textContent = `Arquivo atual: ${course.materials[0].name}`;
        }

      } else {
        // Adicionar Novo
        modalTitle.textContent = "Adicionar Novo Curso";
        courseIdField.value = '';
        // Preencher JSONs vazios para facilitar
        document.getElementById('courseDetails').value = '{\n  "Data": "TBA",\n  "Carga": "4h"\n}';
        document.getElementById('courseLearningObjectives').value = '[\n  "Objetivo 1",\n  "Objetivo 2"\n]';
        document.getElementById('courseRequirements').value = '[\n  "Requisito 1"\n]';
        document.getElementById('courseModules').value = '[\n  {\n    "title": "MÃ³dulo 1",\n    "topics": [\n      "TÃ³pico 1.1",\n      "TÃ³pico 1.2"\n    ]\n  }\n]';
        document.getElementById('coursePracticalActivities').value = '[\n  {\n    "title": "Atividade PrÃ¡tica 1",\n    "description": "DescriÃ§Ã£o da atividade."\n  }\n]';
      }
      
      // Popular checkboxes de instrutores
      const instList = document.getElementById('courseInstructorsList');
      instList.innerHTML = '';
      const courseInstructorNames = (course?.instructors || []).map(i => i.name);
      
      localInstructors.forEach(inst => {
        const checked = courseInstructorNames.includes(inst.name) ? 'checked' : '';
        instList.innerHTML += `
          <label>
            <input type="checkbox" value="${inst.id}" ${checked}>
            ${inst.name}
          </label>
        `;
      });
      
      _openModal(modalEditCourse);
    }
    
    document.getElementById('courseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('courseSubmitBtnText');
      const spinner = document.getElementById('courseFormSpinner');
      const errorEl = document.getElementById('courseFormError');
      
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');
      
      const courseId = document.getElementById('courseId').value;
      const fileInput = document.getElementById('courseMaterialFile');
      const file = fileInput.files[0];
      let materialData = null;

      try {
        // --- 1. Validar JSON ---
        let courseData;
        try {
          // Selecionar instrutores marcados
          const selectedInstructorIds = Array.from(document.getElementById('courseInstructorsList').querySelectorAll('input:checked')).map(input => input.value);
          const selectedInstructors = localInstructors
            .filter(inst => selectedInstructorIds.includes(inst.id))
            .map(inst => ({ name: inst.name, title: inst.title, image: inst.image })); // Salva cÃ³pia
            
          courseData = {
            title: document.getElementById('courseTitle').value,
            subtitle: document.getElementById('courseSubtitle').value,
            themeColor: document.getElementById('courseThemeColor').value,
            icon: document.getElementById('courseIcon').value,
            status: document.getElementById('courseStatus').value,
            headerOverlayImage: document.getElementById('courseHeaderImage').value,
            summary: document.getElementById('courseSummary').value,
            fullDescription: document.getElementById('courseFullDescription').value,
            targetAudience: document.getElementById('courseTargetAudience').value,
            // Parsear campos JSON
            details: JSON.parse(document.getElementById('courseDetails').value),
            learningObjectives: JSON.parse(document.getElementById('courseLearningObjectives').value),
            requirements: JSON.parse(document.getElementById('courseRequirements').value),
            modules: JSON.parse(document.getElementById('courseModules').value),
            practicalActivities: JSON.parse(document.getElementById('coursePracticalActivities').value),
            // Adicionar instrutores
            instructors: selectedInstructors
          };
        } catch (jsonError) {
          throw new Error(`Erro de Formato: O formato JSON em um dos campos (MÃ³dulos, Requisitos, etc) estÃ¡ invÃ¡lido. ${jsonError.message}`);
        }
        
        // --- 2. Fazer Upload do Material (se houver) ---
        const finalCourseId = courseId || doc(collection(db, 'temp')).id; // Gera um ID se for novo
        
        if (file) {
          try {
            const storageRef = ref(storage, `materials/${finalCourseId}/${file.name}`);
            const snapshot = await uploadBytes(storageRef, file);
            const downloadURL = await getDownloadURL(snapshot.ref);
            materialData = {
              name: file.name,
              url: downloadURL,
              path: snapshot.ref.fullPath
            };
            courseData.materials = [materialData]; // Substitui materiais existentes
          } catch (uploadError) {
             throw new Error(`Erro de Upload: NÃ£o foi possÃ­vel enviar o material. ${uploadError.message}`);
          }
        }

        // --- 3. Salvar no Firestore ---
        try {
          if (courseId) {
            // Atualizar
            const courseRef = doc(db, `artifacts/${appId}/public/data/courses`, courseId);
            await updateDoc(courseRef, courseData);
          } else {
            // Criar Novo (usando o ID gerado)
            const courseRef = doc(db, `artifacts/${appId}/public/data/courses`, finalCourseId);
            await setDoc(courseRef, courseData);
          }
        } catch (saveError) {
          throw new Error(`Erro ao Salvar: NÃ£o foi possÃ­vel salvar no banco de dados. ${saveError.message}`);
        }
        
        showToast("Curso salvo com sucesso!", "success");
        _closeModal(modalEditCourse);
        loadAdminCourses(); // Recarrega tabela
        loadCourses(); // Recarrega lista pÃºblica
        
      } catch (error) {
        console.error("Erro ao salvar curso:", error);
        errorEl.textContent = error.message; // Mostra o erro especÃ­fico
        errorEl.classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
        fileInput.value = ''; // Limpa o input de arquivo
      }
    });

    // --- INSTRUTORES ---
    document.getElementById('admin-add-instructor-btn').addEventListener('click', () => openInstructorModal());

    function openInstructorModal(instructor = null) {
      const form = document.getElementById('instructorForm');
      form.reset();
      document.getElementById('instructorFormError').classList.add('hidden');
      
      const modalTitle = document.getElementById('modalInstructorTitle');
      const instructorIdField = document.getElementById('instructorId');
      
      if (instructor) {
        // Editar
        modalTitle.textContent = "Editar Instrutor";
        instructorIdField.value = instructor.id;
        document.getElementById('instructorName').value = instructor.name || '';
        document.getElementById('instructorTitle').value = instructor.title || '';
        document.getElementById('instructorImage').value = instructor.image || '';
        document.getElementById('instructorBio').value = instructor.bio || '';
      } else {
        // Adicionar Novo
        modalTitle.textContent = "Adicionar Novo Instrutor";
        instructorIdField.value = '';
      }
      _openModal(modalEditInstructor);
    }
    
    document.getElementById('instructorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('instructorSubmitBtnText');
      const spinner = document.getElementById('instructorFormSpinner');
      const errorEl = document.getElementById('instructorFormError');
      
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');
      
      const instructorId = document.getElementById('instructorId').value;
      const instructorData = {
        name: document.getElementById('instructorName').value,
        title: document.getElementById('instructorTitle').value,
        image: document.getElementById('instructorImage').value,
        bio: document.getElementById('instructorBio').value
      };
      
      try {
        if (instructorId) {
          // Atualizar
          const instRef = doc(db, `artifacts/${appId}/public/data/instructors`, instructorId);
          await updateDoc(instRef, instructorData);
        } else {
          // Criar Novo
          await addDoc(instructorsCollection, instructorData);
        }
        
        showToast("Instrutor salvo com sucesso!", "success");
        _closeModal(modalEditInstructor);
        loadAdminInstructors(); // Recarrega tabela
        loadInstructors(); // Recarrega lista pÃºblica
        
      } catch (error) {
        console.error("Erro ao salvar instrutor:", error);
        errorEl.textContent = `Erro: ${error.message}`;
        errorEl.classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });

    // --- CERTIFICADOS ---
    document.getElementById('admin-add-certificate-btn').addEventListener('click', () => openCertificateModal());
    
    function openCertificateModal(cert = null) {
      const form = document.getElementById('certificateForm');
      form.reset();
      document.getElementById('certificateFormError').classList.add('hidden');
      
      const modalTitle = document.getElementById('modalCertificateTitle');
      const certificateIdField = document.getElementById('certificateId');
      
      if (cert) {
        // Editar
        modalTitle.textContent = "Editar Certificado";
        certificateIdField.value = cert.id;
        document.getElementById('certificateStudentName').value = cert.studentName || '';
        document.getElementById('certificateStudentEmail').value = cert.studentEmail || '';
        document.getElementById('certificateStudentId').value = cert.studentId || '';
        document.getElementById('certificateCourseName').value = cert.courseName || '';
        document.getElementById('certificateCourseId').value = cert.courseId || '';
        document.getElementById('certificateIssuedAt').value = cert.issuedAt || '';
      } else {
        // Adicionar Novo
        modalTitle.textContent = "Emitir Novo Certificado";
        certificateIdField.value = '';
        // Preencher data atual
        document.getElementById('certificateIssuedAt').value = new Date().toISOString().split('T')[0];
      }
      _openModal(modalEditCertificate);
    }
    
    document.getElementById('certificateForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const btnText = document.getElementById('certificateSubmitBtnText');
      const spinner = document.getElementById('certificateFormSpinner');
      const errorEl = document.getElementById('certificateFormError');
      
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');
      
      const certificateId = document.getElementById('certificateId').value;
      const certificateData = {
        studentName: document.getElementById('certificateStudentName').value,
        studentEmail: document.getElementById('certificateStudentEmail').value,
        studentId: document.getElementById('certificateStudentId').value,
        courseName: document.getElementById('certificateCourseName').value,
        courseId: document.getElementById('certificateCourseId').value,
        issuedAt: document.getElementById('certificateIssuedAt').value,
        status: 'pendente' // Sempre pendente ao criar/editar
      };
      
      try {
        if (certificateId) {
          // Atualizar
          const certRef = doc(db, `artifacts/${appId}/public/data/certificates`, certificateId);
          await updateDoc(certRef, certificateData);
        } else {
          // Criar Novo
          await addDoc(certificatesCollection, certificateData);
        }
        
        showToast("Certificado salvo com sucesso!", "success");
        _closeModal(modalEditCertificate);
        loadAdminCertificates(); // Recarrega tabela
        
      } catch (error) {
        console.error("Erro ao salvar certificado:", error);
        errorEl.textContent = `Erro: ${error.message}`;
        errorEl.classList.remove('hidden');
      } finally {
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });
    
    // Liberar Certificado
    async function releaseCertificate(id) {
      if (!confirm("Tem certeza que deseja liberar este certificado?")) return;
      
      try {
        const certRef = doc(db, `artifacts/${appId}/public/data/certificates`, id);
        await updateDoc(certRef, { status: 'liberado' });
        showToast("Certificado liberado!", "success");
        loadAdminCertificates();
      } catch (error) {
        console.error("Erro ao liberar certificado:", error);
        showToast(`Erro: ${error.message}`, "error");
      }
    }
    
    // === GESTÃO DE CLIQUES (Event Delegation) ===
    
    // Cliques na PÃ¡gina Principal
    document.getElementById('main-view').addEventListener('click', (e) => {
      // Abrir Modal de Admin
      if (e.target.closest('#adminBtnHeader') || e.target.closest('#adminBtnFooter')) {
        if (!isAdmin) {
          _openModal(modalLogin);
        } else {
          showView('admin');
        }
      }
      
      // Abrir detalhes do curso
      const card = e.target.closest('[data-course-id]');
      if (card) {
        const courseId = card.dataset.courseId;
        const course = localCourses.find(c => c.id === courseId);
        if (course) renderCourseDetail(course);
      }
    });

    // Cliques na PÃ¡gina de Detalhes
    courseDetailView.addEventListener('click', (e) => {
      const course = localCourses.find(c => c.id === currentCourseId);
      if (!course) return;
      
      // Voltar
      if (e.target.closest('#back-to-courses-btn')) {
        showView('main');
      }
      // Inscrever-se
      if (e.target.closest('#enroll-btn-detail')) {
        openEnrollModal(course.id, course.title);
      }
      // Check-in
      if (e.target.closest('#checkin-btn-detail') && !e.target.closest('.btn-disabled')) {
        openCheckinModal(course.id);
      }
      // Materiais
      if (e.target.closest('#materials-btn-detail') && !e.target.closest('.btn-disabled')) {
        downloadMaterial(course.id);
      }
      // Avaliar
      if (e.target.closest('#rating-btn-detail') && !e.target.closest('.btn-disabled')) {
        openRatingModal(course.id);
      }
      // Certificado
      if (e.target.closest('#certificate-btn-detail')) {
        openCertificateCheckModal(course.id);
      }
    });
    
    // Cliques no Painel de Admin
    adminPanelView.addEventListener('click', async (e) => {
      // NavegaÃ§Ã£o
      const navLink = e.target.closest('.admin-nav-link');
      if (navLink && navLink.dataset.target) {
        e.preventDefault();
        // UI
        document.querySelectorAll('.admin-nav-link').forEach(link => link.classList.remove('active'));
        navLink.classList.add('active');
        document.querySelectorAll('.admin-section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(navLink.dataset.target).classList.remove('hidden');
        
        // Carregar dados da aba
        switch(navLink.dataset.target) {
          case 'admin-dashboard': loadAdminDashboardData(); break;
          case 'admin-cursos': loadAdminCourses(); break;
          case 'admin-matriculas': loadAdminEnrollments(); break;
          case 'admin-instrutores': loadAdminInstructors(); break;
          case 'admin-certificados': loadAdminCertificates(); break;
          case 'admin-config': loadCheckinPasswords(); break;
        }
      }
      
      // AÃ§Ãµes na tabela de Cursos
      const courseEditBtn = e.target.closest('#admin-cursos .btn-edit');
      if (courseEditBtn) {
        const course = localCourses.find(c => c.id === courseEditBtn.dataset.id);
        if (course) openCourseModal(course);
      }
      const courseDeleteBtn = e.target.closest('#admin-cursos .btn-danger');
      if (courseDeleteBtn) {
        // TODO: Adicionar lÃ³gica de deleÃ§Ã£o
        showToast("FunÃ§Ã£o de deletar ainda nÃ£o implementada.", "error");
      }
      
      // AÃ§Ãµes na tabela de Instrutores
      const instEditBtn = e.target.closest('#admin-instrutores .btn-edit');
      if (instEditBtn) {
        const instructor = localInstructors.find(i => i.id === instEditBtn.dataset.id);
        if (instructor) openInstructorModal(instructor);
      }
      
      // AÃ§Ãµes na tabela de Certificados
      const certEditBtn = e.target.closest('#admin-certificados .btn-edit');
      if (certEditBtn) {
        // TODO: Carregar dados do certificado para ediÃ§Ã£o
        // const cert = ...
        // openCertificateModal(cert);
        showToast("FunÃ§Ã£o de editar certificado ainda nÃ£o implementada.", "error");
      }
      const certReleaseBtn = e.target.closest('#admin-certificados [data-action="release"]');
      if (certReleaseBtn) {
        releaseCertificate(certReleaseBtn.dataset.id);
      }
      
    });


    // === FUNÃÃES DE INICIALIZAÃÃO E HELPERS ===
    
    // Fechar Modais (GenÃ©rico)
    function _openModal(modalEl) {
      modalEl.classList.add('show');
    }
    function _closeModal(modalEl) {
      modalEl.classList.remove('show');
    }
    document.querySelectorAll('.modal-backdrop').forEach(modal => {
      // Fechar no clique do fundo
      modal.addEventListener('click', (e) => {
        if (e.target === modal) _closeModal(modal);
      });
    });
    // BotÃµes de fechar
    document.getElementById('closeLogin').addEventListener('click', () => _closeModal(modalLogin));
    document.getElementById('closeEnroll').addEventListener('click', () => _closeModal(modalEnroll));
    document.getElementById('closeCheckin').addEventListener('click', () => _closeModal(modalCheckin));
    document.getElementById('closeRating').addEventListener('click', () => _closeModal(modalRating));
    document.getElementById('closeCertificateCheck').addEventListener('click', () => _closeModal(modalCertificateCheck));
    document.getElementById('closeEditCourse').addEventListener('click', () => _closeModal(modalEditCourse));
    document.getElementById('courseFormCancel').addEventListener('click', () => _closeModal(modalEditCourse));
    document.getElementById('closeEditInstructor').addEventListener('click', () => _closeModal(modalEditInstructor));
    document.getElementById('instructorFormCancel').addEventListener('click', () => _closeModal(modalEditInstructor));
    document.getElementById('closeEditCertificate').addEventListener('click', () => _closeModal(modalEditCertificate));
    document.getElementById('certificateFormCancel').addEventListener('click', () => _closeModal(modalEditCertificate));

    
    // AnimaÃ§Ã£o de Scroll (Reveal)
    function _setupRevealAnimations() {
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) e.target.classList.add('show');
        });
      }, { threshold: 0.1 });
      document.querySelectorAll('.reveal').forEach(el => io.observe(el));
    }

    // Scroll Progress
    const scrollProgress = document.getElementById('scroll-progress');
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const st = h.scrollTop || document.body.scrollTop;
      const sh = h.scrollHeight || document.body.scrollHeight;
      const percent = (st / (sh - h.clientHeight)) * 100;
      scrollProgress.style.width = percent + '%';
    });

    // Header Scroll
    const header = document.getElementById('header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 10) header.classList.add('header-scrolled');
      else header.classList.remove('header-scrolled');
    });

    // Particles
    const particles = document.getElementById('particles');
    if (particles) {
      const createParticle = () => {
        const s = document.createElement('span');
        s.style.left = Math.random() * 100 + 'vw';
        s.style.bottom = '-10px';
        s.style.width = (Math.random() * 2 + 1) + 'px';
        s.style.height = (Math.random() * 2 + 1) + 'px';
        s.style.animationDelay = Math.random() * 8 + 's';
        particles.appendChild(s);
        setTimeout(() => s.remove(), 14000);
      };
      for (let i = 0; i < 60; i++) createParticle();
      setInterval(createParticle, 600);
    }
    
    // Logo click
    document.getElementById('logo-link').addEventListener('click', (e) => {
      e.preventDefault();
      showView('main');
    });
    
    // --- POPULAR DADOS (Admin) ---
    document.getElementById('populate-db-btn').addEventListener('click', async () => {
      if (!confirm("Tem certeza que deseja popular o banco de dados? Isso pode sobrescrever dados!")) return;
      
      const batch = writeBatch(db);
      
      // Dados dos Instrutores
      const instructorsData = [
        { id: "marllon", name: "Marllon Costa", title: "TÃ©cnico em Tecnologia da InformaÃ§Ã£o | Designer | Marketing | InovaÃ§Ã£o e IA", image: "https://i.postimg.cc/sxm4TVvF/IMG-9781.jpg", bio: "Designer grÃ¡fico, graduando em marketing e autodidata em InovaÃ§Ã£o e IA. Trabalha e estuda sobre IA desde 2021, aplicando o conhecimento em tempo real e construindo um amplo conhecimento sobre ferramentas e engenharia de prompt." },
        { id: "vinicius", name: "VinÃ­cius Sena", title: "FotÃ³grafo Documental/Eventos | AnimaÃ§Ã£o | PÃ³s-produÃ§Ã£o Audiovisual", image: "https://i.postimg.cc/bw7kHG3D/vinicius.jpg", bio: "Formado em AnimaÃ§Ã£o, estudante e entusiasta de fotografia desde 2019, trabalha com pÃ³s-produÃ§Ã£o de imagens e conteÃºdo audiovisual (Fotos e VÃ­deos). FotÃ³grafo Documental/Eventos." },
        { id: "bruno", name: "Bruno Diogo", title: "Supervisor de Marketing e MÃ­dias Visuais | Designer GrÃ¡fico e Digital | UX & UI | ð¸ Fotografia", image: "https://i.postimg.cc/yNhgmLJK/IMG-7311.avif", bio: "" },
        { id: "keven", name: "Keven Menezes", title: "Analista de TI | Designer GrÃ¡fico | Motion Design | Identidade de Marca", image: "https://i.postimg.cc/fTgkcmpP/Whats-App-Image-2025-10-27-at-12-11-25.jpg", bio: "Formado em Design GrÃ¡fico e possui mais de 5 anos de experiÃªncia em criaÃ§Ã£o visual e motion design. JÃ¡ desenvolveu identidades de marca e animaÃ§Ãµes para empresas como a JSK, uma das maiores hamburguerias de Manaus. Atualmente, atua como Analista de Tecnologia da InformaÃ§Ã£o no Instituto Evereste, integrando design, estratÃ©gia e tecnologia." },
        { id: "deyse", name: "Deyse Pereira", title: "Estrategista em ComunicaÃ§Ã£o, Design e GestÃ£o de Projetos | Metodologias Ãgeis", image: "https://i.postimg.cc/T1sL3bXz/IMG-7381-jpg.png", bio: "Mestre em Design de Artefatos Digitais, pÃ³s-graduanda em GestÃ£o de Projetos e Metodologias Ãgeis, e coordenadora de ComunicaÃ§Ã£o Social, com experiÃªncia em ComunicaÃ§Ã£o Institucional e Design EstratÃ©gico." }
      ];
      
      instructorsData.forEach(inst => {
        const ref = doc(db, `artifacts/${appId}/public/data/instructors`, inst.id);
        batch.set(ref, inst);
      });
      
      // Dados dos Cursos
      const coursesData = [
          {
            id: "fotografia",
            status: "aberto",
            themeColor: "#FFC107",
            themeColorDark: "#E6A700",
            headerOverlayImage: "https://i.postimg.cc/3rLTy2xn/medium-shot-people-with-camera.jpg",
            icon: "fa-camera-retro",
            title: "Workshop de Fotografia",
            subtitle: "O Olhar que Conecta HistÃ³rias",
            summary: "Aprenda a capturar a essÃªncia dos nossos projetos com sensibilidade e tÃ©cnica. Este workshop oferece as ferramentas para transformar o registo de atividades institucionais.",
            fullDescription: "No Instituto Evereste, cada imagem conta uma parte da nossa histÃ³ria. Este workshop Ã© um convite para desenvolver a sua percepÃ§Ã£o e criatividade, capacitando-o a registar os nossos eventos e projetos com a qualidade e profissionalismo que eles merecem. Mais do que tÃ©cnica, aprenderÃ¡ a contar histÃ³rias que conectam e inspiram atravÃ©s das suas lentes.",
            learningObjectives: [
              "Introduzir conceitos bÃ¡sicos de fotografia (composiÃ§Ã£o, iluminaÃ§Ã£o, enquadramento).",
              "Desenvolver habilidades prÃ¡ticas em fotografia com cÃ¢maras e celulares.",
              "Capacitar para o registo de eventos e projetos com qualidade profissional.",
              "Promover a criatividade e a percepÃ§Ã£o estÃ©tica.",
            ],
            modules: [
              { title: "MÃ³dulo 1: Fundamentos e Equipamento", topics: ["IntroduÃ§Ã£o Ã  histÃ³ria e ao impacto da fotografia.", "Dominando o corpo da cÃ¢mera: visor, obturador, diafragma e fotÃ´metro.", "Entendendo ISO, lentes e o uso do flash.", "Controle de exposiÃ§Ã£o e balanÃ§o de branco."] },
              { title: "MÃ³dulo 2: ComposiÃ§Ã£o e IluminaÃ§Ã£o", topics: ["A arte do enquadramento: planos, Ã¢ngulos e lados.", "Trabalhando com a luz: compreendendo luz dura e luz suave.", "PrincÃ­pios de composiÃ§Ã£o de imagens: regra dos terÃ§os, formas e cores.", "Criando profundidade e perspectiva nas suas fotos."] },
              { title: "MÃ³dulo 3: EdiÃ§Ã£o e PÃ³s-ProduÃ§Ã£o", topics: ["IntroduÃ§Ã£o Ã  ediÃ§Ã£o e pÃ³s-produÃ§Ã£o no Lightroom.", "AnÃ¡lise do histograma e correÃ§Ã£o de cores.", "Definindo a intenÃ§Ã£o narrativa da sua fotografia.", "ExercÃ­cios prÃ¡ticos para aplicar todos os conceitos."] }
            ],
            requirements: ["NÃ£o sÃ£o necessÃ¡rios prÃ©-requisitos, apenas vontade de aprender.", "Incentivamos a trazer o seu prÃ³prio smartphone ou cÃ¢mara."],
            targetAudience: "O Curso de Fotografia Ã© voltado para pessoas que desejam explorar o poder da imagem como forma de expressÃ£o, comunicaÃ§Ã£o e transformaÃ§Ã£o social. Destina-se a jovens, estudantes, profissionais da Ã¡rea criativa, comunicadores e entusiastas da fotografia, que buscam desenvolver um olhar tÃ©cnico e artÃ­stico para capturar histÃ³rias, emoÃ§Ãµes e realidades por meio da lente.",
            instructors: [
              { name: "Bruno Diogo", title: "Supervisor de Marketing e MÃ­dias Visuais | Designer GrÃ¡fico e Digital | UX & UI | ð¸ Fotografia", image: "https://i.postimg.cc/yNhgmLJK/IMG-7311.avif" },
              { name: "VinÃ­cius Sena", title: "FotÃ³grafo Documental/Eventos | AnimaÃ§Ã£o | PÃ³s-produÃ§Ã£o Audiovisual", image: "https://i.postimg.cc/bw7kHG3D/vinicius.jpg" }
            ],
            details: { "Data": "28 de Outubro de 2025", "HorÃ¡rio": "08:30h - 12:15h", "Carga": "4 horas", "Certificado": "Sim", "Modalidade": "Presencial e Online" },
            practicalActivities: [
              { title: "ExercÃ­cio de Teste: Contando uma HistÃ³ria", description: "Em duplas, os participantes tiram 3 fotos um do outro para se acostumarem com os equipamentos e explorarem a narrativa visual." },
              { title: "ExercÃ­cio de Conhecimento: Dominando a Luz", description: "Os participantes tiram 3-5 fotos com diferentes tipos de iluminaÃ§Ã£o para entender na prÃ¡tica os conceitos de luz, sombra e intencionalidade." },
              { title: "ExercÃ­cio PrÃ¡tico Transversal: A EvoluÃ§Ã£o", description: "As duplas refazem as fotos do primeiro exercÃ­cio, agora aplicando todos os conceitos aprendidos, para comparar e observar a sua evoluÃ§Ã£o." }
            ]
          },
          {
            id: "ia",
            status: "aberto",
            themeColor: "#4CAF50",
            themeColorDark: "#388E3C",
            headerOverlayImage: "https://i.postimg.cc/bv25v2BZ/relat-rio-1.png",
            icon: "fa-brain",
            title: "IA Aplicada Ã  AnÃ¡lise de Dados",
            subtitle: "Do RelatÃ³rio ao Insight",
            summary: "Transforme relatÃ³rios e dados brutos em dashboards web interativos e de alto impacto. Capacite-se para tomar decisÃµes estratÃ©gicas com mais clareza e agilidade.",
            fullDescription: "Num mundo movido por dados, a capacidade de extrair insights rÃ¡pidos Ã© um superpoder. Com o 'MÃ©todo Evereste Ãgil', este curso vai desmistificar a IA e dar-lhe a autonomia para converter nÃºmeros complexos em apresentaÃ§Ãµes dinÃ¢micas e convincentes. Deixe de ser um espectador de relatÃ³rios e torne-se um protagonista na tomada de decisÃµes estratÃ©gicas da nossa instituiÃ§Ã£o.",
            learningObjectives: ["Formular prompts eficazes no Gemini para gerar cÃ³digos de dashboards.", "Publicar um dashboard interativo na web utilizando o GitHub Pages.", "Estruturar uma apresentaÃ§Ã£o de resultados de alto impacto.", "Adotar uma cultura de anÃ¡lise de dados Ã¡gil e orientada Ã  aÃ§Ã£o."],
            modules: [
              { title: "MÃ³dulo 1: Fundamentos e GeraÃ§Ã£o de CÃ³digo", topics: ["Os 3 pilares do MÃ©todo Evereste Ãgil.", "IntroduÃ§Ã£o Ã s ferramentas de inteligÃªncia artificial.", "O desafio da gestÃ£o moderna na anÃ¡lise de resultados.", "Oficina PrÃ¡tica: Construindo o prompt perfeito para o seu dashboard."] },
              { title: "MÃ³dulo 2: PublicaÃ§Ã£o e Interatividade", topics: ["Desmistificando o GitHub: repositÃ³rios e o serviÃ§o GitHub Pages.", "Oficina PrÃ¡tica: Publicando o seu primeiro dashboard interativo na web.", "AnÃ¡lise e refinamento: como fazer pequenas alteraÃ§Ãµes e atualizar o seu projeto."] },
              { title: "MÃ³dulo 3: ApresentaÃ§Ã£o EstratÃ©gica e Encerramento", topics: ["TÃ©cnicas para apresentar resultados usando um dashboard dinÃ¢mico.", "SimulaÃ§Ã£o de apresentaÃ§Ã£o para a diretoria.", "PrÃ³ximos passos para aplicar o mÃ©todo no dia a dia.", "Transformando a cultura de apresentaÃ§Ã£o de resultados."] }
            ],
            requirements: ["Ã indispensÃ¡vel ter um notebook para participar nas atividades prÃ¡ticas.", "Computador com acesso Ã  internet.", "Conta Google para acesso ao Gemini.", "Conta gratuita no ChatGPT.", "Conta no GitHub (pode ser criada durante o curso)."],
            targetAudience: "Para todos os colaboradores, entusiastas de tecnologia e qualquer pessoa curiosa sobre o poder da inteligÃªncia artificial para simplificar tarefas. NÃ£o Ã© necessÃ¡rio conhecimento prÃ©vio, apenas vontade de inovar.",
            instructors: [
              { name: "Marllon Costa", title: "TÃ©cnico em Tecnologia da InformaÃ§Ã£o | Designer | Marketing | InovaÃ§Ã£o e IA", image: "https://i.postimg.cc/sxm4TVvF/IMG-9781.jpg" }
            ],
            details: { "Data": "06 de Novembro de 2025", "Carga": "4 horas", "Certificado": "Sim", "Modalidade": "Presencial ou Online", "PÃºblico": "Livre" },
            practicalActivities: [
              { title: "Oficina PrÃ¡tica 1: O Prompt Perfeito", description: "Os participantes recebem um relatÃ³rio de exemplo e, com orientaÃ§Ã£o, devem construir um prompt detalhado no Gemini para solicitar um dashboard." },
              { title: "Oficina PrÃ¡tica 2: O Seu Primeiro Dashboard no Ar", description: "Passo a passo guiado onde cada participante irÃ¡ criar um repositÃ³rio no GitHub, copiar o cÃ³digo do Gemini e publicar o seu dashboard online." },
              { title: "SimulaÃ§Ã£o de ApresentaÃ§Ã£o", description: "VoluntÃ¡rios apresentam o seu dashboard como se estivessem a falar para a diretoria, recebendo feedback construtivo." }
            ]
          }
      ];
      
      coursesData.forEach(course => {
        const ref = doc(db, `artifacts/${appId}/public/data/courses`, course.id);
        batch.set(ref, course);
      });
      
      try {
        await batch.commit();
        showToast("Banco de dados populado com sucesso!", "success");
        // Recarregar tudo
        loadCourses();
        loadInstructors();
        loadAdminCourses();
        loadAdminInstructors();
      } catch (error) {
        console.error("Erro ao popular banco de dados:", error);
        showToast(`Erro ao popular dados: ${error.message}`, "error");
      }
    });

  </script>
</body>
</html>

