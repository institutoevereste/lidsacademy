<!DOCTYPE html>
<html lang="pt-pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Evereste Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Estilos CSS -->
  <style>
    :root {
    /* Cores do Logo LIDS */
    --brand-blue: #0066cc;
    --brand-orange: #ff6b35;
    --brand-teal: #00a896;
    --brand-purple: #6a4c93;
    --brand-yellow: #ffc857;
    
    /* Paleta Principal */
    --primary: #0066cc;
    --primary-dark: #004c99;
    --primary-light: #3385d6;
    --accent: #ff6b35;
    --accent-light: #ff8c61;
    
    /* Tema Claro */
    --surface: #ffff;
    --surface-light: #f8fafc;
    --surface-card: #ffff;
    --text: #1e293b;
    --text-muted: #64748b;
    --border: rgba(0,102,204,0.12);
    --glow: rgba(0, 102, 204, 0.2);
    
    /* Hero (Tema Escuro) */
    --hero-bg: #0f172a;
    --hero-text: #ffff;
    }
    
    html { scroll-behavior: smooth; }
    body { 
    font-family: 'Inter', sans-serif; 
    background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 50%, #fef3c7 100%);
    color: var(--text); 
    position: relative;
    overflow-x: hidden; /* Correção para responsividade */
    }

    /* Scroll Progress Bar */
    #scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand-blue), var(--brand-teal), var(--brand-orange));
    background-size: 200% 100%;
    animation: shimmer 3s linear infinite;
    z-index: 100;
    transition: width 100ms ease;
    }
    @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
    }

    /* Header Glassmorphism */
    .header-glass { 
    position: sticky; 
    top: 0; 
    z-index: 50; 
    backdrop-filter: saturate(180%) blur(16px); 
    background: rgba(255,255,255,0.85); 
    border-bottom: 1px solid var(--border); 
    transition: all 300ms ease;
    box-shadow: 0 4px 12px rgba(0,102,204,0.08);
    }
    .header-scrolled { 
    background: rgba(255,255,255,0.95); 
    box-shadow: 0 10px 30px rgba(0,102,204,0.15); 
    border-color: rgba(0,102,204,0.2); 
    }

    /* Hero with Parallax (Tema Escuro) */
    .hero { 
    position: relative; 
    overflow: hidden;
    background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
    background-size: 200% 200%;
    animation: gradientShift 8s ease infinite;
    }
    @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    }
    .hero::after { 
    content: ""; 
    position: absolute; 
    inset: 0; 
    background: radial-gradient(1200px 500px at 80% -10%, rgba(0,102,204,0.2), transparent 50%), 
    radial-gradient(900px 380px at 10% 10%, rgba(255,107,53,0.15), transparent 60%); 
    pointer-events: none; 
    }
    .scroll-indicator {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    animation: bounce 2s infinite;
    color: var(--hero-text);
    }
    @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-10px); }
    }

    /* Particles */
    .particles { 
    position: absolute; 
    inset: 0; 
    pointer-events: none; 
    overflow: hidden; 
    }
    .particles span { 
    position: absolute; 
    width: 2px; 
    height: 2px; 
    background: rgba(255,255,255,0.85); 
    border-radius: 999px; 
    animation: float 12s linear infinite; 
    filter: drop-shadow(0 0 8px rgba(255,255,255,0.7)); 
    }
    @keyframes float { 
    0% { transform: translateY(0) translateX(0); opacity: 0; } 
    10% { opacity: 1; } 
    90% { opacity: 1; } 
    100% { transform: translateY(-120vh) translateX(20vw); opacity: 0; } 
    }

    /* 3D Cards with Gradient Border */
    .card-3d { 
    background: var(--surface-card); 
    border: 1px solid var(--border); 
    border-radius: 16px; 
    box-shadow: 0 4px 20px rgba(0,102,204,0.08), inset 0 1px 0 rgba(255,255,255,0.5); 
    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    }
    .card-3d::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 2px;
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal), var(--brand-orange));
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 300ms ease;
    }
    .card-3d:hover { 
    transform: translateY(-8px) scale(1.02); 
    box-shadow: 0 20px 50px rgba(0,102,204,0.2), 0 0 0 1px var(--glow);
    }
    .card-3d:hover::before {
    opacity: 1;
    }

    /* Solid Color Course Cards (Regra 60/30/10) */
    .course-card-solid {
    border: none;
    color: white;
    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    .course-card-solid::before { display: none; }
    .course-card-solid:hover {
    transform: translateY(-8px) scale(1.02);
    filter: brightness(1.1);
    }
    /* 60% - Cor Primária (Azul) */
    .course-card-solid[data-color-rule="60"] { background: var(--brand-blue); }
    /* 30% - Cor Secundária (Teal) */
    .course-card-solid[data-color-rule="30"] { background: var(--brand-teal); }
    /* 10% - Cor Destaque (Laranja) */
    .course-card-solid[data-color-rule="10"] { background: var(--brand-orange); }

    /* Buttons */
    .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: 12px;
    padding: 12px 24px;
    font-weight: 700;
    transition: all 250ms ease;
    cursor: pointer;
    }
    .btn-primary { 
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal)); 
    border: 1px solid rgba(0,102,204,0.3); 
    color: #fff; 
    box-shadow: 0 8px 24px rgba(0,102,204,0.25);
    position: relative;
    overflow: hidden;
    }
    .btn-primary::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.2), transparent);
    transform: translateX(-100%);
    transition: transform 400ms ease;
    }
    .btn-primary:hover::before { transform: translateX(100%); }
    .btn-primary:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 12px 32px rgba(0,102,204,0.35); 
    }
    .btn-secondary {
    background: linear-gradient(135deg, var(--brand-orange), var(--brand-yellow));
    border: 1px solid rgba(255,107,53,0.3);
    color: #fff;
    box-shadow: 0 8px 24px rgba(255,107,53,0.25);
    }
    .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(255,107,53,0.35);
    }
    .btn-accent {
    background: var(--brand-purple);
    color: white;
    box-shadow: 0 8px 24px rgba(106, 76, 147, 0.25);
    }
    .btn-accent:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(106, 76, 147, 0.35);
    filter: brightness(1.1);
    }
    .btn-ghost { 
    background: rgba(0,102,204,0.08); 
    border: 1px solid var(--border); 
    color: var(--primary); 
    }
    .btn-ghost:hover { 
    transform: translateY(-2px); 
    background: rgba(0,102,204,0.15); 
    border-color: var(--primary);
    }
    .btn:disabled {
    background: #94a3b8;
    color: #e2e8f0;
    box-shadow: none;
    cursor: not-allowed;
    transform: none;
    }

    /* Reveal Animation */
    .reveal { 
    opacity: 0; 
    transform: translateY(30px); 
    transition: all 600ms cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .reveal.show { 
    opacity: 1; 
    transform: translateY(0); 
    }
    .stagger-1 { transition-delay: 100ms; }
    .stagger-2 { transition-delay: 200ms; }
    .stagger-3 { transition-delay: 300ms; }
    .stagger-4 { transition-delay: 400ms; }
    .stagger-5 { transition-delay: 500ms; }

    /* Badge */
    .badge { 
    display: inline-flex; 
    align-items: center; 
    gap: 8px; 
    font-weight: 700; 
    padding: 8px 16px; 
    border-radius: 999px; 
    background: rgba(0,102,204,0.12); 
    border: 1px solid rgba(0,102,204,0.25); 
    color: var(--primary);
    font-size: 14px;
    }
    .badge-soon {
    background: rgba(255,200,87,0.15);
    border-color: rgba(255,200,87,0.4);
    color: #d97706;
    }
    .badge-success {
    background: rgba(0, 168, 150, 0.15);
    border-color: rgba(0, 168, 150, 0.3);
    color: var(--brand-teal);
    }
    .badge-released {
    background: rgba(106, 76, 147, 0.15);
    border-color: rgba(106, 76, 147, 0.3);
    color: var(--brand-purple);
    }

    /* Modal */
    .modal-backdrop { 
    position: fixed; 
    inset: 0; 
    background: rgba(15,23,42,0.7); 
    backdrop-filter: blur(8px); 
    opacity: 0; 
    visibility: hidden; 
    transition: all 250ms ease; 
    z-index: 70;
    overflow-y: auto; /* Permite rolagem no modal */
    }
    .modal-backdrop.show { 
    opacity: 1; 
    visibility: visible; 
    }
    .modal-card { 
    width: 100%; 
    border-radius: 20px; 
    background: var(--surface-card); 
    border: 1px solid var(--border); 
    transform: translateY(20px) scale(0.95); 
    opacity: 0; 
    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1); 
    box-shadow: 0 25px 70px rgba(0,102,204,0.3), inset 0 1px 0 rgba(255,255,255,0.5);
    margin: 40px auto; /* Centraliza verticalmente com margem */
    }
    /* Tamanhos de Modal */
    .modal-card-sm { max-width: 520px; }
    .modal-card-md { max-width: 768px; }
    .modal-card-lg { max-width: 1024px; }
    
    .modal-backdrop.show .modal-card { 
    transform: translateY(0) scale(1); 
    opacity: 1; 
    }
    .modal-body {
      max-height: 70vh; /* Altura máxima para o corpo do modal */
      overflow-y: auto; /* Scroll interno se o conteúdo for maior */
      padding: 1.5rem; /* 24px */
    }
    .modal-card-lg .modal-body {
      max-height: 80vh;
    }
    
    /* Input Form */
    .input-field {
    width: 100%;
    margin-top: 4px;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    background: var(--surface-light);
    color: var(--text);
    transition: all 150ms ease;
    }
    .input-field:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--glow);
    }
    .input-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-muted);
    }
    textarea.input-field {
      min-height: 120px;
      font-family: monospace;
      font-size: 14px;
    }
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      cursor: pointer;
    }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .file-input-label {
      display: inline-flex; /* Usar inline-flex para alinhar ícone e texto */
      align-items: center; /* Alinhar verticalmente */
      gap: 8px; /* Espaço entre ícone e texto */
      padding: 10px 16px;
      background-color: var(--surface-light);
      color: var(--primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      transition: background-color 200ms ease;
      cursor: pointer;
    }
    .file-input-wrapper:hover .file-input-label {
      background-color: rgba(0, 102, 204, 0.1);
    }
    .file-name {
      margin-left: 10px;
      font-size: 14px;
      color: var(--text-muted);
    }

    /* Gradient Text */
    .gradient-text { 
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-teal), var(--brand-orange)); 
    -webkit-background-clip: text; 
    background-clip: text; 
    color: transparent; 
    }

    /* Blur Blob Decoration */
    .blur-blob {
    position: absolute;
    width: 400px;
    height: 400px;
    border-radius: 50%;
    filter: blur(100px);
    opacity: 0.15;
    pointer-events: none;
    z-index: -1;
    }
    /* Seção com blob precisa de overflow hidden */
    .section-with-blob {
      overflow: hidden;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: var(--surface-light); }
    ::-webkit-scrollbar-thumb { 
    background: linear-gradient(180deg, var(--brand-blue), var(--brand-teal)); 
    border-radius: 10px; 
    }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary-dark); }

    /* Instructor Avatar */
    .instructor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    transition: all 250ms ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .instructor-avatar:hover {
    transform: scale(1.1);
    }

    /* Section Backgrounds */
    .section-light {
    background: var(--surface);
    }
    .section-alt {
    background: linear-gradient(135deg, rgba(0,102,204,0.03), rgba(0,168,150,0.03));
    }

    /* Course Detail Page Styles */
    .course-detail-hero {
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    }
    .course-detail-content {
    max-width: 1200px;
    margin: 0 auto;
    }
    .star-rating {
    display: inline-flex;
    flex-direction: row-reverse;
    font-size: 2rem;
    color: #cbd5e1;
    }
    .star-rating input { display: none; }
    .star-rating label {
    cursor: pointer;
    transition: color 200ms ease;
    }
    .star-rating input:checked ~ label,
    .star-rating:not(:checked) > label:hover,
    .star-rating:not(:checked) > label:hover ~ label {
    color: #f59e0b;
    }

    /* Admin Panel */
    .admin-panel {
    display: flex;
    min-height: 100vh;
    background: var(--surface-light);
    }
    .admin-sidebar {
    width: 260px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 24px;
    display: flex;
    flex-direction: column;
    }
    .admin-nav-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 8px;
    font-weight: 600;
    color: var(--text-muted);
    transition: all 200ms ease;
    }
    .admin-nav-link:hover {
    background: var(--surface-light);
    color: var(--text);
    }
    .admin-nav-link.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 12px var(--glow);
    }
    .admin-main {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
    }
    .admin-stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0,102,204,0.05);
    }
    .admin-table {
    width: 100%;
    border-collapse: collapse;
    }
    .admin-table th, .admin-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid var(--border);
    }
    .admin-table th {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    }
    .admin-table td {
    font-size: 14px;
    color: var(--text);
    }
    .admin-table tr:hover {
    background: var(--surface-light);
    }

    /* Toast Notification */
    #notification-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-left-width: 4px;
    border-radius: 8px;
    padding: 16px;
    box-shadow: 0 10px 30px rgba(0,102,204,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1000;
    transform: translateX(calc(100% + 20px));
    opacity: 0;
    visibility: hidden;
    transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    #notification-toast.show {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    }
    #notification-toast .icon {
    font-size: 20px;
    }
    #notification-toast.success { border-left-color: var(--brand-teal); }
    #notification-toast.success .icon { color: var(--brand-teal); }
    #notification-toast.error { border-left-color: var(--brand-orange); }
    #notification-toast.error .icon { color: var(--brand-orange); }
  </style>
</head>
<body class="antialiased">
  
  <!-- Scroll Progress Bar -->
  <div id="scroll-progress"></div>

  <!-- Toast Notification -->
  <div id="notification-toast">
    <i id="notification-icon" class="icon"></i>
    <div>
      <h4 id="notification-title" class="font-bold"></h4>
      <p id="notification-message" class="text-sm"></p>
    </div>
  </div>

  <!-- Header -->
  <header id="header" class="header-glass">
    <div class="container mx-auto px-6 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
    <a href="#" id="logo-link" class="cursor-pointer">
    <img src="https://i.postimg.cc/hvvWCwnk/Prancheta-1-1.png" alt="Logo LIDS" class="h-10 w-auto" />
    </a>
    </div>
    <div class="flex items-center gap-4">
      <div id="user-info" class="hidden items-center gap-2">
        <span id="user-email" class="text-sm font-medium text-gray-600"></span>
        <button id="logoutBtn" class="btn btn-ghost text-sm px-3 py-1"><i class="fas fa-sign-out-alt"></i></button>
      </div>
      <button id="adminBtnHeader" class="btn btn-ghost text-sm"><i class="fas fa-lock mr-2"></i>Admin</button>
    </div>
    </div>
  </header>

  <!-- Main View (Course List) -->
  <div id="main-view">
    <!-- Hero (Tema Escuro) -->
    <section class="hero relative text-white">
    <div class="relative z-10 container mx-auto px-6 py-24 md:py-32">
    <div class="reveal max-w-3xl">
    <span class="badge mb-5" style="background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); color: white;"><i class="fa-solid fa-bolt"></i> Inscrições Abertas</span>
    <h1 class="text-5xl md:text-7xl font-black leading-tight mb-4" style="color: white;">Capacitações Evereste Academy</h1>
    <p class="text-lg md:text-xl text-slate-200 max-w-2xl mb-8">Formações práticas e focadas em resultados para elevar a excelência do Instituto Evereste. Profissionalismo, dinamismo e tecnologia a favor do seu desenvolvimento.</p>
    <div class="flex items-center gap-4 flex-wrap">
    <a href="#cursos" class="btn btn-primary"><i class="fa-solid fa-graduation-cap mr-2"></i> Ver Cursos</a>
    </div>
    </div>
    <div class="scroll-indicator text-white text-2xl">
    <i class="fas fa-chevron-down"></i>
    </div>
    <div class="particles" id="particles"></div>
    <img src="https://i.postimg.cc/4xNpxRZJ/capabannerlids.png" alt="Banner" class="absolute inset-0 w-full h-full object-cover opacity-20 pointer-events-none" />
    </section>

    <!-- Cursos Disponíveis -->
    <section id="cursos" class="section-light container mx-auto px-6 py-20 md:py-28 relative section-with-blob">
    <div class="blur-blob" style="background: var(--brand-blue); top: -200px; right: -200px;"></div>
    <div class="blur-blob" style="background: var(--brand-orange); bottom: -200px; left: -200px;"></div>
    <div class="reveal text-center mb-16">
    <h2 class="text-4xl md:text-5xl font-black mb-4" style="color: var(--text);">Cursos Disponíveis</h2>
    <p class="text-lg" style="color: var(--text-muted);">Inscrições abertas para as próximas turmas</p>
    </div>

    <!-- Container da Lista de Cursos (será populado pelo JS) -->
    <div id="courses-list" class="grid md:grid-cols-2 gap-8 mb-20">
      <!-- Cursos do Firebase serão inseridos aqui -->
      <p id="courses-loading" class="text-center text-lg col-span-2" style="color: var(--text-muted);">
        <i class="fas fa-spinner animate-spin mr-2"></i>A carregar cursos...
      </p>
    </div>

    <!-- Cursos Futuros (Estático) -->
    <div id="courses-soon-container" class="reveal">
      <h3 class="text-3xl font-bold mb-8 text-center" style="color: var(--text);">Em Breve</h3>
      <div id="courses-soon-list" class="grid md:grid-cols-3 gap-6">
        <!-- Cursos "em_breve" do Firebase serão inseridos aqui -->
        <p id="courses-soon-loading" class="text-center text-lg col-span-3" style="color: var(--text-muted);">
          <i class="fas fa-spinner animate-spin mr-2"></i>A carregar...
        </p>
      </div>
    </div>
    </section>

    <!-- Instrutores -->
    <section id="instrutores" class="section-alt container mx-auto px-6 py-20 md:py-28">
    <div class="reveal text-center mb-16">
    <h2 class="text-4xl md:text-5xl font-black mb-4" style="color: var(--text);">Nossos Instrutores</h2>
    <p class="text-lg" style="color: var(--text-muted);">Profissionais experientes e apaixonados por ensinar</p>
    </div>
    
    <!-- Container dos Instrutores (será populado pelo JS) -->
    <div id="instructors-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Instrutores do Firebase serão inseridos aqui -->
      <p id="instructors-loading" class="text-center text-lg col-span-3" style="color: var(--text-muted);">
        <i class="fas fa-spinner animate-spin mr-2"></i>A carregar instrutores...
      </p>
    </div>
    </section>

    <!-- Sobre -->
    <section id="sobre" class="section-light container mx-auto px-6 py-20 md:py-28">
    <div class="grid md:grid-cols-2 gap-12 items-center">
    <div class="reveal">
    <h2 class="text-4xl md:text-5xl font-black mb-6" style="color: var(--text);">Excelência e Profissionalismo</h2>
    <p class="text-lg mb-6" style="color: var(--text-muted);">A Evereste Academy oferece experiências imersivas, conteúdos aplicados e uma abordagem voltada à prática. Unimos design moderno, tecnologia e didática para acelerar o desenvolvimento.</p>
    <ul class="space-y-4">
    <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Instrutores com experiência prática</span></li>
    <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Conteúdo atualizado e relevante</span></li>
    <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Foco em resultados e aplicabilidade</span></li>
    <li class="flex gap-3"><i class="fa-solid fa-circle-check mt-1" style="color: var(--brand-teal);"></i><span style="color: var(--text);">Certificados reconhecidos</span></li>
    </ul>
    </div>
    <div class="reveal">
    <div class="card-3d p-8">
    <img src="https://i.postimg.cc/SKQh2j5n/logo-evereste-2025-horizontal-2.png" alt="Instituto Evereste" class="w-full h-auto rounded-lg p-6" style="background: rgba(0,102,204,0.03);"/>
    <!-- CORREÇÃO DO TEXTO ABAIXO -->
    <p class="mt-6" style="color: var(--text-muted);">O Programa Evereste Academy é uma iniciativa do Instituto Evereste para formações transformadoras e de alto impacto institucional.</p>
    </div>
    </div>
    </div>
    </section>

    <!-- Footer -->
    <footer class="border-t" style="border-color: var(--border); background: var(--surface);">
    <div class="container mx-auto px-6 py-12">
    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
    <div>
    <p class="text-sm" style="color: var(--text-muted);">© 2025 Evereste Academy. Todos os direitos reservados.</p>
    </div>
    <div class="flex items-center gap-4">
    <button id="adminBtnFooter" class="btn btn-ghost text-sm"><i class="fas fa-lock mr-2"></i>Acesso Admin</button>
    <img src="https://i.postimg.cc/SKQh2j5n/logo-evereste-2025-horizontal-2.png" alt="Instituto Evereste" class="h-8 w-auto"/>
    </div>
    </div>
    </div>
    </footer>
  </div> <!-- Fim da #main-view -->

  <!-- Course Detail View (será populado pelo JS) -->
  <div id="course-detail-view" class="hidden">
    <!-- Conteúdo dinâmico do curso será injetado aqui -->
  </div>

  <!-- Admin Panel View (Oculto por defeito) -->
  <div id="admin-view" class="admin-panel hidden">
    <!-- Sidebar do Admin -->
    <aside class="admin-sidebar">
      <div class="flex items-center gap-3 mb-8">
        <img src="https://i.postimg.cc/hvvWCwnk/Prancheta-1-1.png" alt="Logo LIDS" class="h-10 w-auto" />
      </div>
      <nav class="flex flex-col flex-1 space-y-2">
        <a href="#admin-dashboard" class="admin-nav-link active" data-tab="admin-tab-dashboard">
          <i class="fas fa-chart-pie fa-fw"></i><span>Dashboard</span>
        </a>
        <a href="#admin-courses" class="admin-nav-link" data-tab="admin-tab-courses">
          <i class="fas fa-graduation-cap fa-fw"></i><span>Cursos</span>
        </a>
        <a href="#admin-enrollments" class="admin-nav-link" data-tab="admin-tab-enrollments">
          <i class="fas fa-users fa-fw"></i><span>Matrículas</span>
        </a>
        <a href="#admin-instructors" class="admin-nav-link" data-tab="admin-tab-instructors">
          <i class="fas fa-chalkboard-teacher fa-fw"></i><span>Instrutores</span>
        </a>
        <a href="#admin-certificates" class="admin-nav-link" data-tab="admin-tab-certificates">
          <i class="fas fa-certificate fa-fw"></i><span>Certificados</span>
        </a>
        <a href="#admin-settings" class="admin-nav-link" data-tab="admin-tab-settings">
          <i class="fas fa-cogs fa-fw"></i><span>Configurações</span>
        </a>
      </nav>
      <div class="mt-4">
        <a href="#" id="admin-logout" class="admin-nav-link">
          <i class="fas fa-sign-out-alt fa-fw"></i><span>Sair</span>
        </a>
      </div>
    </aside>

    <!-- Conteúdo Principal do Admin -->
    <div class="admin-main">
      <main id="admin-content-area">
        <!-- Tab: Dashboard (Default) -->
        <div id="admin-tab-dashboard" class="admin-tab-content">
          <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="admin-stat-card">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Total de Matrículas</h3>
              <p id="stat-enrollments" class="text-4xl font-bold mt-2">0</p>
            </div>
            <div class="admin-stat-card">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Total de Check-ins</h3>
              <p id="stat-checkins" class="text-4xl font-bold mt-2">0</p>
            </div>
            <div class="admin-stat-card">
              <h3 class="text-sm font-semibold text-gray-500 uppercase">Certificados Emitidos</h3>
              <p id="stat-certificates" class="text-4xl font-bold mt-2">0</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <h3 class="text-xl font-bold mb-4">Atividade Recente</h3>
            <!-- Placeholder para gráfico ou lista de atividades -->
            <p class="text-gray-500">Gráfico de análise temporal de matrículas (placeholder).</p>
          </div>
        </div>

        <!-- Tab: Cursos -->
        <div id="admin-tab-courses" class="admin-tab-content hidden">
          <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Gerir Cursos</h1>
            <button id="btn-add-course" class="btn btn-primary"><i class="fas fa-plus mr-2"></i>Adicionar Novo Curso</button>
          </div>
          <div class="admin-stat-card overflow-x-auto">
            <table class="admin-table w-full">
              <thead>
                <tr>
                  <th>Título</th>
                  <th>Status</th>
                  <th>Matriculados</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="admin-courses-table-body">
                <!-- Dados dos cursos serão inseridos aqui -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Matrículas -->
        <div id="admin-tab-enrollments" class="admin-tab-content hidden">
          <h1 class="text-3xl font-bold mb-6">Matrículas</h1>
          <div class="admin-stat-card overflow-x-auto">
            <table class="admin-table w-full">
              <thead>
                <tr>
                  <th>Protocolo</th>
                  <th>Aluno</th>
                  <th>Email</th>
                  <th>Telefone</th>
                  <th>Setor</th>
                  <th>Curso</th>
                  <th>Data</th>
                </tr>
              </thead>
              <tbody id="admin-enrollments-table-body">
                <!-- Dados das matrículas serão inseridos aqui -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Tab: Instrutores -->
        <div id="admin-tab-instructors" class="admin-tab-content hidden">
          <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Gerir Instrutores</h1>
            <button id="btn-add-instructor" class="btn btn-primary"><i class="fas fa-plus mr-2"></i>Adicionar Instrutor</button>
          </div>
          <div class="admin-stat-card overflow-x-auto">
            <table class="admin-table w-full">
              <thead>
                <tr>
                  <th>Foto</th>
                  <th>Nome</th>
                  <th>Título</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="admin-instructors-table-body">
                <!-- Dados dos instrutores serão inseridos aqui -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Tab: Certificados -->
        <div id="admin-tab-certificates" class="admin-tab-content hidden">
          <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Gerir Certificados</h1>
            <button id="btn-issue-certificate" class="btn btn-primary"><i class="fas fa-plus mr-2"></i>Emitir Novo Certificado</button>
          </div>
          <div class="admin-stat-card overflow-x-auto">
            <table class="admin-table w-full">
              <thead>
                <tr>
                  <th>Aluno</th>
                  <th>Curso</th>
                  <th>Data Emissão</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="admin-certificates-table-body">
                <!-- Dados dos certificados serão inseridos aqui -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Tab: Configurações -->
        <div id="admin-tab-settings" class="admin-tab-content hidden">
          <h1 class="text-3xl font-bold mb-6">Configurações</h1>
          <div class="admin-stat-card max-w-lg mb-6">
            <h3 class="text-xl font-bold mb-4">Senhas de Check-in</h3>
            <p class="text-gray-600 mb-4">Defina as senhas que os alunos usarão para fazer check-in nos cursos.</p>
            <form id="admin-form-passwords" class="space-y-4">
              <!-- Inputs de senha serão populados pelo JS -->
              <div id="admin-passwords-inputs" class="space-y-4">
                <p class="text-gray-500">A carregar cursos...</p>
              </div>
              <button type="submit" class="btn btn-primary">Salvar Senhas</button>
            </form>
          </div>

          <!-- Seção para Popular Banco de Dados -->
          <div class="admin-stat-card max-w-lg">
            <h3 class="text-xl font-bold mb-4">Configuração Inicial</h3>
            <p class="text-gray-600 mb-4">Se o banco de dados estiver vazio, clique abaixo para adicionar os cursos e instrutores iniciais.</p>
            <button id="btn-seed-database" class="btn btn-accent">
              <i class="fas fa-database mr-2"></i>Popular Banco de Dados
            </button>
          </div>
        </div>
      </main>
    </div>
  </div> <!-- Fim da #admin-view -->


  <!-- === MODAIS === -->

  <!-- Modal Login Admin -->
  <div id="modalLogin" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
    <div class="flex items-start justify-between mb-6">
    <div>
    <h3 class="text-2xl font-bold" style="color: var(--text);">Acesso Administrativo</h3>
    <p class="text-sm" style="color: var(--text-muted);">Área restrita para gestores</p>
    </div>
    <button data-close-modal="modalLogin" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <form id="login-form" class="space-y-4">
    <div>
    <label class="input-label" for="login-email">E-mail</label>
    <input id="login-email" type="email" class="input-field" placeholder="admin@evereste.org" required />
    </div>
    <div>
    <label class="input-label" for="login-password">Senha</label>
    <input id="login-password" type="password" class="input-field" placeholder="••••••••" required />
    </div>
    <p id="login-error" class="text-sm text-red-600 hidden">Mensagem de erro aqui.</p>
    <button type="submit" id="login-submit-btn" class="btn btn-primary w-full">
      <span id="login-submit-text"><i class="fa-solid fa-right-to-bracket mr-2"></i>Entrar</span>
      <span id="login-submit-spinner" class="hidden"><i class="fas fa-spinner animate-spin"></i></span>
    </button>
    </form>
    </div>
  </div>

  <!-- Modal Inscrição (Formulário) -->
  <div id="modalEnroll" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
    <div class="flex items-start justify-between mb-6">
    <div>
    <h3 class="text-2xl font-bold" style="color: var(--text);">Formulário de Inscrição</h3>
    <p class="text-sm" style="color: var(--text-muted);">Inscreva-se no curso: <strong id="enroll-course-name" class="text-blue-600">...</strong></p>
    </div>
    <button data-close-modal="modalEnroll" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <form id="enroll-form" class="space-y-4">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="input-label" for="enroll-name">Nome Completo</label>
          <input id="enroll-name" type="text" class="input-field" placeholder="Seu nome" required />
        </div>
        <div>
          <label class="input-label" for="enroll-email">E-mail</label>
          <input id="enroll-email" type="email" class="input-field" placeholder="voce@email.com" required />
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="input-label" for="enroll-phone">Telefone</label>
          <input id="enroll-phone" type="tel" class="input-field" placeholder="(00) 00000-0000" required />
        </div>
        <div>
          <label class="input-label" for="enroll-setor">Setor</label>
          <input id="enroll-setor" type="text" class="input-field" placeholder="Seu setor" required />
        </div>
      </div>
      <p id="enroll-error" class="text-sm text-red-600 hidden">Mensagem de erro aqui.</p>
      <button type="submit" id="enroll-submit-btn" class="btn btn-primary w-full">
        <i class="fa-solid fa-paper-plane mr-2"></i>Confirmar Inscrição
      </button>
    </form>
    </div>
  </div>
  
  <!-- Modal Sucesso Inscrição (com Protocolo) -->
  <div id="modalEnrollSuccess" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8 text-center">
      <i class="fas fa-check-circle text-6xl" style="color: var(--brand-teal);"></i>
      <h3 class="text-2xl font-bold mt-6" style="color: var(--text);">Inscrição Confirmada!</h3>
      <p class="text-lg mt-2" style="color: var(--text-muted);">O seu número de protocolo é:</p>
      <p id="enroll-protocol" class="text-3xl font-bold my-4 p-4 rounded-lg" style="background: var(--surface-light); color: var(--brand-blue); letter-spacing: 2px;">AE38F9B1</p>
      <p class="text-sm" style="color: var(--text-muted);">Guarde este número. Você receberá um e-mail com mais detalhes.</p>
      <button data-close-modal="modalEnrollSuccess" class="btn btn-primary w-full mt-6">Entendido</button>
    </div>
  </div>

  <!-- Modal Check-in -->
  <div id="modalCheckin" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
    <div class="flex items-start justify-between mb-6">
    <div>
    <h3 class="text-2xl font-bold" style="color: var(--text);">Check-in do Curso</h3>
    <p class="text-sm" style="color: var(--text-muted);">Insira a senha fornecida pelo instrutor.</p>
    </div>
    <button data-close-modal="modalCheckin" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <form id="checkin-form" class="space-y-4">
    <div>
    <label class="input-label" for="checkin-password">Senha de Acesso</label>
    <input id="checkin-password" type="password" class="input-field" placeholder="••••••••" required />
    </div>
    <p id="checkin-error" class="text-sm text-red-600 hidden">Senha incorreta. Tente novamente.</p>
    <button type="submit" id="checkin-submit-btn" class="btn btn-primary w-full">
      Validar Check-in
    </button>
    </form>
    </div>
  </div>

  <!-- Modal Avaliar Instrutor -->
  <div id="modalEvaluate" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
    <div class="flex items-start justify-between mb-6">
    <div>
    <h3 class="text-2xl font-bold" style="color: var(--text);">Avaliar Instrutor</h3>
    <p class="text-sm" style="color: var(--text-muted);">Deixe seu feedback sobre <strong id="evaluate-instructor-name"></strong></p>
    </div>
    <button data-close-modal="modalEvaluate" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <form id="evaluate-form" class="space-y-4">
      <div>
        <label class="input-label">Nota</label>
        <div class="star-rating mt-1">
          <input type="radio" id="5-stars" name="rating" value="5" required /><label for="5-stars" class="fas fa-star"></label>
          <input type="radio" id="4-stars" name="rating" value="4" /><label for="4-stars" class="fas fa-star"></label>
          <input type="radio" id="3-stars" name="rating" value="3" /><label for="3-stars" class="fas fa-star"></label>
          <input type="radio" id="2-stars" name="rating" value="2" /><label for="2-stars" class="fas fa-star"></label>
          <input type="radio" id="1-star" name="rating" value="1" /><label for="1-star" class="fas fa-star"></label>
        </div>
      </div>
      <div>
        <label class="input-label" for="evaluate-comment">Comentário (Opcional)</label>
        <textarea id="evaluate-comment" class="input-field" rows="3" placeholder="O que você achou da didática?"></textarea>
      </div>
      <p id="evaluate-error" class="text-sm text-red-600 hidden">Ocorreu um erro. Tente novamente.</p>
      <button type="submit" id="evaluate-submit-btn" class="btn btn-primary w-full">
        Enviar Avaliação
      </button>
    </form>
    </div>
  </div>

  <!-- Modal Admin: Editar Curso (AGORA EXPANDIDO) -->
  <div id="modalEditCourse" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-lg p-8"> <!-- Tamanho aumentado para -lg -->
      <form id="modalEditCourse-form">
        <input type="hidden" id="edit-course-id">
        <div class="flex items-start justify-between mb-6">
          <h3 id="modalEditCourse-title" class="text-2xl font-bold" style="color: var(--text);">Adicionar Novo Curso</h3>
          <button data-close-modal="modalEditCourse" type="button" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <div class="modal-body space-y-4">
          <!-- Linha 1: Título e Subtítulo -->
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="input-label" for="edit-course-title">Título</label>
              <input id="edit-course-title" type="text" class="input-field" required>
            </div>
            <div>
              <label class="input-label" for="edit-course-subtitle">Subtítulo</label>
              <input id="edit-course-subtitle" type="text" class="input-field">
            </div>
          </div>
          <!-- Linha 2: Resumo e Descrição -->
          <div>
            <label class="input-label" for="edit-course-summary">Resumo (Card)</label>
            <textarea id="edit-course-summary" class="input-field" rows="3"></textarea>
          </div>
          <div>
            <label class="input-label" for="edit-course-description">Descrição Completa</label>
            <textarea id="edit-course-description" class="input-field" rows="5"></textarea>
          </div>
          <!-- Linha 3: Ícone, Cor, Status -->
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="input-label" for="edit-course-icon">Ícone (FontAwesome)</label>
              <input id="edit-course-icon" type="text" class="input-field" placeholder="fa-brain">
            </div>
            <div>
              <label class="input-label" for="edit-course-color">Cor Tema</label>
              <input id="edit-course-color" type="text" class="input-field" placeholder="#4CAF50">
            </div>
            <div>
              <label class="input-label" for="edit-course-status">Status</label>
              <select id="edit-course-status" class="input-field">
                <option value="aberto">Aberto</option>
                <option value="em_breve">Em Breve</option>
                <option value="fechado">Fechado</option>
              </select>
            </div>
          </div>
          <!-- Linha 4: Imagem -->
          <div>
            <label class="input-label" for="edit-course-image">URL da Imagem (Header)</label>
            <input id="edit-course-image" type="text" class="input-field" placeholder="https://...">
          </div>
          
          <!-- NOVOS CAMPOS -->
          <hr class="my-4">
          <h4 class="text-lg font-semibold">Conteúdo Detalhado</h4>
          
          <!-- Linha 5: Objetivos e Requisitos -->
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="input-label" for="edit-course-objectives">O que irá aprender (um por linha)</label>
              <textarea id="edit-course-objectives" class="input-field" rows="5"></textarea>
            </div>
            <div>
              <label class="input-label" for="edit-course-requirements">Requisitos (um por linha)</label>
              <textarea id="edit-course-requirements" class="input-field" rows="5"></textarea>
            </div>
          </div>
          
          <!-- Linha 6: Público-Alvo -->
          <div>
            <label class="input-label" for="edit-course-audience">Público-Alvo</label>
            <textarea id="edit-course-audience" class="input-field" rows="3"></textarea>
          </div>
          
          <!-- Linha 7: JSONs (Módulos, Atividades, Detalhes) -->
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="input-label" for="edit-course-modules">Módulos (JSON)</label>
              <textarea id="edit-course-modules" class="input-field" rows="10" placeholder="[{ &quot;title&quot;: &quot;M1&quot;, &quot;topics&quot;: [...] }]"></textarea>
            </div>
            <div>
              <label class="input-label" for="edit-course-activities">Atividades (JSON)</label>
              <textarea id="edit-course-activities" class="input-field" rows="10" placeholder="[{ &quot;title&quot;: &quot;A1&quot;, &quot;description&quot;: &quot;...&quot; }]"></textarea>
            </div>
            <div>
              <label class="input-label" for="edit-course-details">Detalhes (JSON)</label>
              <textarea id="edit-course-details" class="input-field" rows="10" placeholder="{ &quot;Data&quot;: &quot;...&quot;, &quot;Carga&quot;: &quot;...&quot; }"></textarea>
            </div>
          </div>
          <p class="text-xs text-gray-500">Cuidado ao editar os campos JSON. Um formato inválido causará erro ao salvar.</p>
          
          <!-- NOVO: Seleção de Instrutores -->
          <hr class="my-4">
          <h4 class="text-lg font-semibold">Instrutores</h4>
          <div id="edit-course-instructors-list" class="space-y-2 max-h-40 overflow-y-auto border p-3 rounded-md">
            <!-- Checkboxes dos instrutores serão inseridos aqui -->
            <p class="text-gray-500">A carregar instrutores...</p>
          </div>
          
          <!-- NOVO: Upload de Material -->
          <hr class="my-4">
          <h4 class="text-lg font-semibold">Material do Curso</h4>
          <div class="flex items-center gap-4">
            <label class="file-input-wrapper">
              <span class="file-input-label">
                <i class="fas fa-upload mr-2"></i>Selecionar Arquivo
              </span>
              <input id="edit-course-material-file" type="file" accept=".pdf,.doc,.docx,.ppt,.pptx,.zip">
            </label>
            <span id="edit-course-material-filename" class="file-name">Nenhum arquivo selecionado</span>
          </div>
          <p class="text-xs text-gray-500 mt-1">Envie o material complementar (PDF, DOCX, ZIP, etc.). Substituirá o material existente, se houver.</p>
          <div id="edit-course-material-current" class="mt-2 text-sm text-gray-600">
             <!-- Informação do material atual será inserida aqui -->
          </div>

        </div>
        
        <div class="flex justify-end gap-4 mt-6 pt-6 border-t border-gray-200">
          <button data-close-modal="modalEditCourse" type="button" class="btn btn-ghost">Cancelar</button>
          <button type="submit" id="save-course-btn" class="btn btn-primary">
            <span id="save-course-btn-text">Salvar Curso</span>
            <span id="save-course-btn-spinner" class="hidden"><i class="fas fa-spinner animate-spin"></i> A Salvar...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal Admin: Editar Instrutor -->
  <div id="modalEditInstructor" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
      <form id="modalEditInstructor-form">
        <input type="hidden" id="edit-instructor-id">
        <div class="flex items-start justify-between mb-6">
          <h3 id="modalEditInstructor-title" class="text-2xl font-bold" style="color: var(--text);">Adicionar Novo Instrutor</h3>
          <button data-close-modal="modalEditInstructor" type="button" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <div class="modal-body space-y-4">
          <div>
            <label class="input-label" for="edit-instructor-name">Nome</label>
            <input id="edit-instructor-name" type="text" class="input-field" required>
          </div>
          <div>
            <label class="input-label" for="edit-instructor-title">Título (Cargo)</label>
            <input id="edit-instructor-title" type="text" class="input-field">
          </div>
          <div>
            <label class="input-label" for="edit-instructor-bio">Biografia Curta</label>
            <textarea id="edit-instructor-bio" class="input-field" rows="4"></textarea>
          </div>
          <div>
            <label class="input-label" for="edit-instructor-image">URL da Foto</label>
            <input id="edit-instructor-image" type="text" class="input-field" placeholder="https://...">
          </div>
        </div>
        
        <div class="flex justify-end gap-4 mt-6 pt-6 border-t border-gray-200">
          <button data-close-modal="modalEditInstructor" type="button" class="btn btn-ghost">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar Instrutor</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal Admin: Emitir Certificado -->
  <div id="modalIssueCertificate" class="modal-backdrop flex items-center justify-center px-4">
    <div class="modal-card modal-card-sm p-8">
      <form id="modalIssueCertificate-form">
        <div class="flex items-start justify-between mb-6">
          <h3 class="text-2xl font-bold" style="color: var(--text);">Emitir Novo Certificado</h3>
          <button data-close-modal="modalIssueCertificate" type="button" class="btn btn-ghost px-3 py-2"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <div class="modal-body space-y-4">
          <div>
            <label class="input-label" for="issue-cert-userid">User ID do Aluno</label>
            <input id="issue-cert-userid" type="text" class="input-field" placeholder="UID do Firebase" required>
          </div>
          <div>
            <label class="input-label" for="issue-cert-student-name">Nome Completo do Aluno</label>
            <input id="issue-cert-student-name" type="text" class="input-field" placeholder="Nome para o certificado" required>
          </div>
          <div>
            <label class="input-label" for="issue-cert-course">Curso</label>
            <select id="issue-cert-course" class="input-field" required>
              <option value="">Selecione um curso...</option>
              <!-- Cursos serão populados pelo JS -->
            </select>
          </div>
          <div>
            <label class="input-label" for="issue-cert-date">Data de Conclusão</label>
            <input id="issue-cert-date" type="date" class="input-field" required>
          </div>
        </div>
        
        <div class="flex justify-end gap-4 mt-6 pt-6 border-t border-gray-200">
          <button data-close-modal="modalIssueCertificate" type="button" class="btn btn-ghost">Cancelar</button>
          <button type="submit" class="btn btn-primary">Emitir Certificado</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts (Firebase e Lógica da Aplicação) -->
  <script type="module">
    // Importações do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged, 
      signInAnonymously,
      signInWithCustomToken,
      setPersistence,
      browserLocalPersistence
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      doc, 
      getDoc, 
      setDoc, 
      addDoc, 
      query, 
      where,
      onSnapshot,
      Timestamp,
      serverTimestamp,
      updateDoc,
      deleteDoc // Adicionado deleteDoc
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { 
      getStorage, 
      ref, 
      uploadBytes,
      getDownloadURL,
      deleteObject // Adicionado deleteObject
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

    // --- Configuração do Firebase ---
    // A configuração real será injetada pelo ambiente
    const firebaseConfig = typeof __firebase_config !== 'undefined' 
      ? JSON.parse(__firebase_config)
      : {
          apiKey: "AIzaSyB0xvVzytOx4dumokND-dr926krSO4-CqU",
          authDomain: "academylids.firebaseapp.com",
          projectId: "academylids",
          storageBucket: "academylids.firebasestorage.app",
          messagingSenderId: "826478835273",
          appId: "1:826478835273:web:0995d64419276b932cb198",
          measurementId: "G-T2TN7FL590"
        };
    
    // ID da Aplicação (injetado pelo ambiente)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app); // Inicializa Storage
    const analytics = getAnalytics(app);

    // Variáveis Globais de Estado
    let currentUserId = null;
    let isAdmin = false;
    let localCourses = []; // Cache local dos cursos
    let localInstructors = []; // Cache local dos instrutores
    let courseCheckinPasswords = {}; // Cache local das senhas de check-in
    let currentUserCheckins = {}; // Cache local dos check-ins do usuário
    let authReady = false; // Flag para controlar se a autenticação inicial já ocorreu
    let currentEditingFile = null; // Para guardar o arquivo selecionado para upload

    // --- Elementos DOM ---
    const mainView = document.getElementById('main-view');
    const courseDetailView = document.getElementById('course-detail-view');
    const adminView = document.getElementById('admin-view');
    
    const coursesListContainer = document.getElementById('courses-list');
    const coursesLoading = document.getElementById('courses-loading');
    const coursesSoonListContainer = document.getElementById('courses-soon-list');
    const coursesSoonLoading = document.getElementById('courses-soon-loading');
    const instructorsListContainer = document.getElementById('instructors-list');
    const instructorsLoading = document.getElementById('instructors-loading');
    
    // Modais
    const modalLogin = document.getElementById('modalLogin');
    const modalEnroll = document.getElementById('modalEnroll');
    const modalEnrollSuccess = document.getElementById('modalEnrollSuccess');
    const modalCheckin = document.getElementById('modalCheckin');
    const modalEvaluate = document.getElementById('modalEvaluate');
    const modalEditCourse = document.getElementById('modalEditCourse');
    const modalEditInstructor = document.getElementById('modalEditInstructor');
    const modalIssueCertificate = document.getElementById('modalIssueCertificate');
    
    const loginForm = document.getElementById('login-form');
    const loginEmail = document.getElementById('login-email');
    const loginPassword = document.getElementById('login-password');
    const loginError = document.getElementById('login-error');
    const loginSubmitBtn = document.getElementById('login-submit-btn');
    const loginSubmitText = document.getElementById('login-submit-text');
    const loginSubmitSpinner = document.getElementById('login-submit-spinner');
    
    const adminBtnHeader = document.getElementById('adminBtnHeader');
    const adminBtnFooter = document.getElementById('adminBtnFooter');
    const userInfo = document.getElementById('user-info');
    const userEmail = document.getElementById('user-email');

    // --- Funções Utilitárias ---

    // Mostrar Notificação (Toast)
    const showNotification = (title, message, type = 'success') => {
      const toast = document.getElementById('notification-toast');
      const icon = document.getElementById('notification-icon');
      
      document.getElementById('notification-title').innerText = title;
      document.getElementById('notification-message').innerText = message;
      
      toast.className = ''; // Limpa classes
      toast.classList.add('show', type);
      
      if (type === 'success') {
        icon.className = 'icon fas fa-check-circle';
      } else if (type === 'error') {
        icon.className = 'icon fas fa-times-circle';
      }

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    };

    // Verificar se o usuário é Admin
    const checkAdminStatus = async (uid) => {
      if (!uid) return false;
      try {
        const adminDocRef = doc(db, 'admins', uid);
        const adminDocSnap = await getDoc(adminDocRef);
        return adminDocSnap.exists();
      } catch (error) {
        console.error("Erro ao verificar status de admin:", error);
        return false;
      }
    };
    
    // Mudar a visibilidade das views
    const showView = (viewToShow) => {
      mainView.classList.add('hidden');
      courseDetailView.classList.add('hidden');
      adminView.classList.add('hidden');
      document.getElementById('header').classList.remove('hidden');

      if (viewToShow === 'main') {
        mainView.classList.remove('hidden');
      } else if (viewToShow === 'course') {
        courseDetailView.classList.remove('hidden');
      } else if (viewToShow === 'admin') {
        adminView.classList.remove('hidden');
        document.getElementById('header').classList.add('hidden'); // Oculta header principal no admin
      }
      window.scrollTo(0, 0);
    };
    
    // Abrir/Fechar Modais
    const openModal = (modalId) => document.getElementById(modalId)?.classList.add('show');
    const closeModal = (modalId) => document.getElementById(modalId)?.classList.remove('show');
    
    // Listeners para fechar modais
    document.querySelectorAll('[data-close-modal]').forEach(btn => {
      btn.addEventListener('click', () => closeModal(btn.dataset.closeModal));
    });
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
      backdrop.addEventListener('click', (e) => {
        if (e.target === backdrop) closeModal(backdrop.id);
      });
    });

    // --- Lógica de Autenticação ---

    // Define a persistência de login
    setPersistence(auth, browserLocalPersistence)
      .then(() => {
        console.log("Persistência de login definida para 'local'.");
      })
      .catch((error) => {
        console.error("Erro ao definir persistência de login:", error);
      });

    onAuthStateChanged(auth, async (user) => {
      authReady = true; // Marca que a verificação inicial terminou
      if (user) {
        currentUserId = user.uid;
        loadUserCheckins(); // Carrega dados privados do usuário
        
        if (user.isAnonymous) {
          console.log("Usuário anônimo logado:", user.uid);
          isAdmin = false;
          adminBtnHeader.classList.remove('hidden');
          adminBtnFooter.classList.remove('hidden');
        } else {
          // Usuário não-anônimo, verifica se é admin
          isAdmin = await checkAdminStatus(user.uid);
          if (isAdmin) {
            console.log("Admin logado:", user.email);
            userInfo.classList.remove('hidden');
            userEmail.innerText = user.email;
            adminBtnHeader.classList.add('hidden');
            adminBtnFooter.classList.add('hidden');
            
            closeModal('modalLogin');
            // Se o admin panel não estiver visível, mostra e carrega
            if (adminView.classList.contains('hidden')) {
               showView('admin');
               loadAdminPanel();
            }
          } else {
            // Logado mas não é admin (pode ser um usuário comum)
            console.log("Usuário comum logado:", user.email);
            isAdmin = false;
            userInfo.classList.remove('hidden');
            userEmail.innerText = user.email;
            adminBtnHeader.classList.add('hidden'); // Esconde "Admin"
            adminBtnFooter.classList.add('hidden');
          }
        }
        
        // Carrega dados públicos DEPOIS de saber quem é o usuário
        if (localCourses.length === 0) loadCourses();
        if (localInstructors.length === 0) loadInstructors();

      } else {
        // Usuário deslogado
        console.log("Nenhum usuário logado. A tentar login...");
        currentUserId = null;
        isAdmin = false;
        
        userInfo.classList.add('hidden');
        userEmail.innerText = '';
        adminBtnHeader.classList.remove('hidden');
        adminBtnFooter.classList.remove('hidden');

        // Se estava na view admin, volta para a 'main'
        if (!adminView.classList.contains('hidden')) {
          showView('main');
        }

        try {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            console.log("A tentar login com Custom Token...");
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            console.log("A tentar login anônimo...");
            await signInAnonymously(auth);
          }
        } catch (error) {
          console.error("Erro no login anônimo ou custom token:", error);
          if (error.code === 'auth/operation-not-allowed') {
            console.error("LOGIN ANÔNIMO OU CUSTOM TOKEN NÃO ESTÁ ATIVADO NO FIREBASE!");
          }
        }
      }
    });

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = loginEmail.value;
      const password = loginPassword.value;

      loginError.classList.add('hidden');
      loginSubmitBtn.disabled = true;
      loginSubmitText.classList.add('hidden');
      loginSubmitSpinner.classList.remove('hidden');

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        // O onAuthStateChanged vai tratar de verificar se é admin e redirecionar
        showNotification('Sucesso', `Bem-vindo, ${userCredential.user.email}!`, 'success');
      } catch (error) {
        console.error("Erro de login:", error.code, error.message);
        let friendlyMessage = "Email ou senha inválidos.";
        if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
            friendlyMessage = "Email ou senha inválidos.";
        } else if (error.code === 'auth/operation-not-allowed') {
            friendlyMessage = "Login por email e senha não está ativado no Firebase.";
        }
        loginError.innerText = friendlyMessage;
        loginError.classList.remove('hidden');
      } finally {
        loginSubmitBtn.disabled = false;
        loginSubmitText.classList.remove('hidden');
        loginSubmitSpinner.classList.add('hidden');
      }
    });
    
    const handleLogout = async () => {
      try {
        await signOut(auth);
        isAdmin = false;
        currentUserId = null;
        localCourses = []; 
        localInstructors = []; 
        showView('main');
        showNotification('Até logo!', 'Você saiu da sua conta.', 'success');
        // O onAuthStateChanged vai tratar de logar anonimamente
      } catch (error) {
        console.error("Erro ao sair:", error);
      }
    };
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    document.getElementById('admin-logout').addEventListener('click', handleLogout);

    // --- Lógica de Carregamento de Dados (Público) ---
    
    // Função helper para garantir que a autenticação (mesmo anônima) terminou
    const waitForAuth = () => {
      return new Promise((resolve, reject) => {
        if (authReady) {
          resolve();
        } else {
          const unsubscribe = onAuthStateChanged(auth, (user) => {
            if (user) {
              authReady = true;
              unsubscribe();
              resolve();
            }
          });
        }
      });
    };

    const loadCourses = async () => {
      await waitForAuth(); 
      try {
        const coursesRef = collection(db, 'artifacts', appId, 'public/data/courses');
        const querySnap = await getDocs(coursesRef);
        
        localCourses = []; 
        coursesListContainer.innerHTML = ''; 
        coursesSoonListContainer.innerHTML = '';
        
        if (querySnap.empty) {
          coursesLoading.innerText = "Nenhum curso disponível no momento.";
          coursesSoonLoading.innerText = "";
          return;
        }
        
        const colors = ['60', '30', '10'];
        let colorIndex = 0;
        let openCoursesCount = 0;
        let soonCoursesCount = 0;

        querySnap.forEach((docSnap) => {
          const course = { id: docSnap.id, ...docSnap.data() };
          localCourses.push(course); // Adiciona ao cache

          if (course.status === 'aberto') {
            // Renderiza no grid principal
            openCoursesCount++;
            const colorRule = colors[colorIndex % colors.length];
            colorIndex++;
            const cardHTML = `
              <article class="card-3d p-8 reveal course-card-solid cursor-pointer" 
                     data-course-id="${course.id}" 
                     data-color-rule="${colorRule}"
                     style="background-color: ${course.themeColor || 'var(--brand-blue)'};">
              <div class="flex items-center gap-3 mb-4">
                <i class="fa-solid ${course.icon || 'fa-graduation-cap'} text-3xl"></i>
                <div>
                  <h3 class="text-2xl font-bold">${course.title}</h3>
                  <p class="text-sm opacity-90">${course.subtitle}</p>
                </div>
              </div>
              <div class="overflow-hidden rounded-lg mb-4">
                <img src="${course.headerOverlayImage}" alt="${course.title}" class="w-full h-48 object-cover opacity-80" 
                     onerror="this.src='https://placehold.co/600x400/333/fff?text=ImagemIndisponível'" />
              </div>
              <p class="mb-6 opacity-90">${course.summary}</p>
              <button class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-bold py-3 px-4 rounded-lg transition-all">
                <i class="fa-solid fa-arrow-right mr-2"></i>Ver Detalhes
              </button>
            </article>
            `;
            coursesListContainer.innerHTML += cardHTML;
          } else if (course.status === 'em_breve') {
            // Renderiza na seção "Em Breve"
            soonCoursesCount++;
            const cardHTML = `
              <div class="card-3d p-6 course-card-solid" style="background: var(--brand-purple);">
                <span class="badge-soon mb-3" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); color: white;"><i class="fa-solid fa-clock mr-2"></i>Em breve</span>
                <h4 class="font-bold text-lg mb-2">${course.title}</h4>
                <p class="text-sm opacity-90">${course.subtitle || '...'}</p>
              </div>
            `;
            coursesSoonListContainer.innerHTML += cardHTML;
          }
        });

        if (openCoursesCount === 0) {
          coursesLoading.innerText = "Nenhum curso com inscrições abertas no momento.";
        } else {
          coursesLoading.classList.add('hidden');
        }
        
        if (soonCoursesCount === 0) {
          coursesSoonLoading.innerText = "Nenhuma novidade por enquanto.";
        } else {
          coursesSoonLoading.classList.add('hidden');
        }

        // Re-ativa animações de reveal
        const io = new IntersectionObserver((entries) => {
          entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('show'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => io.observe(el));

      } catch (error) {
        console.error("Erro ao carregar cursos:", error);
        coursesLoading.innerText = "Não foi possível carregar os cursos. (Permissões?)";
      }
    };
    
    const loadInstructors = async () => {
      await waitForAuth(); 
      try {
        const instructorsRef = collection(db, 'artifacts', appId, 'public/data/instructors');
        const querySnap = await getDocs(instructorsRef);
        
        localInstructors = []; 
        instructorsListContainer.innerHTML = ''; 

        if (querySnap.empty) {
          instructorsLoading.innerText = "Nenhum instrutor encontrado.";
          return;
        }

        querySnap.forEach((docSnap) => {
          const instructor = { id: docSnap.id, ...docSnap.data() };
          localInstructors.push(instructor); 

          const cardHTML = `
            <div class="card-3d p-6 reveal">
              <img src="${instructor.image}" 
                   alt="${instructor.name}" 
                   class="instructor-avatar mx-auto mb-4" 
                   style="border-color: var(--brand-blue);"
                   onerror="this.src='https://placehold.co/80x80/0066cc/fff?text=${instructor.name ? instructor.name[0] : '?'}'" />
              <h4 class="font-bold text-lg text-center" style="color: var(--text);">${instructor.name}</h4>
              <p class="text-sm mt-2 text-center" style="color: var(--text-muted);">${instructor.title}</p>
              <p class="text-xs mt-3 text-center" style="color: var(--text-muted);">${instructor.bio || ''}</p>
            </div>
          `;
          instructorsListContainer.innerHTML += cardHTML;
        });
        
        instructorsLoading.classList.add('hidden');
        // Re-ativa animações de reveal
        const io = new IntersectionObserver((entries) => {
          entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('show'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('#instructors-list .reveal').forEach(el => io.observe(el));

      } catch (error) {
        console.error("Erro ao carregar instrutores:", error);
        instructorsLoading.innerText = "Não foi possível carregar os instrutores. (Permissões?)";
      }
    };
    
    const loadUserCheckins = async () => {
      if (!currentUserId) return;
      try {
        const checkinsRef = collection(db, 'artifacts', appId, 'users', currentUserId, 'checkins');
        const querySnap = await getDocs(checkinsRef);
        currentUserCheckins = {}; 
        querySnap.forEach((docSnap) => {
          currentUserCheckins[docSnap.id] = docSnap.data();
        });
        console.log("Check-ins do usuário carregados:", currentUserCheckins);
      } catch (error) {
        console.error("Erro ao carregar check-ins do usuário:", error);
      }
    };

    // --- Lógica da Página de Detalhes do Curso ---

    const renderCourseDetail = (course) => {
      const detailsHTML = Object.entries(course.details || {}).map(([key, value]) => `
      <div class="flex items-start">
      <i class="fas fa-check mt-1 mr-3" style="color: ${course.themeColor};"></i>
      <span><strong>${key}:</strong> ${value}</span>
      </div>
      `).join('');

      // Agora pega os instrutores salvos DENTRO do curso
      const instructorsHTML = (course.instructors || []).map(instructor => `
      <div class="flex items-center space-x-4">
      <img class="h-16 w-16 rounded-full object-cover" 
           src="${instructor.image}" alt="${instructor.name}"
           onerror="this.src='https://placehold.co/64x64/0066cc/fff?text=${instructor.name ? instructor.name[0] : '?'}'" />
      <div>
      <p class="font-bold text-gray-800">${instructor.name}</p>
      <p class="text-sm text-gray-500">${instructor.title}</p>
      </div>
      </div>
      `).join('');

      const modulesHTML = (course.modules || []).map(module => `
      <div class="bg-gray-50 p-5 rounded-lg border-l-4" style="border-color: ${course.themeColor};">
      <h4 class="font-bold text-lg" style="color: var(--primary);">${module.title}</h4>
      <ul class="mt-3 space-y-2 list-disc list-inside text-gray-600">
      ${(module.topics || []).map(topic => `<li>${topic}</li>`).join('')}
      </ul>
      </div>
      `).join('');

      const practicalActivitiesHTML = (course.practicalActivities || []).map(activity => `
      <div class="bg-white p-5 rounded-lg border border-gray-200">
      <h4 class="font-bold flex items-center text-lg" style="color: ${course.themeColor};"><i class="fas fa-flask mr-3"></i>${activity.title}</h4>
      <p class="text-gray-600 mt-2 pl-8">${activity.description}</p>
      </div>
      `).join('');
      
      // Botões de Ação - Lógica de Estado
      const hasCheckedIn = !!currentUserCheckins[course.id];
      const isEnrolled = true; // Simulado - idealmente viria do Firestore
      const isCompleted = false; // Simulado - idealmente viria do Firestore

      const checkinBtnDisabled = !isEnrolled || hasCheckedIn;
      const materialsBtnDisabled = !isEnrolled || !hasCheckedIn || !(course.materials && course.materials.length > 0); // Desabilita se não houver material
      const evaluateBtnDisabled = !isEnrolled || !hasCheckedIn;
      const certificateBtnDisabled = !isEnrolled || !isCompleted;
      
      const checkinBtnText = hasCheckedIn ? 'Check-in Realizado' : 'Fazer Check-in';

      const courseHTML = `
      <section class="relative text-white py-20 md:py-32 overflow-hidden course-detail-hero" style="background: linear-gradient(-45deg, ${course.themeColor}, ${course.themeColorDark || course.themeColor});">
      <div class="absolute inset-0 bg-cover bg-center opacity-20" style="background-image: url('${course.headerOverlayImage}');"></div>
      <div class="container mx-auto px-6 relative">
      <p class="text-lg font-semibold mb-2"><i class="fas ${course.icon} mr-2"></i>Capacitação Evereste Academy</p>
      <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">${course.title}</h1>
      <p class="mt-2 text-xl md:text-2xl opacity-90">${course.subtitle}</p>
      </div>
      </section>
      
      <div class="container mx-auto px-6 py-16 course-detail-content">
      <button id="back-to-courses-btn" class="mb-12 font-semibold hover:underline" style="color: ${course.themeColor};">
      <i class="fas fa-arrow-left mr-2"></i>Voltar para todos os cursos
      </button>
      
      <div class="grid lg:grid-cols-3 gap-12">
      <!-- Coluna Principal (Conteúdo) -->
      <div class="lg:col-span-2">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Sobre a atividade</h2>
      <p class="text-gray-600 leading-relaxed mb-8">${course.fullDescription}</p>
      
      <h2 class="text-2xl font-bold text-gray-800 mb-4">O que irá aprender</h2>
      <ul class="space-y-3 mb-8">${(course.learningObjectives || []).map(obj => `<li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-3" style="color: ${course.themeColor};"></i><span>${obj}</span></li>`).join('')}</ul>
      
      <h2 class="text-2xl font-bold text-gray-800 mb-6 mt-12">Conteúdo Programático</h2>
      <div class="space-y-6 mb-12">${modulesHTML}</div>
      
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Atividades Práticas</h2>
      <div class="space-y-4 mb-12">${practicalActivitiesHTML}</div>

      <h2 class="text-2xl font-bold text-gray-800 mb-4">Requisitos</h2>
      <ul class="space-y-3">${(course.requirements || []).map(req => `<li class="flex items-start"><i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i><span>${req}</span></li>`).join('')}</ul>
      </div>
      
      <!-- Coluna Lateral (Ações) -->
      <div class="lg:col-span-1">
      <div class="bg-white p-6 rounded-lg shadow-xl sticky top-24">
      <span class="inline-block text-sm font-semibold mb-4 px-3 py-1 rounded-full" style="background-color: ${course.themeColor}20; color: ${course.themeColor};">Inscrições abertas</span>
      <h3 class="text-xl font-bold mb-4" style="color: var(--primary);">${course.title}</h3>
      <div class="space-y-3 mb-6 text-gray-700">${detailsHTML}</div>
      
      <!-- Botões de Ação do Curso -->
      <div class="space-y-3">
        <button id="enroll-btn-detail" class="btn btn-primary w-full" style="background-color: ${course.themeColor};" data-course-id="${course.id}" data-course-name="${course.title}">
          <i class="fas fa-check-circle mr-2"></i>Inscreva-se
        </button>
        
        <button id="btn-checkin" class="btn btn-secondary w-full" ${checkinBtnDisabled ? 'disabled' : ''}>
          <i class="fas ${hasCheckedIn ? 'fa-user-check' : 'fa-map-marker-alt'} mr-2"></i>${checkinBtnText}
        </button>
        
        <button id="btn-materials" class="btn btn-ghost w-full" ${materialsBtnDisabled ? 'disabled' : ''}>
          <i class="fas fa-download mr-2"></i>Materiais
        </button>
        
        <button id="btn-evaluate" class="btn btn-ghost w-full" ${evaluateBtnDisabled ? 'disabled' : ''}>
          <i class="fas fa-star mr-2"></i>Avaliar Instrutor
        </button>
        
        <button id="btn-certificate" class="btn btn-ghost w-full" ${certificateBtnDisabled ? 'disabled' : ''}>
          <i class="fas fa-certificate mr-2"></i>Certificado
        </button>
      </div>
      
      </div>
      </div>
      </div>
      
      <div class="mt-16 pt-8 border-t">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Instrutores</h2>
      <div class="flex flex-col md:flex-row gap-8">${instructorsHTML || '<p>Nenhum instrutor associado.</p>'}</div>
      </div>
      <div class="mt-16 pt-8 border-t">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Público-alvo</h2>
      <p class="text-gray-600">${course.targetAudience}</p>
      </div>
      </div>
      `;
      
      courseDetailView.innerHTML = courseHTML;
      showView('course');
      
      // Adiciona listeners aos novos botões
      addCourseDetailListeners(course);
    };
    
    const addCourseDetailListeners = (course) => {
      document.getElementById('back-to-courses-btn').addEventListener('click', () => showView('main'));
      
      document.getElementById('enroll-btn-detail').addEventListener('click', (e) => {
        if (!currentUserId) {
          showNotification('Erro', 'Você precisa estar logado para se inscrever.', 'error');
          return;
        }
        document.getElementById('enroll-course-name').innerText = e.target.dataset.courseName;
        modalEnroll.dataset.courseId = e.target.dataset.courseId; 
        openModal('modalEnroll');
      });
      
      document.getElementById('btn-checkin').addEventListener('click', () => {
        modalCheckin.dataset.courseId = course.id; 
        document.getElementById('checkin-error').classList.add('hidden');
        document.getElementById('checkin-password').value = '';
        openModal('modalCheckin');
      });
      
      // Materiais - Tenta abrir URL
      document.getElementById('btn-materials').addEventListener('click', () => {
        if (course.materials && course.materials.length > 0 && course.materials[0].url) {
          window.open(course.materials[0].url, '_blank');
        } else {
          showNotification('Info', 'Nenhum material disponível para este curso.', 'success');
        }
      });
      
      // Avaliar
      document.getElementById('btn-evaluate').addEventListener('click', () => {
        const instructorName = course.instructors[0]?.name || 'o instrutor';
        document.getElementById('evaluate-instructor-name').innerText = instructorName;
        modalEvaluate.dataset.courseId = course.id;
        modalEvaluate.dataset.instructorId = course.instructors[0]?.id || 'unknown'; // Usa ID se disponível
        openModal('modalEvaluate');
      });
      
      // Certificado
      document.getElementById('btn-certificate').addEventListener('click', () => {
        showNotification('Info', 'Funcionalidade de download de certificado em implementação.', 'success');
      });
    };

    // --- Lógica dos Modais de Ação ---

    // Modal de Inscrição (Formulário)
    document.getElementById('enroll-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const courseId = modalEnroll.dataset.courseId;
      if (!currentUserId || !courseId) {
        showNotification('Erro', 'ID do usuário ou do curso não encontrado.', 'error');
        return;
      }
      
      const enrollSubmitBtn = document.getElementById('enroll-submit-btn');
      enrollSubmitBtn.disabled = true;
      enrollSubmitBtn.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i>A processar...';

      try {
        const enrollmentData = {
          userId: currentUserId,
          courseId: courseId,
          name: document.getElementById('enroll-name').value,
          email: document.getElementById('enroll-email').value,
          phone: document.getElementById('enroll-phone').value,
          setor: document.getElementById('enroll-setor').value,
          enrolledAt: serverTimestamp(),
          status: 'inscrito'
        };

        const enrollmentRef = doc(collection(db, 'artifacts', appId, 'public/data/enrollments'));
        
        await setDoc(enrollmentRef, enrollmentData);
        
        // Gerar protocolo
        const protocol = enrollmentRef.id.substring(0, 8).toUpperCase();
        document.getElementById('enroll-protocol').innerText = protocol;
        
        closeModal('modalEnroll');
        document.getElementById('enroll-form').reset();
        openModal('modalEnrollSuccess');
        
      } catch (error) {
        console.error("Erro ao inscrever:", error);
        document.getElementById('enroll-error').innerText = "Erro ao processar inscrição. Tente novamente.";
        document.getElementById('enroll-error').classList.remove('hidden');
      } finally {
        enrollSubmitBtn.disabled = false;
        enrollSubmitBtn.innerHTML = '<i class="fa-solid fa-paper-plane mr-2"></i>Confirmar Inscrição';
      }
    });

    // Modal de Check-in (Formulário)
    document.getElementById('checkin-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const courseId = modalCheckin.dataset.courseId;
      const inputPassword = document.getElementById('checkin-password').value;
      const errorEl = document.getElementById('checkin-error');
      
      if (!currentUserId || !courseId) {
        showNotification('Erro', 'ID do usuário ou do curso não encontrado.', 'error');
        return;
      }

      try {
        let correctPassword = courseCheckinPasswords[courseId];
        
        // Tenta buscar a senha do Firestore se não tiver no cache (admin pode ter atualizado)
        if (!correctPassword) {
            const passwordDocRef = doc(db, 'artifacts', appId, 'public/data/checkinPasswords', courseId);
            const docSnap = await getDoc(passwordDocRef);
            if (docSnap.exists() && docSnap.data().password) {
              correctPassword = docSnap.data().password;
              courseCheckinPasswords[courseId] = correctPassword; // Salva no cache
            }
        }
        
        if (correctPassword && inputPassword === correctPassword) {
          // Caminho correto para dados privados do usuário
          const checkinRef = doc(db, 'artifacts', appId, 'users', currentUserId, 'checkins', courseId);
          await setDoc(checkinRef, {
            checkedInAt: Timestamp.now()
          });
          
          currentUserCheckins[courseId] = { checkedInAt: Timestamp.now() };
          showNotification('Sucesso!', 'Check-in realizado!', 'success');
          closeModal('modalCheckin');
          
          // Atualiza botões na página de detalhes (se estiver aberta)
          const btnCheckin = document.getElementById('btn-checkin');
          const btnMaterials = document.getElementById('btn-materials');
          const btnEvaluate = document.getElementById('btn-evaluate');
          
          if (btnCheckin) {
            btnCheckin.disabled = true;
            btnCheckin.innerHTML = '<i class="fas fa-user-check mr-2"></i>Check-in Realizado';
          }
          if (btnMaterials) {
            // Reavalia se o botão de materiais deve ser habilitado
             const course = localCourses.find(c => c.id === courseId);
             btnMaterials.disabled = !(course && course.materials && course.materials.length > 0);
          }
          if (btnEvaluate) btnEvaluate.disabled = false;
          
        } else {
          errorEl.innerText = "Senha incorreta. Tente novamente.";
          errorEl.classList.remove('hidden');
        }
      } catch (error) {
        console.error("Erro ao fazer check-in:", error);
        errorEl.innerText = "Erro ao validar a senha. (O admin já definiu uma?)";
        errorEl.classList.remove('hidden');
      }
    });
    
    // Modal de Avaliação (Formulário)
    document.getElementById('evaluate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const courseId = modalEvaluate.dataset.courseId;
      const instructorId = modalEvaluate.dataset.instructorId;
      const rating = document.querySelector('input[name="rating"]:checked');
      const comment = document.getElementById('evaluate-comment').value;

      if (!rating) {
        showNotification('Erro', 'Por favor, selecione uma nota (de 1 a 5 estrelas).', 'error');
        return;
      }
      if (!currentUserId || !courseId || !instructorId) {
        showNotification('Erro', 'Informações em falta (usuário, curso ou instrutor).', 'error');
        return;
      }

      try {
        const evaluationRef = doc(collection(db, 'artifacts', appId, 'public/data/evaluations'));
        await setDoc(evaluationRef, {
          userId: currentUserId,
          courseId: courseId,
          instructorId: instructorId,
          rating: parseInt(rating.value, 10),
          comment: comment,
          createdAt: Timestamp.now()
        });
        
        showNotification('Obrigado!', 'Sua avaliação foi enviada com sucesso.', 'success');
        closeModal('modalEvaluate');
        document.getElementById('evaluate-form').reset();
        
      } catch (error) {
        console.error("Erro ao enviar avaliação:", error);
        document.getElementById('evaluate-error').classList.remove('hidden');
      }
    });

    // --- Lógica do Painel de Admin ---

    // Navegação por Tabs do Admin
    document.querySelector('.admin-sidebar nav').addEventListener('click', (e) => {
      const link = e.target.closest('.admin-nav-link');
      if (link && isAdmin) { 
        e.preventDefault();
        const tabId = link.dataset.tab;
        
        document.querySelectorAll('.admin-sidebar .admin-nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        document.querySelectorAll('.admin-tab-content').forEach(tab => tab.classList.add('hidden'));
        document.getElementById(tabId).classList.remove('hidden');
        
        // Recarrega dados específicos da aba ao clicar
        if (tabId === 'admin-tab-dashboard') loadAdminDashboardData();
        if (tabId === 'admin-tab-courses') loadAdminCourses();
        if (tabId === 'admin-tab-enrollments') loadAdminEnrollments();
        if (tabId === 'admin-tab-instructors') loadAdminInstructors();
        if (tabId === 'admin-tab-certificates') loadAdminCertificates();
        if (tabId === 'admin-tab-settings') loadAdminCoursePasswords();
      }
    });

    const loadAdminPanel = () => {
      if (!isAdmin) return; 
      loadAdminDashboardData(); // Carrega dados do dashboard ao entrar no admin
      loadAdminCourses(); // Carrega dados dos cursos (necessário para outros modais)
      loadAdminInstructors(); // Carrega dados dos instrutores (necessário para modal de curso)
    };
    
    // Carregar senhas no admin
    const loadAdminCoursePasswords = async () => {
      if (!isAdmin) return;
      const inputsContainer = document.getElementById('admin-passwords-inputs');
      inputsContainer.innerHTML = '<p class="text-gray-500">A carregar cursos...</p>';
      
      try {
        // Usa o cache local de cursos
        if (localCourses.length === 0) {
          inputsContainer.innerHTML = '<p class="text-gray-500">Nenhum curso encontrado.</p>';
          return;
        }
        
        // Busca todas as senhas de uma vez
        const passwordsRef = collection(db, 'artifacts', appId, 'public/data/checkinPasswords');
        const passwordsSnap = await getDocs(passwordsRef);
        courseCheckinPasswords = {}; // Limpa e re-popula cache
        passwordsSnap.forEach(doc => {
          courseCheckinPasswords[doc.id] = doc.data().password;
        });
        
        inputsContainer.innerHTML = ''; // Limpa o "loading"
        localCourses.forEach(course => {
          if (course.status === 'aberto') { // Mostra apenas cursos abertos
            const currentPassword = courseCheckinPasswords[course.id] || '';
            const inputHTML = `
              <div>
                <label class"input-label" for="pass-${course.id}">${course.title}</label>
                <input type="text" id="pass-${course.id}" data-course-id="${course.id}" 
                       class="input-field" value="${currentPassword}" placeholder="Senha para ${course.title}">
              </div>
            `;
            inputsContainer.innerHTML += inputHTML;
          }
        });

      } catch (error) {
        console.error("Erro ao carregar senhas:", error);
        inputsContainer.innerHTML = '<p class="text-red-500">Erro ao carregar senhas.</p>';
      }
    };
    
    // Submit senhas no admin
    document.getElementById('admin-form-passwords').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isAdmin) return;
      
      const inputs = document.querySelectorAll('#admin-passwords-inputs input[type="text"]');
      let promises = [];
      
      inputs.forEach(input => {
        const courseId = input.dataset.courseId;
        const password = input.value;
        const docRef = doc(db, 'artifacts', appId, 'public/data/checkinPasswords', courseId);
        promises.push(setDoc(docRef, { password: password }));
      });
      
      try {
        await Promise.all(promises);
        showNotification('Sucesso', 'Senhas de check-in atualizadas.', 'success');
      } catch (error) {
        console.error("Erro ao salvar senhas:", error);
        showNotification('Erro', 'Não foi possível salvar as senhas.', 'error');
      }
    });

    // Seed Database
    document.getElementById('btn-seed-database').addEventListener('click', async () => {
      if (!isAdmin) return;
      
      const seedInstructors = [
          { id: "marllon", name: "Marllon Costa", title: "Técnico em Tecnologia da Informação | Designer | Marketing | Inovação e IA", image: "https://i.postimg.cc/sxm4TVvF/IMG-9781.jpg", bio: "Designer gráfico, graduando em marketing e autodidata em Inovação e IA. Trabalha e estuda sobre IA desde 2021..." },
          { id: "vinicius", name: "Vinícius Sena", title: "Fotógrafo Documental/Eventos | Animação", image: "https://i.postimg.cc/bw7kHG3D/vinicius.jpg", bio: "Formado em Animação, estudante e entusiasta de fotografia desde 2019..." },
          { id: "bruno", name: "Bruno Diogo", title: "Supervisor de Marketing e Mídias Visuais | Designer Gráfico", image: "https://i.postimg.cc/yNhgmLJK/IMG-7311.avif", bio: "Supervisor de Marketing e Mídias Visuais | Designer Gráfico e Digital | UX & UI | 📸 Fotografia" },
          { id: "keven", name: "Keven Menezes", title: "Analista de TI | Designer Gráfico | Motion Design", image: "https://i.postimg.cc/fTgkcmpP/Whats-App-Image-2025-10-27-at-12-11-25.jpg", bio: "Formado em Design Gráfico e possui mais de 5 anos de experiência..." },
          { id: "deyse", name: "Deyse Pereira", title: "Estrategista em Comunicação, Design e Gestão de Projetos", image: "https://i.postimg.cc/T1sL3bXz/IMG-7381-jpg.png", bio: "Mestre em Design de Artefatos Digitais, pós-graduanda em Gestão de Projetos..." }
      ];

      const seedCourses = [
          {
              id: "fotografia",
              themeColor: "#FFC107",
              themeColorDark: "#E6A700",
              headerOverlayImage: "https://i.postimg.cc/3rLTy2xn/medium-shot-people-with-camera.jpg",
              icon: "fa-camera-retro",
              title: "Workshop de Fotografia",
              subtitle: "O Olhar que Conecta Histórias",
              summary: "Aprenda a capturar a essência dos nossos projetos com sensibilidade e técnica.",
              fullDescription: "No Instituto Evereste, cada imagem conta uma parte da nossa história...",
              learningObjectives: [
                  "Introduzir conceitos básicos de fotografia (composição, iluminação, enquadramento).",
                  "Desenvolver habilidades práticas em fotografia com câmaras e celulares.",
                  "Capacitar para o registo de eventos e projetos com qualidade profissional."
              ],
              modules: [
                  { title: "Módulo 1: Fundamentos e Equipamento", topics: ["Introdução à história...", "Dominando o corpo da câmera...", "Entendendo ISO..."] },
                  { title: "Módulo 2: Composição e Iluminação", topics: ["A arte do enquadramento...", "Trabalhando com a luz...", "Princípios de composição..."] },
                  { title: "Módulo 3: Edição e Pós-Produção", topics: ["Introdução à edição...", "Análise do histograma..."] }
              ],
              requirements: ["Não são necessários pré-requisitos.", "Incentivamos a trazer o seu próprio smartphone ou câmara."],
              targetAudience: "O Curso de Fotografia é voltado para pessoas que desejam explorar o poder da imagem...",
              instructors: [
                  { name: "Bruno Diogo", title: "Supervisor de Marketing e Mídias Visuais | Designer Gráfico", image: "https://i.postimg.cc/yNhgmLJK/IMG-7311.avif" },
                  { name: "Vinícius Sena", title: "Fotógrafo Documental/Eventos | Animação", image: "https://i.postimg.cc/bw7kHG3D/vinicius.jpg" }
              ],
              details: { "Data": "28 de Outubro de 2025", "Horário": "08:30h - 12:15h", "Carga": "4 horas", "Certificado": "Sim", "Modalidade": "Presencial e Online" },
              practicalActivities: [
                  { title: "Exercício de Teste: Contando uma História", description: "Em duplas, os participantes tiram 3 fotos..." },
                  { title: "Exercício de Conhecimento: Dominando a Luz", description: "Os participantes tiram 3-5 fotos..." }
              ],
              status: "aberto"
          },
          {
              id: "ia",
              themeColor: "#4CAF50",
              themeColorDark: "#388E3C",
              headerOverlayImage: "https://i.postimg.cc/bv25v2BZ/relat-rio-1.png",
              icon: "fa-brain",
              title: "IA Aplicada à Análise de Dados",
              subtitle: "Do Relatório ao Insight",
              summary: "Transforme relatórios e dados brutos em dashboards web interativos e de alto impacto.",
              fullDescription: "Num mundo movido por dados, a capacidade de extrair insights rápidos é um superpoder...",
              learningObjectives: [
                  "Formular prompts eficazes no Gemini para gerar códigos de dashboards.",
                  "Publicar um dashboard interativo na web utilizando o GitHub Pages.",
                  "Estruturar uma apresentação de resultados de alto impacto."
              ],
              modules: [
                  { title: "Módulo 1: Fundamentos e Geração de Código", topics: ["Os 3 pilares do Método...", "Introdução às ferramentas..."] },
                  { title: "Módulo 2: Publicação e Interatividade", topics: ["Desmistificando o GitHub...", "Oficina Prática: Publicando..."] },
                  { title: "Módulo 3: Apresentação Estratégica", topics: ["Técnicas para apresentar...", "Simulação de apresentação..."] }
              ],
              requirements: ["É indispensável ter um notebook.", "Conta Google para acesso ao Gemini.", "Conta no GitHub."],
              targetAudience: "Para todos os colaboradores, entusiastas de tecnologia...",
              instructors: [
                  { name: "Marllon Costa", title: "Técnico em Tecnologia da Informação | Designer | Marketing | Inovação e IA", image: "https://i.postimg.cc/sxm4TVvF/IMG-9781.jpg" }
              ],
              details: { "Data": "06 de Novembro de 2025", "Carga": "4 horas", "Certificado": "Sim", "Modalidade": "Presencial ou Online" },
              practicalActivities: [
                  { title: "Oficina Prática 1: O Prompt Perfeito", description: "Os participantes recebem um relatório de exemplo..." },
                  { title: "Oficina Prática 2: O Seu Primeiro Dashboard no Ar", description: "Passo a passo guiado..." }
              ],
              status: "aberto"
          }
      ];

      try {
        const instructorsCollection = collection(db, 'artifacts', appId, 'public/data/instructors');
        for (const instructor of seedInstructors) {
          await setDoc(doc(instructorsCollection, instructor.id), instructor);
        }
        
        const coursesCollection = collection(db, 'artifacts', appId, 'public/data/courses');
        for (const course of seedCourses) {
          await setDoc(doc(coursesCollection, course.id), course);
        }
        
        showNotification('Sucesso', 'Banco de dados populado com dados iniciais.', 'success');
        loadCourses();
        loadInstructors();
        loadAdminCourses();
        loadAdminInstructors();
      } catch (error) {
        console.error("Erro ao popular banco de dados:", error);
        showNotification('Erro', 'Falha ao popular o banco de dados.', 'error');
      }
    });

    // Carregar stats do Dashboard
    const loadAdminDashboardData = async () => {
      if (!isAdmin) return;
      try {
        const enrollmentsSnap = await getDocs(collection(db, 'artifacts', appId, 'public/data/enrollments'));
        document.getElementById('stat-enrollments').innerText = enrollmentsSnap.size;
        
        // Check-ins são privados, contagem é mais complexa (precisa de função de agregação ou contagem por usuário)
        // Por agora, deixamos em 0 ou um placeholder
        document.getElementById('stat-checkins').innerText = 'N/A'; // Contagem complexa
        
        const certificatesSnap = await getDocs(collection(db, 'artifacts', appId, 'public/data/certificates'));
        document.getElementById('stat-certificates').innerText = certificatesSnap.size;
      } catch (error) {
        console.error("Erro ao carregar stats do dashboard:", error);
      }
    };
    
    // Carregar Cursos na Tabela Admin
    const loadAdminCourses = () => {
      const tableBody = document.getElementById('admin-courses-table-body');
      tableBody.innerHTML = '';
      if (localCourses.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4">Nenhum curso encontrado.</td></tr>';
        return;
      }
      
      localCourses.forEach(course => {
        const statusBadge = course.status === 'aberto' ? 'badge-success' : (course.status === 'em_breve' ? 'badge-soon' : '');
        const statusText = course.status === 'aberto' ? 'Aberto' : (course.status === 'em_breve' ? 'Em Breve' : 'Fechado');
        const rowHTML = `
          <tr>
            <td>${course.title}</td>
            <td><span class="badge ${statusBadge}">${statusText}</span></td>
            <td>0</td> <!-- Placeholder de contagem de matriculados -->
            <td>
              <button class="btn btn-ghost px-2 py-1 text-sm btn-edit-course" data-id="${course.id}">
                <i class="fas fa-pencil-alt"></i>
              </button>
            </td>
          </tr>
        `;
        tableBody.innerHTML += rowHTML;
      });
    };
    
    // Carregar Instrutores na Tabela Admin
    const loadAdminInstructors = () => {
      const tableBody = document.getElementById('admin-instructors-table-body');
      tableBody.innerHTML = '';
      if (localInstructors.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4">Nenhum instrutor encontrado.</td></tr>';
        return;
      }
      
      localInstructors.forEach(instructor => {
        const rowHTML = `
          <tr>
            <td><img src="${instructor.image}" alt="${instructor.name}" class="h-10 w-10 rounded-full object-cover" onerror="this.src='https://placehold.co/40x40/ccc/fff?text=?';"/></td>
            <td>${instructor.name}</td>
            <td>${instructor.title}</td>
            <td>
              <button class="btn btn-ghost px-2 py-1 text-sm btn-edit-instructor" data-id="${instructor.id}">
                <i class="fas fa-pencil-alt"></i>
              </button>
            </td>
          </tr>
        `;
        tableBody.innerHTML += rowHTML;
      });
    };
    
    // Carregar Matrículas na Tabela Admin
    const loadAdminEnrollments = async () => {
      if (!isAdmin) return;
      const tableBody = document.getElementById('admin-enrollments-table-body');
      tableBody.innerHTML = '<tr><td colspan="7"><i class="fas fa-spinner animate-spin"></i> A carregar matrículas...</td></tr>';
      
      try {
        const enrollmentsRef = collection(db, 'artifacts', appId, 'public/data/enrollments');
        const querySnap = await getDocs(enrollmentsRef);
        
        if (querySnap.empty) {
          tableBody.innerHTML = '<tr><td colspan="7">Nenhuma matrícula encontrada.</td></tr>';
          return;
        }
        
        tableBody.innerHTML = '';
        querySnap.forEach(doc => {
          const data = doc.data();
          const course = localCourses.find(c => c.id === data.courseId);
          const date = data.enrolledAt?.toDate ? data.enrolledAt.toDate().toLocaleDateString('pt-BR') : 'N/A';
          const rowHTML = `
            <tr>
              <td>${doc.id.substring(0, 8).toUpperCase()}</td>
              <td>${data.name}</td>
              <td>${data.email}</td>
              <td>${data.phone}</td>
              <td>${data.setor}</td>
              <td>${course?.title || data.courseId}</td>
              <td>${date}</td>
            </tr>
          `;
          tableBody.innerHTML += rowHTML;
        });
      } catch (error) {
        console.error("Erro ao carregar matrículas:", error);
        tableBody.innerHTML = '<tr><td colspan="7" class="text-red-600">Erro ao carregar matrículas.</td></tr>';
      }
    };
    
    // Carregar Certificados na Tabela Admin
    const loadAdminCertificates = async () => {
      if (!isAdmin) return;
      const tableBody = document.getElementById('admin-certificates-table-body');
      tableBody.innerHTML = '<tr><td colspan="5"><i class="fas fa-spinner animate-spin"></i> A carregar certificados...</td></tr>';
      
      try {
        const certificatesRef = collection(db, 'artifacts', appId, 'public/data/certificates');
        const querySnap = await getDocs(certificatesRef);
        
        if (querySnap.empty) {
          tableBody.innerHTML = '<tr><td colspan="5">Nenhum certificado emitido.</td></tr>';
          return;
        }
        
        tableBody.innerHTML = '';
        querySnap.forEach(doc => {
          const data = doc.data();
          const date = data.issuedAt?.toDate ? data.issuedAt.toDate().toLocaleDateString('pt-BR') : 'N/A';
          const statusBadge = data.released ? 'badge-success' : 'badge-soon';
          const statusText = data.released ? 'Liberado' : 'Pendente';
          const buttonText = data.released ? 'Revogar' : 'Liberar';
          const buttonClass = data.released ? 'btn-ghost' : 'btn-primary';

          const rowHTML = `
            <tr>
              <td>${data.studentName}</td>
              <td>${data.courseName}</td>
              <td>${date}</td>
              <td><span class="badge ${statusBadge}">${statusText}</span></td>
              <td>
                <button class="btn ${buttonClass} px-2 py-1 text-sm btn-toggle-certificate" data-id="${doc.id}" data-released="${data.released}">
                  ${buttonText}
                </button>
              </td>
            </tr>
          `;
          tableBody.innerHTML += rowHTML;
        });
      } catch (error) {
        console.error("Erro ao carregar certificados:", error);
        tableBody.innerHTML = '<tr><td colspan="5" class="text-red-600">Erro ao carregar certificados.</td></tr>';
      }
    };
    
    // --- Listeners e Handlers para Modais de Edição Admin ---
    
    // Abrir modal de ADICIONAR Curso
    document.getElementById('btn-add-course').addEventListener('click', () => {
      document.getElementById('modalEditCourse-form').reset();
      document.getElementById('edit-course-id').value = '';
      document.getElementById('modalEditCourse-title').innerText = "Adicionar Novo Curso";
      populateInstructorCheckboxes(); // Popula checkboxes
      document.getElementById('edit-course-material-filename').innerText = "Nenhum arquivo selecionado";
      document.getElementById('edit-course-material-current').innerHTML = ''; // Limpa info de material atual
      currentEditingFile = null; // Limpa arquivo selecionado
      openModal('modalEditCourse');
    });

    // Popula checkboxes de instrutores
    const populateInstructorCheckboxes = (assignedInstructors = []) => {
        const listContainer = document.getElementById('edit-course-instructors-list');
        listContainer.innerHTML = '';
        if (localInstructors.length === 0) {
            listContainer.innerHTML = '<p class="text-gray-500">Nenhum instrutor cadastrado.</p>';
            return;
        }
        
        // Cria um Set com nomes dos instrutores já associados para fácil verificação
        const assignedNames = new Set((assignedInstructors || []).map(inst => inst.name));

        localInstructors.forEach(instructor => {
            const isChecked = assignedNames.has(instructor.name);
            const checkboxHTML = `
                <div class="flex items-center">
                    <input id="inst-${instructor.id}" type="checkbox" value="${instructor.id}" 
                           data-instructor-json='${JSON.stringify({ name: instructor.name, title: instructor.title, image: instructor.image })}' 
                           class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                           ${isChecked ? 'checked' : ''}>
                    <label for="inst-${instructor.id}" class="ml-2 block text-sm text-gray-900">${instructor.name}</label>
                </div>
            `;
            listContainer.innerHTML += checkboxHTML;
        });
    };

    // Listener para o input de arquivo
    const fileInput = document.getElementById('edit-course-material-file');
    const fileNameSpan = document.getElementById('edit-course-material-filename');
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            fileNameSpan.innerText = file.name;
            currentEditingFile = file; // Guarda o arquivo para o upload
        } else {
            fileNameSpan.innerText = "Nenhum arquivo selecionado";
            currentEditingFile = null;
        }
    });

    // Abrir modal de EDITAR Curso (EXPANDIDO)
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.btn-edit-course');
      if (btn && isAdmin) {
        const courseId = btn.dataset.id;
        const course = localCourses.find(c => c.id === courseId);
        if (!course) return;
        
        // --- Preenche campos simples e complexos ---
        document.getElementById('edit-course-id').value = course.id;
        document.getElementById('edit-course-title').value = course.title || '';
        document.getElementById('edit-course-subtitle').value = course.subtitle || '';
        document.getElementById('edit-course-summary').value = course.summary || '';
        document.getElementById('edit-course-description').value = course.fullDescription || '';
        document.getElementById('edit-course-icon').value = course.icon || '';
        document.getElementById('edit-course-color').value = course.themeColor || '';
        document.getElementById('edit-course-status').value = course.status || 'fechado';
        document.getElementById('edit-course-image').value = course.headerOverlayImage || '';
        document.getElementById('edit-course-audience').value = course.targetAudience || '';
        document.getElementById('edit-course-objectives').value = (course.learningObjectives || []).join('\n');
        document.getElementById('edit-course-requirements').value = (course.requirements || []).join('\n');
        document.getElementById('edit-course-modules').value = JSON.stringify(course.modules || [], null, 2);
        document.getElementById('edit-course-activities').value = JSON.stringify(course.practicalActivities || [], null, 2);
        document.getElementById('edit-course-details').value = JSON.stringify(course.details || {}, null, 2);
        // --- Fim do preenchimento ---

        // Popula e marca checkboxes dos instrutores
        populateInstructorCheckboxes(course.instructors); 
        
        // Mostra info do material atual e limpa seleção de arquivo
        const currentMaterialDiv = document.getElementById('edit-course-material-current');
        if (course.materials && course.materials.length > 0) {
            currentMaterialDiv.innerHTML = `Material Atual: <a href="${course.materials[0].url}" target="_blank" class="text-blue-600 hover:underline">${course.materials[0].name}</a>`;
        } else {
            currentMaterialDiv.innerHTML = '';
        }
        fileInput.value = ''; // Limpa seleção de arquivo anterior
        fileNameSpan.innerText = "Nenhum arquivo selecionado";
        currentEditingFile = null;

        document.getElementById('modalEditCourse-title').innerText = "Editar Curso";
        openModal('modalEditCourse');
      }
    });
    
    // Salvar (Adicionar/Editar) Curso (EXPANDIDO + UPLOAD)
    document.getElementById('modalEditCourse-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isAdmin) return;
      
      const courseId = document.getElementById('edit-course-id').value;
      const saveBtn = document.getElementById('save-course-btn');
      const saveBtnText = document.getElementById('save-course-btn-text');
      const saveBtnSpinner = document.getElementById('save-course-btn-spinner');

      saveBtn.disabled = true;
      saveBtnText.classList.add('hidden');
      saveBtnSpinner.classList.remove('hidden');

      try {
        // --- Parseia campos complexos ---
        const learningObjectives = document.getElementById('edit-course-objectives').value.split('\n').filter(Boolean); 
        const requirements = document.getElementById('edit-course-requirements').value.split('\n').filter(Boolean);
        const modules = JSON.parse(document.getElementById('edit-course-modules').value || '[]');
        const practicalActivities = JSON.parse(document.getElementById('edit-course-activities').value || '[]');
        const details = JSON.parse(document.getElementById('edit-course-details').value || '{}');

        // Pega instrutores selecionados
        const selectedInstructors = [];
        document.querySelectorAll('#edit-course-instructors-list input:checked').forEach(checkbox => {
            selectedInstructors.push(JSON.parse(checkbox.dataset.instructorJson));
        });

        const courseData = {
          title: document.getElementById('edit-course-title').value,
          subtitle: document.getElementById('edit-course-subtitle').value,
          summary: document.getElementById('edit-course-summary').value,
          fullDescription: document.getElementById('edit-course-description').value,
          icon: document.getElementById('edit-course-icon').value,
          themeColor: document.getElementById('edit-course-color').value,
          status: document.getElementById('edit-course-status').value,
          headerOverlayImage: document.getElementById('edit-course-image').value,
          targetAudience: document.getElementById('edit-course-audience').value,
          learningObjectives,
          requirements,
          modules,
          practicalActivities,
          details,
          instructors: selectedInstructors
        };
        
        // --- Lógica de Upload ---
        let newMaterialData = null;
        // Define o ID do curso (cria um novo se for adição)
        const effectiveCourseId = courseId || doc(collection(db, 'temp')).id; // Usa ID existente ou gera um novo ID TEMPORÁRIO

        if (currentEditingFile) {
            showNotification('Info', 'A fazer upload do material...', 'success');
            const file = currentEditingFile;
            const uniqueFileName = `${Date.now()}_${file.name}`; // Evita sobrescrever
            const storageRef = ref(storage, `materials/${effectiveCourseId}/${uniqueFileName}`);
            
            try {
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                newMaterialData = { name: file.name, url: downloadURL, path: snapshot.ref.fullPath }; // Salva o path
                console.log('Upload concluído:', downloadURL);
                showNotification('Sucesso', 'Material enviado com sucesso!', 'success');
            } catch (uploadError) {
                console.error("Erro no upload:", uploadError);
                showNotification('Erro Upload', 'Falha ao enviar o material.', 'error');
                throw uploadError; // Para a execução se o upload falhar
            }
        }
        
        // Adiciona/Atualiza o material no courseData
        if (newMaterialData) {
            courseData.materials = [newMaterialData]; // Substitui/Adiciona o novo material (simplificado para um material)
        } else if (courseId) {
            // Se está editando e não enviou novo arquivo, mantém o material antigo (se existir)
            const existingCourse = localCourses.find(c => c.id === courseId);
            courseData.materials = existingCourse?.materials || [];
        } else {
             courseData.materials = []; // Garante que o campo existe para novos cursos
        }
        // --- Fim da Lógica de Upload ---

        let docRef;
        if (courseId) {
          // Editar
          docRef = doc(db, 'artifacts', appId, 'public/data/courses', courseId);
          await updateDoc(docRef, courseData);
          showNotification('Sucesso', 'Curso atualizado.', 'success');
        } else {
          // Adicionar
          docRef = doc(db, 'artifacts', appId, 'public/data/courses', effectiveCourseId); // Usa o ID (existente ou novo)
          await setDoc(docRef, courseData); // Usa setDoc para garantir o ID correto
          showNotification('Sucesso', 'Curso adicionado.', 'success');
        }
        closeModal('modalEditCourse');
        loadCourses(); // Recarrega cursos
        loadAdminCourses(); // Recarrega tabela admin
      } catch (error) {
        console.error("Erro ao salvar curso:", error);
        showNotification('Erro', 'Não foi possível salvar. Verifique o formato JSON e o upload.', 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtnText.classList.remove('hidden');
        saveBtnSpinner.classList.add('hidden');
        currentEditingFile = null; // Limpa o arquivo após tentativa de salvar
      }
    });

    // Abrir modal de ADICIONAR Instrutor
    document.getElementById('btn-add-instructor').addEventListener('click', () => {
      document.getElementById('modalEditInstructor-form').reset();
      document.getElementById('edit-instructor-id').value = '';
      document.getElementById('modalEditInstructor-title').innerText = "Adicionar Novo Instrutor";
      openModal('modalEditInstructor');
    });
    
    // Abrir modal de EDITAR Instrutor
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.btn-edit-instructor');
      if (btn && isAdmin) {
        const instructorId = btn.dataset.id;
        const instructor = localInstructors.find(i => i.id === instructorId);
        if (!instructor) return;
        
        document.getElementById('edit-instructor-id').value = instructor.id;
        document.getElementById('edit-instructor-name').value = instructor.name || '';
        document.getElementById('edit-instructor-title').value = instructor.title || '';
        document.getElementById('edit-instructor-bio').value = instructor.bio || '';
        document.getElementById('edit-instructor-image').value = instructor.image || '';
        
        document.getElementById('modalEditInstructor-title').innerText = "Editar Instrutor";
        openModal('modalEditInstructor');
      }
    });
    
    // Salvar (Adicionar/Editar) Instrutor
    document.getElementById('modalEditInstructor-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isAdmin) return;
      
      const instructorId = document.getElementById('edit-instructor-id').value;
      const instructorData = {
        name: document.getElementById('edit-instructor-name').value,
        title: document.getElementById('edit-instructor-title').value,
        bio: document.getElementById('edit-instructor-bio').value,
        image: document.getElementById('edit-instructor-image').value,
      };
      
      try {
        let docRef;
        if (instructorId) {
          // Editar
          docRef = doc(db, 'artifacts', appId, 'public/data/instructors', instructorId);
          await updateDoc(docRef, instructorData);
          showNotification('Sucesso', 'Instrutor atualizado.', 'success');
        } else {
          // Adicionar
          docRef = collection(db, 'artifacts', appId, 'public/data/instructors');
          await addDoc(docRef, instructorData);
          showNotification('Sucesso', 'Instrutor adicionado.', 'success');
        }
        closeModal('modalEditInstructor');
        loadInstructors(); // Recarrega instrutores na home
        loadAdminInstructors(); // Recarrega tabela admin
      } catch (error) {
        console.error("Erro ao salvar instrutor:", error);
        showNotification('Erro', 'Não foi possível salvar o instrutor.', 'error');
      }
    });
    
    // --- Listeners e Handlers para Certificados ---
    
    // Abrir modal de EMITIR Certificado
    document.getElementById('btn-issue-certificate').addEventListener('click', () => {
      document.getElementById('modalIssueCertificate-form').reset();
      
      // Popula o select de cursos
      const courseSelect = document.getElementById('issue-cert-course');
      courseSelect.innerHTML = '<option value="">Selecione um curso...</option>';
      localCourses.forEach(course => {
        if (course.status === 'aberto') { // Apenas cursos abertos
          courseSelect.innerHTML += `<option value="${course.title}">${course.title}</option>`;
        }
      });
      
      openModal('modalIssueCertificate');
    });

    // Salvar (Emitir) Certificado
    document.getElementById('modalIssueCertificate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isAdmin) return;
      
      try {
        const certificateData = {
          userId: document.getElementById('issue-cert-userid').value,
          studentName: document.getElementById('issue-cert-student-name').value,
          courseName: document.getElementById('issue-cert-course').value,
          issuedAt: Timestamp.fromDate(new Date(document.getElementById('issue-cert-date').value)),
          released: false // Começa como não liberado
        };

        const docRef = collection(db, 'artifacts', appId, 'public/data/certificates');
        await addDoc(docRef, certificateData);
        
        showNotification('Sucesso', 'Certificado emitido e pendente de liberação.', 'success');
        closeModal('modalIssueCertificate');
        loadAdminCertificates(); // Recarrega a tabela
      } catch (error) {
        console.error("Erro ao emitir certificado:", error);
        showNotification('Erro', 'Não foi possível emitir o certificado.', 'error');
      }
    });
    
    // LIBERAR/REVOGAR Certificado
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('.btn-toggle-certificate');
      if (btn && isAdmin) {
        const docId = btn.dataset.id;
        const currentStatus = btn.dataset.released === 'true';
        const newStatus = !currentStatus;
        
        try {
          const docRef = doc(db, 'artifacts', appId, 'public/data/certificates', docId);
          await updateDoc(docRef, { released: newStatus });
          showNotification('Sucesso', `Certificado ${newStatus ? 'Liberado' : 'Revogado'}.`, 'success');
          loadAdminCertificates(); // Recarrega a tabela
        } catch (error) {
          console.error("Erro ao atualizar status do certificado:", error);
          showNotification('Erro', 'Não foi possível atualizar o status.', 'error');
        }
      }
    });

    // --- Lógica de Inicialização ---
    
    document.addEventListener('DOMContentLoaded', () => {
      // Reveal on Scroll (para elementos estáticos)
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('show'); });
      }, { threshold: 0.1 });
      document.querySelectorAll('.reveal').forEach(el => io.observe(el));
      
      // Modais
      [adminBtnHeader, adminBtnFooter].forEach(btn => btn.addEventListener('click', () => openModal('modalLogin')));
    });

    // Logo click
    document.getElementById('logo-link').addEventListener('click', (e) => {
      e.preventDefault();
      showView('main');
    });

    // Course card click (na lista principal)
    coursesListContainer.addEventListener('click', (e) => {
      const card = e.target.closest('[data-course-id]');
      if (card) {
        const courseId = card.dataset.courseId;
        const course = localCourses.find(c => c.id === courseId);
        if (course) {
          renderCourseDetail(course); // Função restaurada
        } else {
          console.error("Curso não encontrado no cache local.");
        }
      }
    });

    // Scroll Progress
    const scrollProgress = document.getElementById('scroll-progress');
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const st = h.scrollTop || document.body.scrollTop;
      const sh = h.scrollHeight || document.body.scrollHeight;
      const percent = (sh - h.clientHeight) > 0 ? (st / (sh - h.clientHeight)) * 100 : 0;
      scrollProgress.style.width = percent + '%';
    });

    // Header Scroll Effect
    const header = document.getElementById('header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 10) header.classList.add('header-scrolled');
      else header.classList.remove('header-scrolled');
    });

    // Animação de Partículas (Hero)
    const particles = document.getElementById('particles');
    if (particles) {
      const createParticle = () => {
        const s = document.createElement('span');
        s.style.left = Math.random() * 100 + 'vw';
        s.style.bottom = '-10px';
        s.style.width = (Math.random() * 2 + 1) + 'px';
        s.style.height = (Math.random() * 2 + 1) + 'px';
        s.style.animationDelay = Math.random() * 8 + 's';
        particles.appendChild(s);
        setTimeout(() => s.remove(), 14000);
      };
      for (let i = 0; i < 60; i++) createParticle();
      setInterval(createParticle, 600);
    }
    
  </script>
</body>
</html>

